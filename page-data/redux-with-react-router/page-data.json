{
    "componentChunkName": "component---src-templates-blog-js",
    "path": "/redux-with-react-router",
    "result": {"data":{"blog":{"id":"ef9d7be5-2e00-50d8-9801-e8106b35f920","html":"<p>沿着上一部分 <a href=\"/redux-with-react\">Redux With React</a>，在利用 <code>redux</code> 与 <code>react</code> 构建了单个视图的 WebApp，这部分介绍 <code>redux</code> 与 <code>react-router</code> 结合实现多个视图的 WebApp，代码也是在上一部分的基础上做修改。</p>\n<h2 id=\"prepare-package-for-react-router\" style=\"position:relative;\">prepare package for react-router<a href=\"#prepare-package-for-react-router\" aria-label=\"prepare package for react router permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><code>react-router</code> 提供了 <code>react</code> 的路由机制，除了这个库之外还有另外一个库 <code>react-router-redux</code> 用官方文档的话来说，首先 <code>redux</code> 可以和 <code>react-router</code> 两个一起使用就可以解决路由的问题，但是如果考虑到一些辅助的功能（例如和 Redux DevTool 等一起使用），就很有必要使用 <code>react-router-redux</code> 了。而且其实两者的结合非常的简单，我这里就先把它加上了。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm install --save react-router react-router-redux</code></pre></div>\n<h2 id=\"更新代码支持-router\" style=\"position:relative;\">更新代码支持 Router<a href=\"#%E6%9B%B4%E6%96%B0%E4%BB%A3%E7%A0%81%E6%94%AF%E6%8C%81-router\" aria-label=\"更新代码支持 router permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>在不改变之前单个 <code>VisibleCounter</code> 的视图的前提下引入 <code>router</code>。首先看一下代码的目录结构。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── actions\n│   └── index.js\n├── components\n│   ├── App.js\n│   └── Counter.js\n├── containers\n│   └── VisibleCounter.js ++\n├── dist\n│   ├── bundle.js\n│   ├── index.html\n│   └── styles.css\n├── entry.js ++\n├── package.json\n├── reducers\n│   ├── counter.js\n│   └── index.js ++\n├── routes.js ++\n├── styles\n│   ├── index.scss\n│   └── theme.scss\n└── webpack.config.js</code></pre></div>\n<p>其中新添加或者是有修改的文件都用 <code>++</code> 做了标记，可以看到作为 components(presentational) 在引入其他的组件的时候并没有收到影响，而 containers 则会因为 <code>store</code> 的变化而变化。</p>\n<p>为了支持 <code>router</code> 需要做这么几件事情：</p>\n<ol>\n<li>\n<p>用 <code>react-router</code> 提供的 <code>Route</code> 标签声明路由结构\n这里就是一个路由 <code>/</code> 对应组件 <code>App</code>，而 <code>App</code> 里面包含一个 <code>VisibleCounter</code></p>\n<p><code>routes.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Route <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-router'</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">import</span> App <span class=\"token keyword\">from</span> <span class=\"token string\">'./components/App'</span><span class=\"token punctuation\">;</span>\n \n <span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span>\n     <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span> component<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>App<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Route<span class=\"token operator\">></span>\n <span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>在原有的 <code>reducer</code> 中添加 <code>react-router-redux</code> 所提供的路由的 <code>reducer</code>，这里通过 <code>redux</code> 所提供的 <code>combineReducers</code> 实现。</p>\n<p><code>reducers/index.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> counter <span class=\"token keyword\">from</span> <span class=\"token string\">'./counter'</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> routerReducer <span class=\"token keyword\">as</span> routing <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-router-redux'</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> combineReducers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux'</span><span class=\"token punctuation\">;</span>\n \n <span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">combineReducers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n   counter<span class=\"token punctuation\">,</span>\n   routing\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>由于 <code>reducer</code> 做了调整，那么在 <code>VisibleCounter</code> 与 <code>store</code> 链接时也会有改变，在下面的代码中我用 <code>++</code> 标识修改的部分</p>\n<p><code>containers/VisibleCounter.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> connect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-redux'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Counter <span class=\"token keyword\">from</span> <span class=\"token string\">\"../components/Counter\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> increment<span class=\"token punctuation\">,</span> decrement <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../actions/index'</span><span class=\"token punctuation\">;</span>\n \n <span class=\"token keyword\">function</span> <span class=\"token function\">mapStatToProps</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n     value<span class=\"token operator\">:</span> state<span class=\"token punctuation\">.</span>counter <span class=\"token comment\">//++</span>\n   <span class=\"token punctuation\">}</span>\n <span class=\"token punctuation\">}</span>\n \t\n <span class=\"token keyword\">function</span> <span class=\"token function\">mapDispatchToProps</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dispatch</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function-variable function\">onIncrement</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n       <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n     <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n     <span class=\"token function-variable function\">onDecrement</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n       <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">decrement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n     <span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">}</span>\n <span class=\"token punctuation\">}</span>\n \t\n <span class=\"token keyword\">const</span> VisibleCounter <span class=\"token operator\">=</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>\n     mapStatToProps<span class=\"token punctuation\">,</span>\n     mapDispatchToProps\n <span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>Counter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \t\n <span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> VisibleCounter<span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>修改入口，用 <code>react-router</code> 所提供的 <code>&#x3C;Router></code> 标签包装整个应用，并以属性的方式传递路由结构(<code>routes</code>)和所需要的浏览器历史(<code>history</code>)支持（<code>hash</code> 或者是 <code>browser</code>）</p>\n<p><code>entry.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> require('./styles/index.scss');\n\n import React from \"react\";\n import ReactDOM from 'react-dom';\n import { Provider } from 'react-redux';\n import { hashHistory, Router } from 'react-router';\n import { syncHistoryWithStore } from 'react-router-redux';\n import { createStore } from 'redux';\n \n import reducer from './reducers/index';\n import routes from './routes';\n \n const store = createStore(reducer);\n const history = syncHistoryWithStore(hashHistory, store);\n const rootEl = document.querySelector(\"#root\");\n \n function render() {\n   ReactDOM.render(\n       &lt;Provider store={store}>\n         &lt;Router routes={routes} history={history}/>\n       &lt;/Provider>,\n       rootEl\n   )\n }\n \n render();\n store.subscribe(render);</code></pre></div>\n</li>\n</ol>\n<h2 id=\"添加一个新的视图\" style=\"position:relative;\">添加一个新的视图<a href=\"#%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E8%A7%86%E5%9B%BE\" aria-label=\"添加一个新的视图 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>现在添加一个新的视图 <code>About</code></p>\n<p><code>containers/About.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import React, { Component, PropTypes } from 'react';\n\nclass About extends Component {\n  render() {\n    return (\n        &lt;p>\n          This is about page.\n        &lt;/p>\n    )\n  }\n}\n\nexport default About;</code></pre></div>\n<p>拆分 <code>App</code> 和 <code>VisibleCounter</code> 使得 <code>App</code> 作为支持所有子视图的框架</p>\n<p><code>containres/App.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import React, { Component } from 'react';\n\nclass App extends Component {\n  render() {\n    const { children } = this.props.children;\n    return (\n        &lt;div>\n          { children }\n        &lt;/div>\n    )\n  }\n}\n\nexport default App;</code></pre></div>\n<p>更新路由，添加 <code>/</code> 下的两个子路由 <code>counter</code> 和 <code>about</code></p>\n<p><code>routes.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import React from 'react';\nimport { Route, IndexRoute } from 'react-router';\nimport App from './components/App';\nimport VisibleCounter from './containers/VisibleCounter';\nimport About from './components/About';\n\nexport default (\n    &lt;Route path=\"/\" component={App}>\n      &lt;IndexRoute component={VisibleCounter}/>\n      &lt;Route path=\"/counter\" component={VisibleCounter}/>\n      &lt;Route path=\"/about\" component={About}/>\n    &lt;/Route>\n)</code></pre></div>\n<p>其中 <code>IndexRoute</code> 表明 <code>VisibleCounter</code> 为在 <code>/</code> 时的默认路由。</p>\n<p>在执行 <code>npm start</code> 之后看看 <code>http://localhost:8080/</code> 是不是计数器？<code>http://localhost:8080/#/about</code> 是不是我们的 <code>About</code> 页面？</p>\n<h2 id=\"其他内容\" style=\"position:relative;\">其他内容<a href=\"#%E5%85%B6%E4%BB%96%E5%86%85%E5%AE%B9\" aria-label=\"其他内容 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>这里讲解了基本的路由的构建，当然路由还不仅仅有这些内容啦，还有 <code>&#x3C;Link></code> <code>pushState</code> 等等内容，其中 <code>&#x3C;Link></code> 的内容可以到 <a href=\"https://github.com/reactjs/react-router-tutorial\">https://github.com/reactjs/react-router-tutorial</a>\n来看，然后其他部分在以后遇到的时候再解释。</p>\n<h2 id=\"参考\" style=\"position:relative;\">参考<a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ol>\n<li><a href=\"https://github.com/reactjs/react-router-redux\">react-router-redux</a></li>\n<li><a href=\"https://github.com/reactjs/react-router\">react-router</a></li>\n<li><a href=\"https://github.com/reactjs/react-router-tutorial\">react-router-tutorial</a></li>\n</ol>","tableOfContents":"<ul>\n<li><a href=\"#prepare-package-for-react-router\">prepare package for react-router</a></li>\n<li><a href=\"#%E6%9B%B4%E6%96%B0%E4%BB%A3%E7%A0%81%E6%94%AF%E6%8C%81-router\">更新代码支持 Router</a></li>\n<li><a href=\"#%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E8%A7%86%E5%9B%BE\">添加一个新的视图</a></li>\n<li><a href=\"#%E5%85%B6%E4%BB%96%E5%86%85%E5%AE%B9\">其他内容</a></li>\n<li><a href=\"#%E5%8F%82%E8%80%83\">参考</a></li>\n</ul>","frontmatter":{"title":"Redux with react router","date":"May 12, 2016"},"excerpt":"沿着上一部分 Redux With React，在利用 redux 与 react 构建了单个视图…"}},"pageContext":{"id":"ef9d7be5-2e00-50d8-9801-e8106b35f920"}},
    "staticQueryHashes": ["4202924991"]}