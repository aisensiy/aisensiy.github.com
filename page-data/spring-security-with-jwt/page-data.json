{"componentChunkName":"component---src-templates-blog-js","path":"/spring-security-with-jwt/","result":{"data":{"blog":{"id":"69433720-0a26-522b-8342-9915cc7277d8","html":"<p>突然发现除了<a href=\"/spring-cors-and-security\">跨域问题</a>之外从来没有好好记录过 Spring Security 的其他内容。最近也是比较系统的看了些资料，这里就算是做一个总结吧，方便后面忘记了回看。</p>\n<p>这里只介绍怎么把 jwt 的流程跑通以及对关键的代码做解释，不涉及 Authorization 部分，同时也只有 username password 单一的 authentication 流程，不涉及其他。</p>\n<h2 id=\"关键概念解释\" style=\"position:relative;\">关键概念解释<a href=\"#%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5%E8%A7%A3%E9%87%8A\" aria-label=\"关键概念解释 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>首先要明白 spring security 主要通过 filter 拦截请求并做处理的，在 <a href=\"/servlet-and-filter-with-web-framework\">有关 servlet 和 filter 的基础知识</a> 已经做了介绍。</p>\n<p>在 Spring Security 有一个概念 <code>Authentication</code> 它同时记录了一个用户授权的凭证（Credentials）以及验证通过后的产物（Principal）。而负责这个凭据验证并基于 Principal 的东西就是 <code>AuthenticationProvider</code>。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e1d64627c81bf20bc5344f3d928d8257/6029f/2021-04-12-23-24-37.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFklEQVQ4y5VSiW7aQBD1b7ff1kRR2lShgCtSQwg2GJ/r9XoNNr45XjRLjEKVSulIT571zr55c2hFUcAwppjNnmH8mSqwMIJMJOiO7HQ6/RPH01HF7Nodvn7/Ak3KFAtrDo+vIPIQ4caBrCKkeYzdbof/MZ5xaEVeICkZvHyOdTqDvzUR5BaCxEae5yqwrmtUVaUUbzYbSCmvkKYpRCxQFRW0tu3gMhuBWENsIvCEIYx9BJGHtm1RNzXiOFbkpHi/3+N4POJwOFxApVPSRCbQ6EAPGWO4+XYLfayjbVrkWa4el2WpcLGTauo1AEVMSjVyqIw0lWAsvKihLynq2hZZnn2qh4mUZ4VUAqH33xvlF1GEmnFUAUPNBVq5QSMk6jBCEycXX8QxtH4t/rY+Ad4IGy5QBREqP1SkKoHPzklYjCYSZ8L+EU1xsVjANE1st9srUiqFbF+UKEwb5dJBHXKUaw/FysGhrNQ9TVzrFdFQJpMJxuMxooipPmbZuXfUbHxQxXvbd50SovUrYBgG5vMXTI0ZxiMdS2uFJEnQdR2EEGriCl13Bbqn/1QhxWm0rKSElOmTEUz7GS/2FCzx4XqOWh/XdeC67hs8eJ6n/P5r2zYcxzkTcs4R+gz6bIDfqwcY9giD+S2ezF/Qn4bgUaxW6ENwfnUmLm25XKpB3D/c4f7xBj8Gd3gc/sRg+IjReAS6tyzrU6DYV6dSJI+QJX2yAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2021 04 12 23 24 37\"\n        title=\"2021 04 12 23 24 37\"\n        src=\"/static/e1d64627c81bf20bc5344f3d928d8257/5a190/2021-04-12-23-24-37.png\"\n        srcset=\"/static/e1d64627c81bf20bc5344f3d928d8257/772e8/2021-04-12-23-24-37.png 200w,\n/static/e1d64627c81bf20bc5344f3d928d8257/e17e5/2021-04-12-23-24-37.png 400w,\n/static/e1d64627c81bf20bc5344f3d928d8257/5a190/2021-04-12-23-24-37.png 800w,\n/static/e1d64627c81bf20bc5344f3d928d8257/6029f/2021-04-12-23-24-37.png 906w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>然后一个系统可能会支持多种凭据，比如最典型的 UsernamePasswordAuthentication 也可以是通过 OAuth 的 Authentication。为了处理不同的授权流程，Spring Security 有另外一个概念 <code>AuthenticationManager</code> 用于管理多个 <code>AuthenticationProvider</code>：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/395e312f669700efde6155bce5e7b201/a0730/2021-04-12-23-32-28.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACEUlEQVQ4y4VTaW/aQBD1//87nAFUlQ/QNuFMyEEVsCkE3PjC62Pt9cKrZsAoKZW60tPMzs4+vZmdNbTWWCwWWK/X2G63bB8fn7BcLmGaJjzPw8PDA8fTNEUkIiRJwn4JKSWDfMN1XaxWK+x2O74URRHCMEQcx2xpv9/vEQoBQX64RxAETEo5JYhss9nAcBwH/1s6V1BhBC1iFCLCQet/5pEAQwiBPM85cDwer5LiPIRI95BugHhjQ8UJikJd8kvQItVMmGXZSYnWKIqCoQsNqRIkSkAVBZfFZSbJlYDS+r7/WSE1Vh809OHApDKTHFdKQRXqFNea8z+SlT6170R4VpiKCCoIkXkBcn/PpVHJQeQgcwPIdxe56yNP5Ynkr5LpgQ16xVJhJiU3n8hUFCNXGY44sDoZCoi3HTKOq6t+055e36C6qT/FuU/UoySlkUgQRgGyXCKTGY+M+DBS3IYz6C4J4x6WM0gbklzCcz04zjus7Ss2b7/w27Z5yF3HhW3bn3J9z2cOy7JgzGYzzOdzWKbJv6P8Iaa5hGVaWCxf8TJ/xstwjKfvd5iPJvj5/IIl55zuEFHJY/T7fQyHQw7c398zptMpJpMJg/zhaITbfh/fvnzF3Y9bDAaDyxmB7vZ6PYzHYxitVgvNZhOdTgftdptB+3q9jkajwSC/WquhSrZaRa1Wu5zd3NywrVQq6Ha7+AORis91ptOV0wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2021 04 12 23 32 28\"\n        title=\"2021 04 12 23 32 28\"\n        src=\"/static/395e312f669700efde6155bce5e7b201/5a190/2021-04-12-23-32-28.png\"\n        srcset=\"/static/395e312f669700efde6155bce5e7b201/772e8/2021-04-12-23-32-28.png 200w,\n/static/395e312f669700efde6155bce5e7b201/e17e5/2021-04-12-23-32-28.png 400w,\n/static/395e312f669700efde6155bce5e7b201/5a190/2021-04-12-23-32-28.png 800w,\n/static/395e312f669700efde6155bce5e7b201/a0730/2021-04-12-23-32-28.png 1131w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>而具体到我们这次要构建的 JwtUsernamePassword 的流程，当我们登录的时候需要拿着登录信息（username + password）去数据库（或者其他地方）校验有没有这样子的组合，而这个地方 Spring Security 也抽取了概念叫做 <code>UserDetailsService</code>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/02d0ffa1cbb85e4e5ecafb8addf28a32/302a4/2021-04-12-23-37-33.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/0lEQVQY021QW5KEIAz0/lfzAjt/lliuOgoCyht7Klmdr01VoBJCp7sbALiuC6UU1FJRS+H6v6A+5XEcMMbAWMuptUYIgWcaGkgpIeWMVDJiSogx8mOtlT/SB0oKWqykQkkZKUbknOGcw77vNyAuROcRtUUyB6I2SPc2YtL3PcZxxDzP2LYNlhgphTC94X4XhGXDuazfhQ0dxCjuBuEt/wBvhuu6Msg0TZBSMgvvPYzWSLuBXxXCqnBKxUoYkGQRoA+BfXDe8019suI8T7Rti5/Xi2uafeQ9kWvhHtnXEFUqlFLfpPrxjSQSQ5JsjeV3skEIAdH3GIRA13UYhoFnPyMwz0KaAT2oAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2021 04 12 23 37 33\"\n        title=\"2021 04 12 23 37 33\"\n        src=\"/static/02d0ffa1cbb85e4e5ecafb8addf28a32/5a190/2021-04-12-23-37-33.png\"\n        srcset=\"/static/02d0ffa1cbb85e4e5ecafb8addf28a32/772e8/2021-04-12-23-37-33.png 200w,\n/static/02d0ffa1cbb85e4e5ecafb8addf28a32/e17e5/2021-04-12-23-37-33.png 400w,\n/static/02d0ffa1cbb85e4e5ecafb8addf28a32/5a190/2021-04-12-23-37-33.png 800w,\n/static/02d0ffa1cbb85e4e5ecafb8addf28a32/302a4/2021-04-12-23-37-33.png 1080w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Spring Security 有提供一个名为 <code>WebSecurityConfigurerAdapter</code> 的基类，它已经提供了基本的框架，我们通常只需要对需要自定义的地方做覆盖即可。</p>\n<p>那么总结下具体要做什么：</p>\n<ol>\n<li>增加一个 InMemoryUserDetailsManager 假装是个数据库。</li>\n<li>完成两个 Filter：\n<ol>\n<li><code>JwtUsernameAndPasswordAuthenticationFilter</code> 覆盖默认的 <code>UsernamePasswordAuthenticationFilter</code> 支持依据请求生成 jwt token</li>\n<li><code>JwtTokenVerifier</code> 检查请求的 header <code>Authorization</code> 获取并验证所附带的 token 判断这个 token 是否合法并返回对应的 Principle</li>\n</ol>\n</li>\n<li>覆盖 <code>WebSecurityConfigurerAdapter.configure</code> 把以上配置传起来</li>\n</ol>\n<h2 id=\"基本依赖\" style=\"position:relative;\">基本依赖<a href=\"#%E5%9F%BA%E6%9C%AC%E4%BE%9D%E8%B5%96\" aria-label=\"基本依赖 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>首先 gradle 依赖如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"gradle\"><pre class=\"language-gradle\"><code class=\"language-gradle\"><span class=\"token keyword\">dependencies</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">implementation</span> <span class=\"token string\">'org.springframework.boot:spring-boot-starter-security'</span>\r\n    <span class=\"token keyword\">implementation</span> <span class=\"token string\">'org.springframework.boot:spring-boot-starter-validation'</span>\r\n    <span class=\"token keyword\">implementation</span> <span class=\"token string\">'org.springframework.boot:spring-boot-starter-web'</span>\r\n    compileOnly <span class=\"token string\">'org.projectlombok:lombok'</span>\r\n\r\n    compile <span class=\"token string\">'io.jsonwebtoken:jjwt-api:0.11.2'</span>\r\n    runtime <span class=\"token string\">'io.jsonwebtoken:jjwt-impl:0.11.2'</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token comment\">// Uncomment the next line if you want to use RSASSA-PSS (PS256, PS384, PS512) algorithms:</span>\r\n            <span class=\"token comment\">//'org.bouncycastle:bcprov-jdk15on:1.60',</span>\r\n            <span class=\"token string\">'io.jsonwebtoken:jjwt-jackson:0.11.2'</span> <span class=\"token comment\">// or 'io.jsonwebtoken:jjwt-gson:0.11.2' for gson</span>\r\n\r\n    annotationProcessor <span class=\"token string\">'org.springframework.boot:spring-boot-configuration-processor'</span>\r\n    annotationProcessor <span class=\"token string\">'org.projectlombok:lombok'</span>\r\n    testImplementation <span class=\"token string\">'org.springframework.boot:spring-boot-starter-test'</span>\r\n    testImplementation <span class=\"token string\">'org.springframework.security:spring-security-test'</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>通过 <a href=\"https://start.spring.io\">start.spring.io</a> 创建的项目，添加了以下依赖：</p>\n<ul>\n<li>web</li>\n<li>validation</li>\n<li>lombok</li>\n<li>spring security</li>\n</ul>\n<p>同时增加了一个 jwt 解析的类库 <a href=\"https://github.com/jwtk/jjwt\">jjwt</a>。</p>\n<h2 id=\"websecurityconfig\" style=\"position:relative;\">WebSecurityConfig<a href=\"#websecurityconfig\" aria-label=\"websecurityconfig permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>增加一个 <code>InMemoryUserDetailsManager</code>，只有一个用户：</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebSecurityConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n  \r\n  <span class=\"token annotation punctuation\">@Override</span>\r\n  <span class=\"token annotation punctuation\">@Bean</span>\r\n  <span class=\"token keyword\">protected</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token function\">userDetailsService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InMemoryUserDetailsManager</span><span class=\"token punctuation\">(</span>\r\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span> passwordEncoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"NORMAL\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>覆盖 <code>configure</code>，增加上述提及的 Filter:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebSecurityConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token annotation punctuation\">@Override</span>\r\n  <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\r\n    http<span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// disable csrf</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sessionCreationPolicy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SessionCreationPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STATELESS</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 不再使用 cookie 管理 session</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">addFilter</span><span class=\"token punctuation\">(</span>\r\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">JwtUsernameAndPasswordAuthenticationFilter</span><span class=\"token punctuation\">(</span>\r\n                <span class=\"token function\">authenticationManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> jwtConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 增加用户密码校验的 Filter</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">addFilterAfter</span><span class=\"token punctuation\">(</span>\r\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">JwtTokenVerifier</span><span class=\"token punctuation\">(</span>jwtConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token class-name\">JwtUsernameAndPasswordAuthenticationFilter</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 增加 token 校验的 Filter</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"jwtusernameandpasswordauthenticationfilter\" style=\"position:relative;\">JwtUsernameAndPasswordAuthenticationFilter<a href=\"#jwtusernameandpasswordauthenticationfilter\" aria-label=\"jwtusernameandpasswordauthenticationfilter permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JwtUsernameAndPasswordAuthenticationFilter</span> <span class=\"token keyword\">extends</span>\r\n    <span class=\"token class-name\">UsernamePasswordAuthenticationFilter</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">AuthenticationManager</span> authenticationManager<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">JwtConfig</span> jwtConfig<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">JwtUsernameAndPasswordAuthenticationFilter</span><span class=\"token punctuation\">(</span>\r\n      <span class=\"token class-name\">AuthenticationManager</span> authenticationManager<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 1</span>\r\n      <span class=\"token class-name\">JwtConfig</span> jwtConfig<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authenticationManager <span class=\"token operator\">=</span> authenticationManager<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jwtConfig <span class=\"token operator\">=</span> jwtConfig<span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token annotation punctuation\">@Override</span>\r\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">Authentication</span> <span class=\"token function\">attemptAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span>\r\n      <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">AuthenticationException</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 2</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token class-name\">UsernamePasswordRequest</span> param <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n          <span class=\"token punctuation\">.</span><span class=\"token function\">readValue</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UsernamePasswordRequest</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n      <span class=\"token class-name\">Authentication</span> authentication <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UsernamePasswordAuthenticationToken</span><span class=\"token punctuation\">(</span>\r\n          param<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n          param<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">return</span> authenticationManager<span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span>authentication<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> io<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token annotation punctuation\">@Override</span>\r\n  <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">successfulAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span>\r\n      <span class=\"token class-name\">FilterChain</span> chain<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Authentication</span> authResult<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 3</span>\r\n    <span class=\"token class-name\">String</span> token <span class=\"token operator\">=</span> <span class=\"token class-name\">Jwts</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">setSubject</span><span class=\"token punctuation\">(</span>authResult<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">claim</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"authorities\"</span><span class=\"token punctuation\">,</span> authResult<span class=\"token punctuation\">.</span><span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>\r\n            <span class=\"token class-name\">GrantedAuthority</span><span class=\"token operator\">::</span><span class=\"token function\">getAuthority</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">setIssuedAt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">setExpiration</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span>Date</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LocalDate</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">plusDays</span><span class=\"token punctuation\">(</span>jwtConfig<span class=\"token punctuation\">.</span><span class=\"token function\">getDays</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">signWith</span><span class=\"token punctuation\">(</span>jwtConfig<span class=\"token punctuation\">.</span><span class=\"token function\">getSecretKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    response<span class=\"token punctuation\">.</span><span class=\"token function\">addHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Bearer \"</span> <span class=\"token operator\">+</span> token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol>\n<li>从 <code>WebSecurityConfig</code> 那边获取的 <code>AuthenticationManager</code> 里面其实就是一个默认的 <code>UsernamePasswordProvider</code> 里面用的就是我们上文配置的 <code>InMemoryUserDetailsManager</code>。</li>\n<li>尝试验证，可以看到就是把 <code>{\"username\": \"username\", \"password\": \"password\"}</code> 这种格式的 request body 做解析，然后让给 <code>AuthenticationManager</code>。</li>\n<li>生成 token，懂 jwt 的话就知道就是那么几个东西：\n<ol>\n<li>subject 里面是 username</li>\n<li>claim 一些 key-value，这里塞了权限列表</li>\n<li>issueAt 创建时间</li>\n<li>expiration 过期时间</li>\n</ol>\n</li>\n</ol>\n<blockquote>\n<p><strong>注意</strong> 其实很多时候这个 Filter 可能是一个独立的 Controller 会比较舒服一些吧，相比下文的 JwtVerifier 这个 Filter 基本就是强行复用了 Spring Security 的逻辑。</p>\n</blockquote>\n<h2 id=\"jwttokenverifier\" style=\"position:relative;\">JwtTokenVerifier<a href=\"#jwttokenverifier\" aria-label=\"jwttokenverifier permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JwtTokenVerifier</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">OncePerRequestFilter</span> <span class=\"token punctuation\">{</span>\r\n\r\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">JwtConfig</span> jwtConfig<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">JwtTokenVerifier</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">JwtConfig</span> jwtConfig<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jwtConfig <span class=\"token operator\">=</span> jwtConfig<span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isNullOrEmpty</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> str<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">return</span> str <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token annotation punctuation\">@Override</span>\r\n  <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doFilterInternal</span><span class=\"token punctuation\">(</span>\r\n      <span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">FilterChain</span> filterChain<span class=\"token punctuation\">)</span>\r\n      <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token class-name\">String</span> authorizationHeader <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isNullOrEmpty</span><span class=\"token punctuation\">(</span>authorizationHeader<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>authorizationHeader<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bearer \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      filterChain<span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token class-name\">String</span> token <span class=\"token operator\">=</span> authorizationHeader<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bearer \"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token class-name\">Jws</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Claims</span><span class=\"token punctuation\">></span></span> claimsJws <span class=\"token operator\">=</span>\r\n          <span class=\"token class-name\">Jwts</span><span class=\"token punctuation\">.</span><span class=\"token function\">parserBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token punctuation\">.</span><span class=\"token function\">setSigningKey</span><span class=\"token punctuation\">(</span>jwtConfig<span class=\"token punctuation\">.</span><span class=\"token function\">getSecretKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token punctuation\">.</span><span class=\"token function\">parseClaimsJws</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token class-name\">Claims</span> body <span class=\"token operator\">=</span> claimsJws<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token class-name\">String</span> username <span class=\"token operator\">=</span> body<span class=\"token punctuation\">.</span><span class=\"token function\">getSubject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> authorities <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span> body<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"authorities\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token punctuation\">></span></span> simpleGrantedAuthorities <span class=\"token operator\">=</span>\r\n          authorities<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token class-name\">Authentication</span> authentication <span class=\"token operator\">=</span> \r\n          <span class=\"token keyword\">new</span> <span class=\"token class-name\">UsernamePasswordAuthenticationToken</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> simpleGrantedAuthorities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span>\r\n      <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAuthentication</span><span class=\"token punctuation\">(</span>authentication<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">JwtException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalStateException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Token %s cannot be trusted\"</span><span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    filterChain<span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol>\n<li>创建一个 <code>UsernamePasswordAuthenticationToken</code> 注意，这里的第一个参数未必要 String 的，可以是任意类型的，这里只是一个 String 为例了</li>\n<li>把 <code>Authentication</code> 传递给 <code>SecurityContextHolder</code> 之后同一线程下就可以获取它并做进一步的权限验证了</li>\n</ol>\n<h2 id=\"参考资料\" style=\"position:relative;\">参考资料<a href=\"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99\" aria-label=\"参考资料 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>感觉最有用的就是这里的视频呢...</p>\n<ol>\n<li><a href=\"https://www.youtube.com/watch?v=caCJAJC41Rk\">How Spring Security Authentication works - Java Brains</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=her_7pa0vrg\">Spring Security - FULL COURSE</a></li>\n</ol>","tableOfContents":"<ul>\n<li><a href=\"#%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5%E8%A7%A3%E9%87%8A\">关键概念解释</a></li>\n<li><a href=\"#%E5%9F%BA%E6%9C%AC%E4%BE%9D%E8%B5%96\">基本依赖</a></li>\n<li><a href=\"#websecurityconfig\">WebSecurityConfig</a></li>\n<li><a href=\"#jwtusernameandpasswordauthenticationfilter\">JwtUsernameAndPasswordAuthenticationFilter</a></li>\n<li><a href=\"#jwttokenverifier\">JwtTokenVerifier</a></li>\n<li><a href=\"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99\">参考资料</a></li>\n</ul>","frontmatter":{"title":"Spring Security Jwt 的实现","date":"April 12, 2021","tags":["web","spring","springboot","jwt"]},"excerpt":"突然发现除了跨域问题之外从来没有好好记录过 Spring Security 的其他内容。最近也是比…"}},"pageContext":{"id":"69433720-0a26-522b-8342-9915cc7277d8"}},"staticQueryHashes":["26522286"],"slicesMap":{}}