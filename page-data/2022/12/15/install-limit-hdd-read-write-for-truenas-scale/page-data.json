{"componentChunkName":"component---src-templates-blog-js","path":"/2022/12/15/install-limit-hdd-read-write-for-truenas-scale/","result":{"data":{"blog":{"id":"fcc06d0e-1111-5836-a906-c4113d02cfc7","html":"<p>最近攒了一台机器作为家里的 NAS，操作系统选择了 <a href=\"https://www.truenas.com/truenas-scale/\">TrueNAS Scale</a> ，之所以用这个系统原因有两个：</p>\n<ol>\n<li>它是基于 Debian 的，对我来说比较熟悉，FreeBSD 什么的实在是有点陌生，并且据说那边的驱动跟进也不是很好（当然是据说，我没实操过）</li>\n<li>TrueNAS Scale 里面的 App Store 是基于 <a href=\"https://helm.sh/docs/topics/charts/\">helm charts</a> 的，TrueNAS Scale 在开启 Apps 这个功能后会跑了一个 <a href=\"https://k3s.io/\">k3s</a> 来管理这些 apps 这个操作着实有点激进，不过我还是愿意尝试一下的，也是因为我对这些东西比较熟悉</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a578be5b7e6dc1225428bcdb2b1ea2ab/70d4c/screenshot-of-truenas-scale-applications.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACWUlEQVQozyWR227bRgBE9RORqUK2xeuSFMnd5fIiUqZk2XJkyY6rSg4c59YUQYoGTfvQAEWBAn0r+tmnrfw2GAwOBjM9P8k4dX2CIGA4HGJZFoNnFoO+hTWweNbv0z86Ovj9vsXR0ZNvDb455INAIMcxIq8YzV/QM7km8H1kmqGUxvMCRrmHI32ckUMSCYTvcXo6IowcXNfGHtk4x0Ncx0aIkMQUeGHMcSzpKZ3jnAzJV/d0jz9hgpDBhw0nHzdoP+T6/WfmN1sSIZDvduSLDplkWHmHKisyUyG//EPZnhH7Lj2ZGzzXQUiDajrSZIwqZuT1DDke419dksw6UhEw//Vv2vUWlSbo8y3KVChTsP/yF9VkihCCXpqmuK5D3syZLW/QKiOeLkmni8M20cVzZDcjiyPGt4+YboFWkpNmgyxrdF6yuf+Tom4RIqAXhiGO61CYM866FTJLsCfPCSYXqCTGnSxJJ92h1XG1ZFw0aJlys5Q0lcbkOZ/v31CXxeGgXhRF2I7HZR6ymBlkKom6CjVvyKWm7hR1a8hSyflS005LtNZ8v0o4qySqKLj77Q/KpiEUB2CI7Xp0JuDFuSKVhjePSx5eXuH7ER/eX7PfrajKitvXr+kWl4eGb3/+yqQ7R8sx64sxbVsTRfETcGR7XDQh++uCOFU87m55ud0QxgnbTcl6NaUyE6Y/TqmuKlSSsX3YUU8atM64fLijrIqnU+Io4vjU5dU65pe3NUEs+WG34d1+g/hf30u+XZekccH17zbtXYpKcu6+M7RtgSkN+6+fmLQ14r8N/wVzU0KRIuQ+CQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot of truenas scale applications\"\n        title=\"screenshot of truenas scale applications\"\n        src=\"/static/a578be5b7e6dc1225428bcdb2b1ea2ab/5a190/screenshot-of-truenas-scale-applications.png\"\n        srcset=\"/static/a578be5b7e6dc1225428bcdb2b1ea2ab/772e8/screenshot-of-truenas-scale-applications.png 200w,\n/static/a578be5b7e6dc1225428bcdb2b1ea2ab/e17e5/screenshot-of-truenas-scale-applications.png 400w,\n/static/a578be5b7e6dc1225428bcdb2b1ea2ab/5a190/screenshot-of-truenas-scale-applications.png 800w,\n/static/a578be5b7e6dc1225428bcdb2b1ea2ab/c1b63/screenshot-of-truenas-scale-applications.png 1200w,\n/static/a578be5b7e6dc1225428bcdb2b1ea2ab/29007/screenshot-of-truenas-scale-applications.png 1600w,\n/static/a578be5b7e6dc1225428bcdb2b1ea2ab/70d4c/screenshot-of-truenas-scale-applications.png 2548w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>基本环境准备好了之后把由 5 块 HDD 组成的 RaidZ1 作为了主存储池就开始使用了。用了一段时间发现系统有一个小小的问题：这些 HDD 差不多每几秒就会卡卡响两下，不是什么异常的声音，就是正常的读写的声音，可我当时并没有使用它做什么事情，而且这种有节奏的噪音让我也有点难受。看了下监控，io 模式就是这个样子：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e55ea95fb90db25137b7aefdf1354cf/00e09/truenas-scale-hdd-idle-read-write.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbklEQVQI1y3OQQ4EIQhEUU8jUEJBd6KdzP0PNtHI6vFX1dZaz/uqqJmZmp4zvbb73UKGu1dVRIhIc3cIXMeQAbUNHVBAMY5Px1CY2Pf9qpLknDMiGklKZX+yV/RkL/ZMKUqeXrGx7RIA9j49M83+zmIeX4r/0z8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"truenas scale hdd idle read write\"\n        title=\"truenas scale hdd idle read write\"\n        src=\"/static/1e55ea95fb90db25137b7aefdf1354cf/5a190/truenas-scale-hdd-idle-read-write.png\"\n        srcset=\"/static/1e55ea95fb90db25137b7aefdf1354cf/772e8/truenas-scale-hdd-idle-read-write.png 200w,\n/static/1e55ea95fb90db25137b7aefdf1354cf/e17e5/truenas-scale-hdd-idle-read-write.png 400w,\n/static/1e55ea95fb90db25137b7aefdf1354cf/5a190/truenas-scale-hdd-idle-read-write.png 800w,\n/static/1e55ea95fb90db25137b7aefdf1354cf/c1b63/truenas-scale-hdd-idle-read-write.png 1200w,\n/static/1e55ea95fb90db25137b7aefdf1354cf/29007/truenas-scale-hdd-idle-read-write.png 1600w,\n/static/1e55ea95fb90db25137b7aefdf1354cf/00e09/truenas-scale-hdd-idle-read-write.png 2195w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>首先我就去 google 了，搜来搜去，用关键词「truenas scale idle read write」找到了 <a href=\"https://www.reddit.com/r/truenas/comments/u3zxpn/truenas_scale_constant_writes_while_idle/\">TrueNas Scale constant writes while idle</a> 这个问题，下面的回复基本就就是清楚了原因，我这里简单复述下：</p>\n<p>TrueNAS 会默认把你建立的第一个 data pool 设定为 System Dataset 然后会在这里塞日志等乱七八糟的东西，尤其是系统日志这种东西它就会持续的对系统进行写入。</p>\n<p>既然 HDD 读写声音很讨厌，那我就还是再加一个 nvme 的盘做成存储池来用吧，幸好我的主板 m.2 的插槽管够。插上 nvme 硬盘并设置一个新的存储池后，通过「System Settings」-「Advanced」-「System Dataset Pool」把它修改成心态添加的 nvme 存储即可。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/890801d921fdc4b0f9de13fb60be5602/a3a5c/config-system-dataset.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACM0lEQVQ4y3WUzY4aQQyE5xWIQBBgyADzx8DA8A+7BCEQWuWSQ3LLJZHyKnnvij7vmpCIHKyettvlKrt7gk5RqZFM1GiHarZaqtXeqVarqV6vPzRio9FIWZap3W4rz3MNokjD6INazaaCxbxSkaVK4ljzzU6Hj0etlkt1w1BhGKrX66nb7Voye747nY6t3V5PYbOu5tMnNX7+0vtyrWA6nSrLc6VpqjzLxJ7vKIrU7/dthcVsNtNwODRmg8HAYrZGkeJiovnxomGaK5jP5xqPx0qSRJPJROv12iThw/herVY6nU623263txiFKFCOx7qcjiqKkYKqqiwJVkVRaLlcGsBisbACZVlazNnhJwc/gA4ax7ExNkCAcLo0L4DP/Z5IPPcWvfkxMAC9MUQyMmCI0cv7BC9AzNv0bzFUBJVV/MMIBsghAR+F8COfPXGKeUHi3n/WYDadalKWStLUmG42GwODPkDe28PhYCtDo8esgAPCGeLkBU77ng2SdrudgVPZe+pxwJi2n/EZmOR7QFg5I5fth33SSRKbXGIUw1y6TdkBvQ8MiUSMAvhN8vOzptVCL1++6+XrD10+f1M+Kuwcedfr1c79xZBvZ4cspBPziz4qCu2eDtruD1qut+b3K8NZMG6A/qQwvz6w9ek660G/b8+NFb/31mKPJO/3e6v82q/Xg0z1fD7fbgEDYfUX8lCyA3KYppPskvD7C6IVmD+I/0pmA+X7Ybj5O2V19q7A4+z5A/0GgLb33U2VJAEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"config system dataset\"\n        title=\"config system dataset\"\n        src=\"/static/890801d921fdc4b0f9de13fb60be5602/5a190/config-system-dataset.png\"\n        srcset=\"/static/890801d921fdc4b0f9de13fb60be5602/772e8/config-system-dataset.png 200w,\n/static/890801d921fdc4b0f9de13fb60be5602/e17e5/config-system-dataset.png 400w,\n/static/890801d921fdc4b0f9de13fb60be5602/5a190/config-system-dataset.png 800w,\n/static/890801d921fdc4b0f9de13fb60be5602/c1b63/config-system-dataset.png 1200w,\n/static/890801d921fdc4b0f9de13fb60be5602/a3a5c/config-system-dataset.png 1277w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>如果要使用上文提到的 Apps 的话，TrueNAS Scale 也会要求你指定存储的位置，考虑到性能和噪声也要把它指向 nvme 的存储。</p>\n<p>所以对于 TrueNAS Scale 来说，最好要准备三个部分的存储：</p>\n<ol>\n<li>系统盘，16 GB 就够了（此处应该有傲腾 M10）：TrueNAS 就是把系统放这里，其他乱七八糟的东西统统要放到额外的存储池里</li>\n<li>主存储，就是放数据的地方，要做好冗余方案：我这里依然选择了老土 HDD，当然还是考虑到价格比较便宜</li>\n<li>应用存储，可以认为是工作空间：把系统日志，Apps 的一些配置什么的都扔这里，对我来说这些数据不是那么重要，我直接就放了一个 m.2 的 nvme。由于这个空间会因为 Apps 的各种操作和系统日志而频繁读写，使用 ssd 很有必要</li>\n</ol>","tableOfContents":"","frontmatter":{"title":"解决 TrueNAS Scale HDD 硬盘莫名读写的问题","date":"December 15, 2022","tags":["homelab","truenas scale","hdd","nvme"]},"excerpt":"最近攒了一台机器作为家里的 NAS，操作系统选择了 TrueNAS Scale ，之所以用这个系统…"}},"pageContext":{"id":"fcc06d0e-1111-5836-a906-c4113d02cfc7"}},"staticQueryHashes":["26522286"],"slicesMap":{}}