{
    "componentChunkName": "component---src-templates-blogs-js",
    "path": "/page/5",
    "result": {"data":{"site":{"siteMetadata":{"title":"eisen-s-blog"}},"blogs":{"nodes":[{"id":"09d66859-381f-5b03-98fb-8c1a36f6164b","frontmatter":{"title":"初识 tailwindcss","date":"2021 July-27"},"html":"<p>在 <a href=\"/blog-migrate-from-jekyll-to-gatsby\">上一篇文章</a> 中提到了已经在自己的新博客中集成了 tailwindcss 。这篇对这个思路不太一样的 css 框架做一些介绍。</p>\n<h2 id=\"核心思想\" style=\"position:relative;\">核心思想<a href=\"#%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3\" aria-label=\"核心思想 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>用过 bootstrap 的人都晓得，bootstrap 提供了如下内容：</p>\n<ol>\n<li>一套默认的样式，比如 <code>h1</code> 长什么样 <code>button.btn</code> 长什么样</li>\n<li>一套布局系统，默认 12 列，实现各种宽度组合</li>\n<li>一套通用组件库，比如面包屑，比如下拉菜单</li>\n</ol>\n<p>和 bootstrap 体系几乎一样的东西还很多，比如当年雅虎的 <a href=\"https://purecss.io/start/\">purecss</a>。</p>\n<p>相比于 bootstrap 这种被大家所广泛认知的 css 框架，tailwindcss 有如下差别：</p>\n<ol>\n<li>\n<p>没有默认样式，单有一套 reset 样式，将所有的东西设置为一样的大小，比如 <code>h1</code> <code>h2</code> <code>p</code> 的字号、颜色都一样</p>\n</li>\n<li>\n<p><strong>所有的</strong> css 样式完全通过\b一系列工具类（utility classes）组合实现，比如一个 <code>button</code> 可以这么实现：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rounded-md shadow<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>w-full flex items-center justify-center\n                      px-8 py-3 border border-transparent\n                      text-base font-medium rounded-md \n                      text-white bg-indigo-600 hover:bg-indigo-700 md:py-4 md:text-lg\n                      md:px-10<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    Get started\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>结果如下：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 214px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1043675ef3ac07d2de7589612fa6067d/a48b3/2021-07-27-20-05-13.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVQoz62S20obURSG80wFaURTNWPUxEPiATyBRbRqPGEQQbEaxMOFCj6CF32IKqGX7X19AZPM7MyMF1YFYyaZ+MmaSYjSi4KUzbf/Wf/e87OGWQGnXKHk/B+cskug5LhUn9+PK4pLxXW90AC4fDu/Zf6zRSpps7bQoF6LpuqatP+6t/LF4ur3I5LlBX7dsAh9yNPbbtAT0om06GjNOuFg7Tmo0yn1R9/Xan70k0GszaC9Sefy+x1Q9QMPdm7oDhkMRxVDPYrVOZO1BcFierRAKmmxOG2yvmSyPFPwzuanCvRripGY8kJ/ZO4bgfs7Nl2tOkNRxWC3YmPV5PTIJr1pszJrsbdtc7hrkd40PU4OxS/Q2+E3IZ2+CUxv2WhBg0SXoj+s6Asr7/MF6UJeFF866etQPmHFgKaIRxSRFoPMxavAs+Mb4pE8k4MG4/EaCZ+xWj1W9+JvmUgYDMd0fv188H9KueJy+8che/1ILlckly36+i+yDc3nixSf/FkMyCYz9Ez13ciSoZbBfgGPeYS53SLSWAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2021 07 27 20 05 13\"\n        title=\"2021 07 27 20 05 13\"\n        src=\"/static/1043675ef3ac07d2de7589612fa6067d/a48b3/2021-07-27-20-05-13.png\"\n        srcset=\"/static/1043675ef3ac07d2de7589612fa6067d/772e8/2021-07-27-20-05-13.png 200w,\n/static/1043675ef3ac07d2de7589612fa6067d/a48b3/2021-07-27-20-05-13.png 214w\"\n        sizes=\"(max-width: 214px) 100vw, 214px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>默认没有提供通用组建库，不过这部分我认为更多还是一个商业上的考虑</p>\n</li>\n</ol>\n<p>其中第二条算是 tailwindcss 最大的特色了，虽然 bootstrap 也包含很多工具类，但 bootstrap 的工具类并不是可以解决所有问题的，仅仅是一个辅助措施。而在 tailwindcss， 工具类就是实现 html 完整样式的最小单元。</p>\n<p>全部通过类组合类拼凑样式看起来有点丑陋，以及它违反了 html 语义化的原则。不过 tailwindcss 的作者撰写了 <a href=\"https://adamwathan.me/css-utility-classes-and-separation-of-concerns/\">一篇文章</a> 对这部分困惑做了很详尽的说明。我非常推荐直接阅读原文并阅读文中引用的另外一篇文章：<a href=\"http://nicolasgallagher.com/about-html-semantics-front-end-architecture/\">About HTML semantics and front-end architecture</a>。这里我把我理解的一些重要观点放在这里，这也是我认可 tailwindcss 并开始使用的原因。</p>\n<ol>\n<li>\n<p>语义实际上是让 css 依赖 html。在 html 结构需要扩展的时候，css 必须随之变化，而 html 确实经常变化，所以并没有省什么事</p>\n</li>\n<li>\n<p>原本的语义化思路有点问题，一个名为 <code>author</code> 的 <code>class</code> 真的有意义么？从实际角度出发， <code>class</code> 是给 <code>css</code> 用的而 <code>css</code> 关心的是样式，所以 <code>class</code> 改成 <code>media-card</code> 更合理，也就是说语义化面向的应该是 css 而不是 html 里的内容</p>\n</li>\n<li>\n<p>语义化是让 css 依赖 html 那么可不可以反过来，让 html 依赖 css？从文章 <a href=\"http://nicolasgallagher.com/about-html-semantics-front-end-architecture/\">About HTML semantics and front-end architecture</a> 获得灵感，确定反过来反而更有效：</p>\n<blockquote>\n<p>When you choose to author HTML and CSS in a way that seeks to reduce the amount of time you spend writing and editing CSS, it involves accepting that you must instead spend more time changing HTML classes on elements if you want to change their styles. This turns out to be fairly practical, both for front-end and back-end developers – anyone can rearrange pre-built “lego blocks”; it turns out that no one can perform CSS-alchemy.</p>\n</blockquote>\n<p>这里简单翻译一下：</p>\n<blockquote>\n<p>如果你试图找到一种方法来减少花费在 css 上的时间，那么你就必然会花费更多时间在 html 上。不过这种结果是更易于实施的：不论是前端工程师或是后端工程师，都更易于修改这些预定义的 \"乐高积木\"，但没人是 CSS 炼金术师（轻松驾驭编辑 CSS 代码）。</p>\n</blockquote>\n</li>\n<li>\n<p>相对于 bootstrap 更细粒度的工具类给了用户更大的自由度，可以完全脱离手写 css 而构建复杂的样式，不必再为扩展基本样式而担忧了</p>\n</li>\n<li>\n<p>之所以反对手写 css （inline style 或者类似于 styled component）是因为它会带来大量的碎片化样式，通过 tailwindcss 可以避免样式的泛滥（比如有太多种字号大小）</p>\n</li>\n</ol>\n<h2 id=\"入门资料\" style=\"position:relative;\">入门资料<a href=\"#%E5%85%A5%E9%97%A8%E8%B5%84%E6%96%99\" aria-label=\"入门资料 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>tailwindcss 的 youtube 频道里视频教程做的太好了。请把 <a href=\"https://www.youtube.com/playlist?list=PL5f_mz_zU5eXWYDXHUDOLBE0scnuJofO0\">Tailwind CSS: From Zero to Production</a> 这个系列一口气全部看完，你就可以掌握 tailwindcss 的基本用法了。</p>\n<p>看了之后你大概可以收获这些内容：</p>\n<ol>\n<li>tailwindcss 类的命名规律，你就不会太害怕自己记不住了</li>\n<li>配合使用的一些列工具是什么，比如 vscode 插件</li>\n<li>tailwindcss 怎么做响应式设计</li>\n<li>怎么扩展 tailwindcss</li>\n<li>怎么使用 purgecss 对 css 文件进行压缩</li>\n</ol>\n<h2 id=\"目前的博客是如何使用-tailwindcss-的\" style=\"position:relative;\">目前的博客是如何使用 tailwindcss 的<a href=\"#%E7%9B%AE%E5%89%8D%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%98%AF%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-tailwindcss-%E7%9A%84\" aria-label=\"目前的博客是如何使用 tailwindcss 的 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>博客的情况其实反而有点不太适合 tailwindcss 的场景，因为博客里面的 markdown 是需要从外部注入样式的，而不是像 tailwindcss 推荐的那样去对每个元素添加工具类。官方也有一篇视频 <a href=\"https://www.youtube.com/watch?v=J0Wy359NJPM\">Styling Markdown and CMS Content with Tailwind CSS</a> 介绍如何处理，这里我使用了官方的方式并且按照 <a href=\"https://sergiodxa.com/articles/use-tailwindcss-typography-with-dark-mode-styles\">Use TailwindCSS Typography with Dark Mode Styles</a> 增加了 dark mode 的支持。</p>\n<p>然后就是在 <code>global.css</code> 多了些修修补补的支持：</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@tailwind</span> base<span class=\"token punctuation\">;</span></span>\n<span class=\"token atrule\"><span class=\"token rule\">@tailwind</span> components<span class=\"token punctuation\">;</span></span>\n<span class=\"token atrule\"><span class=\"token rule\">@tailwind</span> utilities<span class=\"token punctuation\">;</span></span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@layer</span> components</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">body</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token atrule\"><span class=\"token rule\">@apply</span> bg-white <span class=\"token property\">dark</span><span class=\"token punctuation\">:</span>bg-gray-700 transition duration-500<span class=\"token punctuation\">;</span></span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">.main .permalink</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token atrule\"><span class=\"token rule\">@apply</span> fill-current text-gray-800 <span class=\"token property\">dark</span><span class=\"token punctuation\">:</span>text-gray-200<span class=\"token punctuation\">;</span></span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">.main</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token atrule\"><span class=\"token rule\">@apply</span> text-gray-800 <span class=\"token property\">dark</span><span class=\"token punctuation\">:</span>text-gray-200<span class=\"token punctuation\">;</span></span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">.main h1</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token atrule\"><span class=\"token rule\">@apply</span> text-3xl <span class=\"token property\">md</span><span class=\"token punctuation\">:</span>text-4xl font-extrabold tracking-tight my-4<span class=\"token punctuation\">;</span></span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">.main h2</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token atrule\"><span class=\"token rule\">@apply</span> mb-4 text-gray-600 <span class=\"token property\">dark</span><span class=\"token punctuation\">:</span>text-gray-300<span class=\"token punctuation\">;</span></span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">.main</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token atrule\"><span class=\"token rule\">@apply</span> break-words<span class=\"token punctuation\">;</span></span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>可以看到，响应式的支持和 dark mode 的支持都在里面了。</p>\n<h2 id=\"小结\" style=\"position:relative;\">小结<a href=\"#%E5%B0%8F%E7%BB%93\" aria-label=\"小结 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>我认为它在两个方面的工作是非常有意义的：</p>\n<ol>\n<li>将 html 和 css 的依赖反转是正确的。事实上由于业务的变化，展示信息的变化，html 的变化速度是很快的，每次让 css 被动变更确实会导致额外的工作量。中立的细粒度的 css 一定程度上会有所帮助</li>\n<li>直接在 class 上增增减减就能实现排版从认知上确实让人觉得容易了，而且有了 <code>STATE VARIANTS</code> （就是 <code>focus:</code> <code>hover:</code> <code>md:</code> 这样的前缀工具类）确实让 css 的工作变得更集中更清楚了，比一个独立的文件以及松散的排布要好</li>\n</ol>\n<p>tailwindcss 似乎在尝试将 css 乐高化以进一步降低前端工程师的门槛。但我觉得这个乐高依然是有门槛的，如果你甚至不晓得 <code>flex</code> <code>display</code> <code>position</code> <code>float</code> 这些基本的概念，那么你依然没办法去使用这些工具类。</p>","fields":{"slug_without_date":"/tailwindcss-get-started"}},{"id":"ca5034b7-1b2a-53bf-a94c-89290d8fc673","frontmatter":{"title":"把博客从 jekyll 迁移到 gatsby","date":"2021 July-17"},"html":"<p>考虑到自己的前端技能有一阵子没有更新了，同时看到刘老师用 <a href=\"https://docusaurus.io\">docusaurus</a> 把 openbayes docs 切换之后访问速度和使用体验都提升了不少，于是也想自己尝试一下 <a href=\"https://www.gatsbyjs.org/\">gatsby</a>（与 docusaurus 技术栈类似但适用范围又大大增加）。这里先拿自己的小博客开刀，把原来的 jekyll 技术栈切换过来。</p>\n<p>本来打算一小步一小步迁移过来并做比较细致的记录，结果一不小心步子迈的有点大，甚至把 tailwindcss 的部分也一口气引入到了技术栈之中。不过考虑到篇幅，这里还是会分多篇文章做介绍。首先是介绍把 jekyll 迁移到 gatsby 的部分。</p>\n<p>另，以下部分是相对比较容易通过搜索获取到的内容，对应的官方网站都有非常详尽的介绍，这里就不再赘述。</p>\n<ol>\n<li>gatsby 的基本安装</li>\n<li>graphql 的知识</li>\n</ol>\n<h2 id=\"gatsby-的思路\" style=\"position:relative;\">Gatsby 的思路<a href=\"#gatsby-%E7%9A%84%E6%80%9D%E8%B7%AF\" aria-label=\"gatsby 的思路 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>虽然 gatsby 官方把 static 划掉了加上了 dynamic，但以我目前的了解，它依然是一个 static site generator，只是在生成的路由的方面有了 <em>动态</em> 的感觉。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 772px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e153ee034e6e26509318a47a5247d08b/940c5/2021-07-17-20-10-00.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABU0lEQVQY06WRXU+CYACF/fmu1l3mR2lt6SL83CTNUqA2Qfw2hFJQVF58RTAFtGU6aNhV1z73z9nZOR7nCDxNDOJhSR2sVWnTykEOn1OIvFS2BEE8YLlatc4wDE1TJEkSJK4rZis/ZfHZl/njyrBv0Shgi3OptaIQmYxI1D0YtpbxNHJ6doLEY+HIVfQ2mkymEDQ2bOvco9nM6J9g68qG+g14E/DmuLOCgjUT1z1qMe6sNHFbxxRd2C+mBoZhXJdjWbbC0LVm5amUFweCK1fTSv5c7OLzSgI0c7BTUJkkKN/JUDQ/yno9DXtdMXTt8wcvUBT1er1+fyAYCBWfi64M3k2ZNQRmwb9qULAaGFQHa8AbjSwEvDHtm5M3S25vtInlOI5t/x9s1F42slMmASoJwJFa6VLiDi2qKeXlZlTwDZgUqGXAqL1yHHu32/9hH2I8x1z1C8gfodvGHSbEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2021 07 17 20 10 00\"\n        title=\"2021 07 17 20 10 00\"\n        src=\"/static/e153ee034e6e26509318a47a5247d08b/940c5/2021-07-17-20-10-00.png\"\n        srcset=\"/static/e153ee034e6e26509318a47a5247d08b/772e8/2021-07-17-20-10-00.png 200w,\n/static/e153ee034e6e26509318a47a5247d08b/e17e5/2021-07-17-20-10-00.png 400w,\n/static/e153ee034e6e26509318a47a5247d08b/940c5/2021-07-17-20-10-00.png 772w\"\n        sizes=\"(max-width: 772px) 100vw, 772px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>翻看 gatsby 官方的信息后，这里为 gatsby 总结出如下几个特点：</p>\n<ol>\n<li>gatsby 使用的模板引擎为 react（jekyll 用的就是 ruby 的 erb），相比于其他的后端模板引擎，它本身就是前端框架，使用 react 相当于具备了创建完整前端技术栈的能力。</li>\n<li>gatsby 也有自己的一套静态路由，以及最近也有了 <em>动态</em> 路由。这部分似乎没有特别多的新意，毕竟路由原本就是传统后端框架的必要组成部分。但是 gatsby 的动态路由是通过带参数形式的文件名实现的（当然还有个更灵活的方式： <a href=\"https://www.gatsbyjs.com/docs/how-to/routing/creating-routes/#using-gatsby-nodejs\">gatsby-node.js</a>），这个思路感觉像是在原有的静态路由的延申，这似乎是一种把路由的使用门槛降低的好办法，还有另外一个框架 next.js 也使用了类似的方式。</li>\n<li>gatsby 的 graphql data layer 可以通过一系列插件将多种形式的数据源以 graphql 的形式提供给处于 <code>develop mode</code> 的 gatsby server ，并很方便的填充到模板中。同时，数据源还可以使用插件做数据的扩展（添加字段，修改字段），在后面有关插件的部分我也会做一些介绍。</li>\n</ol>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1b825b58bb44d2080bfd119800d2a2d5/5df5d/data-layer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzElEQVQozz1Sy3LbMAzU//9Ye8s1mSZOmjaRKtsSXyDxZoeyEwwPxM4sd7HEhGJrwh14Dvixt4RSSc+ZQhUU24DniEvESyFSzyhzxDliQUWxCUjer+3P1p6X/LKWSyZAOa35nLCgLKG9/Bv42wUyylb4aU6PnzEAAenUuwNACEGYVdjdeu8i0hr2o5hZmHvvZkbEwtS7m7mqTu4+L+vL6xsxqxpALQC995QzEvXer/uuqgWgAIiIe/fezd3MBtnd1Tw1Liix0nyNsfGe655ranwOOTWeryEA5iapMqC4u7lPd29qKMOwf7WnC/y+1o+9LZE+A97wfmgC6e0+DRujOpAUlNQ4VkqNt9y2jBFoLy0AHTjnNmQLytC9KReo121HpDHMgbaGrSEiIZGo5gKq6l/VDzlVG+T1fHl8eo4xDSvuhEhHVKoqIsOqWq3NzL68D/Y9MJHxKosi63UPsVRzZzVACjEhq7mLWky5NWSx75puz3T3Y7Hw1xJDZRJrrOeEvy+lkpAooM6hva45o4haH+b79J1wRn1ays/TdloLq5PaHPHhPeQmrBaAH97jj9P2d2/m9+yn7zHUxm+P9dKR5e24dxI7Jrwzju5O+Q8cUvLI8mjQAQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"graphql data layer\"\n        title=\"graphql data layer\"\n        src=\"/static/1b825b58bb44d2080bfd119800d2a2d5/5a190/data-layer.png\"\n        srcset=\"/static/1b825b58bb44d2080bfd119800d2a2d5/772e8/data-layer.png 200w,\n/static/1b825b58bb44d2080bfd119800d2a2d5/e17e5/data-layer.png 400w,\n/static/1b825b58bb44d2080bfd119800d2a2d5/5a190/data-layer.png 800w,\n/static/1b825b58bb44d2080bfd119800d2a2d5/c1b63/data-layer.png 1200w,\n/static/1b825b58bb44d2080bfd119800d2a2d5/5df5d/data-layer.png 1572w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">graphql data layer</figcaption>\n  </figure></p>\n<h2 id=\"快速开始\" style=\"position:relative;\">快速开始<a href=\"#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B\" aria-label=\"快速开始 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>在开始操作之前我自然是 google 了一番，发现想要把 jekyll 切到 gatsby 的人不在少数。并且官方网站里也有适配 markdown 作为数据源的内容。这里先罗列下从 jekyll 到 gatsby 迁移的几个必须步骤，并在下文一一介绍。</p>\n<ol>\n<li>markdown 文件的整体迁移</li>\n<li>生成路由</li>\n<li>处理 blog 中的代码高亮</li>\n<li>优化 blog 中的 image</li>\n<li>部署</li>\n</ol>\n<h2 id=\"markdown-文件的整体迁移\" style=\"position:relative;\">markdown 文件的整体迁移<a href=\"#markdown-%E6%96%87%E4%BB%B6%E7%9A%84%E6%95%B4%E4%BD%93%E8%BF%81%E7%A7%BB\" aria-label=\"markdown 文件的整体迁移 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>jekyll 出现的那个时代没有想现在这样如此多的外部数据源可以选择，其静态页面生成的数据源一定是文件。但 2021 年情况发生了变化，从 gatsby 的官方数据源插件来看，其中大量的数据源是 headless cms（比如 contentful 比如 wordpress），不过对我来说从 jekyll 迁移，我关心的也就是文件数据源。</p>\n<p>这里用到了两个插件：</p>\n<ol>\n<li><code>gatsby-source-filesystem</code> 将特定目录作为数据源添加到 gatsby 的数据层</li>\n<li><code>gatsby-transformer-remark</code> 使用 <a href=\"https://remark.js.org/\">remark</a> 将 <code>markdown</code> 文件解析为 html 并为 markdown 提供了很多有用的字段（比如 frontmatter，比如目录）</li>\n</ol>\n<p>gatsby 所有的插件都需要单独安装并在 <code>gatsby-config.js</code> 做配置，这里展示下上述两个插件的基本配置：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  siteMetadata<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-transformer-remark</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Plugins configs 这里后续做扩展，支持语法高亮、图片优化</span>\n        plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-source-filesystem</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        name<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">blogs</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n        path<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/src/blogs/</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>在 <code>gatsby-source-filesystem</code> 的配置部分可以看到，markdown 文件被放到了 <code>src/blogs</code> 目录下。在执行命令 <code>yarn run start</code> 之后，通过 <code>http://localhost:8000/__graphql</code> 构建如下 graphql 语句就能够获取到文件的信息了：</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property-query\">allFile</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token attr-name\">sourceInstanceName</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token attr-name\">eq</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"blogs\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token object\">nodes</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">relativePath</span>\n      <span class=\"token property\">extension</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>可以看到对应的结果如下所示：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/903572f815ccd4e832fc819eed8580f7/9b379/2021-07-18-14-20-38.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABRklEQVQoz42R247cIBBE/f//mEykWZtLYzf0DewxbGTnJVI2mj2qR44oVU8fz495Xrz3MQa4CSEkAB+8cy6tX7O4sLg4ad33epzHebRzt9deX+dxvup+9lNEMiCRmFX9K6JWW4sAk9i+AFk9Rh/9HL2P0cc4+xjDzFakOSJpFWsm1axa27W2drwW56be+/1yfP6DFKZngkdwPxw+Ez2BY5aNeC2WJYQ4fan9QdW48JpygkwbyUZKqkW0iOlVfvr8P8rKyCliRKYiiqysWi7f7K2sxkhrRPBbAeSIqtVas7Zbbe9lKZIgu0vODNnsNu+8k0UFCQJ6v+Ww8Zw4Fc1yhfS9zFu5agcsMbPHa7N7MBX7xs8bp4DBY/HIy8rrJQvJd2obb7RChpgLZIlZ8j04qb4/VWGaE/wK7qfHRyiPQMvK/p79rv0buuHtxVAbKOgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2021 07 18 14 20 38\"\n        title=\"2021 07 18 14 20 38\"\n        src=\"/static/903572f815ccd4e832fc819eed8580f7/5a190/2021-07-18-14-20-38.png\"\n        srcset=\"/static/903572f815ccd4e832fc819eed8580f7/772e8/2021-07-18-14-20-38.png 200w,\n/static/903572f815ccd4e832fc819eed8580f7/e17e5/2021-07-18-14-20-38.png 400w,\n/static/903572f815ccd4e832fc819eed8580f7/5a190/2021-07-18-14-20-38.png 800w,\n/static/903572f815ccd4e832fc819eed8580f7/9b379/2021-07-18-14-20-38.png 951w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>不过直接使用这个似乎数据也做不了什么，还需要 <code>gatsby-transformer-remark</code> 将 markdown 做解析，对应的数据通过另外一个 graphql 的接口获取：</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token object\">allMarkdownRemark</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token object\">nodes</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">id</span>\n      <span class=\"token property\">html</span>\n      <span class=\"token object\">frontmatter</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">title</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/766fff3e9096e10adfe8fb7d7c67d123/d7abb/2021-07-18-14-26-08.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABYklEQVQoz4WRi27qMBBE8/+fVhVuAyRAq6rk4UdC7F3b6zgUEioT3UpVSzsarSzLRzsjJ0VRcMZkI2Uzq5VStm0jhOCcq//qvrrmUogmsWjJD304jeM4TdM8ZxERdoCWLHnyve/Dp0MYlFIJ+UGhv4zj9aumaepDOGpTNVpp68j3YQjh1IchHt7fHVFyuYxg++F0vn6TJ0/aHhuN5dG8NlYox5XlylQdKescJefz5XpH1IJOS7MXsGW4ZZjVsKkxZ3pRYM4jPE3TD9ztzjUATyWkFSwLzFl0xnBdweLgSuW8vwPPsbXFV4k7jjsWZ87gXwHLUj8eSIDrf4WpM7CuzbPALTd7gRnTiwOsYhBXdH9sphbi01WFOTM5w7nwstCLQ+xMv3cWGtLK7PiNr3FdY1rhJoY3O3Ef/oy9Zbi5Lc8YrMq481lAVpsX+RfcIGQ17jmkZcwfv6qCtNIPb/bt6Dx9AFzAp7PaF+fLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2021 07 18 14 26 08\"\n        title=\"2021 07 18 14 26 08\"\n        src=\"/static/766fff3e9096e10adfe8fb7d7c67d123/5a190/2021-07-18-14-26-08.png\"\n        srcset=\"/static/766fff3e9096e10adfe8fb7d7c67d123/772e8/2021-07-18-14-26-08.png 200w,\n/static/766fff3e9096e10adfe8fb7d7c67d123/e17e5/2021-07-18-14-26-08.png 400w,\n/static/766fff3e9096e10adfe8fb7d7c67d123/5a190/2021-07-18-14-26-08.png 800w,\n/static/766fff3e9096e10adfe8fb7d7c67d123/d7abb/2021-07-18-14-26-08.png 959w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>顺便说一下 gatsby 提供的 graphiql 增加了 <a href=\"https://github.com/OneGraph/graphiql-explorer\">graphql-explorer</a> 可以通过点击的方式快速的拼接 graphql 语句。</p>\n<h2 id=\"生成路由\" style=\"position:relative;\">生成路由<a href=\"#%E7%94%9F%E6%88%90%E8%B7%AF%E7%94%B1\" aria-label=\"生成路由 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"固定路由\" style=\"position:relative;\">固定路由<a href=\"#%E5%9B%BA%E5%AE%9A%E8%B7%AF%E7%94%B1\" aria-label=\"固定路由 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>有了数据源，下一步就是构建博客的基本的路由结构：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/ -- 首页，展示最新的 N 篇博客\n/about -- 关于，一个独立的页面\n/page/{page-number} -- 做分页，每页固定数量的博客，当然提供翻页功能\n/{slug} -- 每篇博客的语义 url 用来展示每篇独立的博客\n/archive -- 所有博客的总览页面，罗列了所有的博客标题</code></pre></div>\n<p>上文提了，gatsby 为了简化路由，为 <code>/src/pages</code> 目录下每个文件都提供了对应的 url 路径。比如 <code>src/pages/about.js</code> 的内容就对应了 <code>/about</code> 路由，再比如 <code>src/pages/projects/main.js</code> 对对应了 <code>/projects/main</code> 路由。也就是说对于固定路由来说，直接给个对应文件并且按 gatsby 的规约用 graphql 获取数据做渲染就好了。这里我以 <code>/archive</code> 的代码举个例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Archive</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> groupByYearResult <span class=\"token operator\">=</span> <span class=\"token function\">groupByYear</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">.</span>nodes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Base<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>h1 className<span class=\"token operator\">=</span><span class=\"token string\">\"text-4xl font-extrabold tracking-tight my-4 text-gray-800\"</span><span class=\"token operator\">></span>Archive<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span>groupByYearResult<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> key<span class=\"token punctuation\">,</span> value <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n          <span class=\"token operator\">&lt;</span>div key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>key<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>h2 className<span class=\"token operator\">=</span><span class=\"token string\">\"text-3xl font-bold tracking-tight my-4 text-gray-800\"</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>key<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>YearItems blogs<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Base<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">YearItems</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> blogs <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>省略了<span class=\"token operator\">...</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query QueryBlogTitles {\n    allMarkdownRemark(sort: { fields: frontmatter___date, order: DESC }) {\n      nodes {\n        id\n        frontmatter {\n          title\n          date(formatString: \"MMMM-DD\")\n          year: date(formatString: \"YYYY\")\n        }\n        fields {\n          slug_without_date\n        }\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">groupByYear</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">blogs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 省略了...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>文件可以分为两个部分，一部分是 react 的模板，一部分是 graphql 数据的获取，简单明了，这里就不再赘述了。</p>\n<h3 id=\"从文件生成-slug-并使用-react-模板生成-blog-页面\" style=\"position:relative;\">从文件生成 slug 并使用 react 模板生成 blog 页面<a href=\"#%E4%BB%8E%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90-slug-%E5%B9%B6%E4%BD%BF%E7%94%A8-react-%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90-blog-%E9%A1%B5%E9%9D%A2\" aria-label=\"从文件生成 slug 并使用 react 模板生成 blog 页面 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>相对于固定路由，动态路由不是说像 <a href=\"/blog-migrate-from-jekyll-to-gatsby\">/blog-migrate-from-jekyll-to-gatsby</a> 这样的页面是在用户请求的时候用 server 端临时拼装页面，而是指在 gatsby 部署的时候动态的生成一系列的静态页面。上文提到了，既然我可以从 graphql 里面罗列一系列的 markdown 内容了，那我自然可以通过遍历的方式去生成一个个页面并提供各自的路由。</p>\n<p>具体在 gatsby 做的时候需要这么做：</p>\n<h4 id=\"1-准备单个-blog-的模板页面\" style=\"position:relative;\">1. 准备单个 blog 的模板页面<a href=\"#1-%E5%87%86%E5%A4%87%E5%8D%95%E4%B8%AA-blog-%E7%9A%84%E6%A8%A1%E6%9D%BF%E9%A1%B5%E9%9D%A2\" aria-label=\"1 准备单个 blog 的模板页面 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">BlogTemplate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Base<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Blog data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>blog<span class=\"token punctuation\">}</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Base<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query BlogPostQuery($id: String) {\n    blog: markdownRemark(id: { eq: $id }) {\n      id\n      html\n      tableOfContents\n      frontmatter {\n        title\n        date(formatString: \"MMMM DD, YYYY\")\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span></code></pre></div>\n<p>这是 <code>src/templates/blog.js</code> 文件的内容，可以看到，在 <code>pageQuery</code> 引入了参数 <code>$id</code>，这部分在下文会介绍怎么填充这个字段。</p>\n<h4 id=\"2-在-gatsby-nodejs-中创建页面\" style=\"position:relative;\">2. 在 gatsby-node.js 中创建页面<a href=\"#2-%E5%9C%A8-gatsby-nodejs-%E4%B8%AD%E5%88%9B%E5%BB%BA%E9%A1%B5%E9%9D%A2\" aria-label=\"2 在 gatsby nodejs 中创建页面 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>gatsby 在 build 的时候会执行 gatsby-node.js 文件，这个文件中可以调用 gatsby 的内部 api 以实现动态创建页面的目的。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createFilePath <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gatsby-source-filesystem\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 1. 为 markdown 增加额外的字段 slug 和 slug_without_date</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateNode</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> node<span class=\"token punctuation\">,</span> actions<span class=\"token punctuation\">,</span> getNode <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createNodeField <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>internal<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">MarkdownRemark</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> filename <span class=\"token operator\">=</span> <span class=\"token function\">createFilePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> node<span class=\"token punctuation\">,</span> getNode <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// get the date and title from the file name</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> filename<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>\n      <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\/([\\d]{4}-[\\d]{2}-[\\d]{2})-{1}(.+)\\/$</span><span class=\"token regex-delimiter\">/</span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// create a new slug concatenating everything</span>\n    <span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> node<span class=\"token punctuation\">,</span> name<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">slug</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>date<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\-</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> node<span class=\"token punctuation\">,</span> name<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">slug_without_date</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 2. 获取所有的 markdown 数据</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> actions<span class=\"token punctuation\">,</span> reporter <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Destructure the createPage function from the actions object</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createPage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    {\n      allMarkdownRemark {\n        nodes {\n          id\n          fields {\n            slug\n            slug_without_date\n          }\n        }\n        pageInfo {\n          totalCount\n        }\n      }\n    }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    reporter<span class=\"token punctuation\">.</span><span class=\"token function\">panicOnBuild</span><span class=\"token punctuation\">(</span><span class=\"token string\">'🚨  ERROR: Loading \"createPages\" query'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">.</span>nodes<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 3. 调用 api createPage 创建</span>\n  posts<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">node<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      path<span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 这里是路由</span>\n      component<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./src/templates/blog.js</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 这里是模板的位置</span>\n      context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 这里是传递给模板的参数</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      path<span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug_without_date<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 生成另外一个路由</span>\n      component<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./src/templates/blog.js</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>首先，通过 <code>onCreateNode</code> 的 hook 通过文件名解析出来了 slug。举个例子，文件名是 <code>2021-07-17-blog-migrate-from-jekylly-to-gatsby.md</code> 那么就会解析出两个 slug：</p>\n<ul>\n<li>/2021/07/17/blog-migrate-from-jekylly-to-gatsby</li>\n<li>/blog-migrate-from-jekylly-to-gatsby</li>\n</ul>\n<p>之后通过 <code>createNodeField</code> 方法把 slug 再次塞回 <code>MarkdownRemark</code> 类型的 <code>fields</code> 属性里，后面就可以通过 <code>fields.slug</code> 访问这些属性了。</p>\n<p>之所以创建 /2021/07/17/xxx 的路由（而不仅仅有 /xxx 的路由）是因为这时 jekyll 的默认路由样式，算是做一个兼容保证原来的链接不会失效。</p>\n<p>到目前为止，blog 的主要功能算是建立好了。</p>\n<h2 id=\"处理-blog-中的代码高亮\" style=\"position:relative;\">处理 blog 中的代码高亮<a href=\"#%E5%A4%84%E7%90%86-blog-%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE\" aria-label=\"处理 blog 中的代码高亮 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>remark 这个插件自己也可以使用插件，使用 <a href=\"https://www.gatsbyjs.com/plugins/gatsby-remark-prismjs/\">prismjs</a> 就可以实现代码的高亮了。</p>\n<p>简单罗列下配置：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n      resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-transformer-remark</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Plugins configs</span>\n        plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-remark-prismjs</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n            options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n              aliases<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 这里仅仅是多了两个语言的 alias</span>\n                sh<span class=\"token operator\">:</span> <span class=\"token string\">\"bash\"</span><span class=\"token punctuation\">,</span>\n                gql<span class=\"token operator\">:</span> <span class=\"token string\">\"graphql\"</span>\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>最后记得按照文档把 css 文件添加进来。</p>\n<h2 id=\"优化-blog-中的-image\" style=\"position:relative;\">优化 blog 中的 image<a href=\"#%E4%BC%98%E5%8C%96-blog-%E4%B8%AD%E7%9A%84-image\" aria-label=\"优化 blog 中的 image permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>这部分工作也算是 gatsby 的一个亮点。这个插件通过对 img 的 srcset 的支持可以实现在不同宽度的页面上去加载不同宽度的图片。并且这些不同宽度的图片也都由插件自动生成，称得上是开箱即用了。更多的信息去 <a href=\"https://www.gatsbyjs.com/plugins/gatsby-remark-images/?=image#gatsby-remark-images\">gatsby remark images</a> 一看就晓得了。</p>\n<h2 id=\"在-github-pages-部署\" style=\"position:relative;\">在 github pages 部署<a href=\"#%E5%9C%A8-github-pages-%E9%83%A8%E7%BD%B2\" aria-label=\"在 github pages 部署 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>这部分 gatsby 已经给准备好了，跟着 <a href=\"https://www.gatsbyjs.com/docs/how-to/previews-deploys-hosting/how-gatsby-works-with-github-pages/\">How Gatsby Works with GitHub Pages</a> 基本就能解决。最后通过一个 github action 实现了自动部署（而不是每次都自己 yarn run deploy）：</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> build<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>deploy\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'**'</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Git Repo Sync\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v2\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'14'</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> install deps\n      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> yarn install <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>frozen<span class=\"token punctuation\">-</span>lockfile\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> build\n      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> yarn run build\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> deploy\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> peaceiris/actions<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages@v3\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">publish_branch</span><span class=\"token punctuation\">:</span> main\n        <span class=\"token key atrule\">publish_dir</span><span class=\"token punctuation\">:</span> ./public</code></pre></div>\n<p>这里我的主分支是 master 并采用 main 作为了发布分支，直接使用 action  <code>actions-gh-pages</code> 把 public 目录提交到 main 就可以了。</p>\n<h2 id=\"小结\" style=\"position:relative;\">小结<a href=\"#%E5%B0%8F%E7%BB%93\" aria-label=\"小结 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>gatsby 并不像 jekyll 那么开箱即用，但其功能确实强大不少，灵活性和扩展性不是一个数量级的了。不过这也要求使用者对前端的技术栈足够了解。</p>\n<p>另一方面，gatsby 把 graphql 作为默认的数据查询语言，对于熟悉 graphql 的人来说自然是非常便利，但也一定程度上提升了使用门槛。</p>\n<h2 id=\"后续工作\" style=\"position:relative;\">后续工作<a href=\"#%E5%90%8E%E7%BB%AD%E5%B7%A5%E4%BD%9C\" aria-label=\"后续工作 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ol>\n<li>增加样式，目前是 plain html，只有代码块是花花绿绿的</li>\n<li>SEO 优化</li>\n<li>首页，这部分在 jekyll 的时候是个分页，现在想要做类似的实现</li>\n<li>tags 的展示和按照 tags 罗列文章，这也是之前 jekyll 的功能，也希望做成类似的样子</li>\n</ol>\n<h2 id=\"相关资源\" style=\"position:relative;\">相关资源<a href=\"#%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90\" aria-label=\"相关资源 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>把几个用到但是没有提及的链接放到这里：</p>\n<ul>\n<li><a href=\"https://deborah-digges.github.io/2020/09/16/Jekyll-to-Gatsby/\">From Jekyll to Gatsby: 7 Simple Steps</a></li>\n<li><a href=\"https://www.gatsbyjs.com/docs/how-to/routing/adding-markdown-pages/\">Adding Markdown Pages</a></li>\n<li><a href=\"https://www.gatsbyjs.com/docs/reference/routing/creating-routes/#using-gatsby-nodejs\">Create routing</a></li>\n</ul>","fields":{"slug_without_date":"/blog-migrate-from-jekyll-to-gatsby"}},{"id":"eb9d3f5f-0e83-5c22-95c2-3826db96cfd9","frontmatter":{"title":"Github Actions 与 Github 自身 API 集成生成周报","date":"2021 July-01"},"html":"<p>最近又用 Github Actions 玩出了花样。这里记录一下通过 Github Api 和 Github Actions 怎么去做组织内的 commits 统计。</p>\n<h2 id=\"为啥要自己做统计\" style=\"position:relative;\">为啥要自己做统计<a href=\"#%E4%B8%BA%E5%95%A5%E8%A6%81%E8%87%AA%E5%B7%B1%E5%81%9A%E7%BB%9F%E8%AE%A1\" aria-label=\"为啥要自己做统计 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>之前一直有一个想法，能不能通过 github 的 api 去将组织内的工作量做成报表以方便查看每个人工作的进度以及各个 issue 的进展。做了简单的调研，发现现有的东西都不太能满足具体的需求：</p>\n<ol>\n<li>我希望统计 org 下所有仓库的数据，而不是单个仓库（目前所在组织里有 100+ 个仓库）</li>\n<li>目前 org 内以 issue 作为工作的一个最小单位，希望提交的 commit 都与 issue 做关联，那么势必需要统计每个周期内 issue 的进展以及关联的 commit 做统计，显然现有的 <a href=\"https://docs.github.com/en/github/visualizing-repository-data-with-graphs/accessing-basic-repository-data/viewing-a-summary-of-repository-activity\">insights</a> 也是不太够的</li>\n</ol>\n<p>然后就去评估了下自己做统计的工作量。github 早已经发布了 GraphQL 的 API 并且通过 <a href=\"https://docs.github.com/en/graphql/overview/explorer\">explorer</a> 去测试和使用其 API 的体验是相当好于是就心动了，决定自己做这个统计。</p>\n<h2 id=\"先看看最终效果\" style=\"position:relative;\">先看看最终效果<a href=\"#%E5%85%88%E7%9C%8B%E7%9C%8B%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C\" aria-label=\"先看看最终效果 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>报表数据主要包括每个人的活跃数据以及每个人所涉及的 issue。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 669px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c3806d03a6c11981ad9fe6ac95454325/99272/2021-07-02-01-00-14.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABNElEQVQoz5WSu07EQAxF8/+fwCdQUFIgIdFQQMWjAaFlYTebZGY8Hs8rz3mgBJGW7JULy9LxvbJcaGPqshR11TTN4XBUivJmFdM4fkr/IVttndbaeR8WbYJzjLcsXlUZSSNKRQQAfd+nLXAM4bqKD2LkgAIJEbuuizFtdA6X3+FiF26OHcPZVhvb+jal//kixfBY+5dKAWeAUgAQmXGaNsXOOd/z6UmOVhMZY50bhmHrwZz3QiIqEgBam3yOZhhR0gIrovSnTfCrzXeYnxfLlPNKrTt+h3Ot/Qqbtj9wBNsu7xHPix1jUCiN1qiUAPDO+9Yb51AwqyzYoF0o5cBpJB+VC19sAN1574dxKlJKnPOaMcZ5eTpxARyAquZtJ/elfT91u3quPes5ekBNdhimOE0hxvQDyRL0FtUprv0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2021 07 02 01 00 14\"\n        title=\"2021 07 02 01 00 14\"\n        src=\"/static/c3806d03a6c11981ad9fe6ac95454325/99272/2021-07-02-01-00-14.png\"\n        srcset=\"/static/c3806d03a6c11981ad9fe6ac95454325/772e8/2021-07-02-01-00-14.png 200w,\n/static/c3806d03a6c11981ad9fe6ac95454325/e17e5/2021-07-02-01-00-14.png 400w,\n/static/c3806d03a6c11981ad9fe6ac95454325/99272/2021-07-02-01-00-14.png 669w\"\n        sizes=\"(max-width: 669px) 100vw, 669px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"具体怎么做\" style=\"position:relative;\">具体怎么做<a href=\"#%E5%85%B7%E4%BD%93%E6%80%8E%E4%B9%88%E5%81%9A\" aria-label=\"具体怎么做 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"用到的-graphql-api\" style=\"position:relative;\">用到的 GraphQL API<a href=\"#%E7%94%A8%E5%88%B0%E7%9A%84-graphql-api\" aria-label=\"用到的 graphql api permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>首先，我集成的是 Github 的 GraphQL API 主要用到了以下几个接口：</p>\n<h4 id=\"1-获取组织内的-repositories\" style=\"position:relative;\">1. 获取组织内的 repositories<a href=\"#1-%E8%8E%B7%E5%8F%96%E7%BB%84%E7%BB%87%E5%86%85%E7%9A%84-repositories\" aria-label=\"1 获取组织内的 repositories permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token definition-query function\">Repositories</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$username</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$cursor</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property-query\">organization</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">login</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$username</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property-query\">repositories</span><span class=\"token punctuation\">(</span>\n      <span class=\"token attr-name\">first</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span>\n      <span class=\"token attr-name\">isLocked</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span>\n      <span class=\"token attr-name\">orderBy</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">field</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">PUSHED_AT</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">direction</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">DESC</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token attr-name\">after</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$cursor</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token object\">pageInfo</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">hasNextPage</span>\n        <span class=\"token property\">endCursor</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token object\">edges</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token object\">node</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">pushedAt</span>\n          <span class=\"token property\">name</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"2-获取-repository-下的-commits\" style=\"position:relative;\">2. 获取 repository 下的 commits<a href=\"#2-%E8%8E%B7%E5%8F%96-repository-%E4%B8%8B%E7%9A%84-commits\" aria-label=\"2 获取 repository 下的 commits permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token definition-query function\">Commits</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$owner</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$cursor</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property-query\">repository</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">owner</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$owner</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">name</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token object\">defaultBranchRef</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token object\">target</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span> <span class=\"token keyword\">on</span> <span class=\"token class-name\">Commit</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property-query\">history</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">first</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">after</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$cursor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token object\">pageInfo</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token property\">hasNextPage</span>\n              <span class=\"token property\">endCursor</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token object\">edges</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token object\">node</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token object\">author</span> <span class=\"token punctuation\">{</span>\n                  <span class=\"token object\">user</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token property\">name</span>\n                    <span class=\"token property\">login</span>\n                  <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token property\">commitUrl</span>\n                <span class=\"token property\">abbreviatedOid</span>\n                <span class=\"token property\">pushedDate</span>\n                <span class=\"token property\">additions</span>\n                <span class=\"token property\">deletions</span>\n                <span class=\"token property\">message</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"3-获取-issue\" style=\"position:relative;\">3. 获取 issue<a href=\"#3-%E8%8E%B7%E5%8F%96-issue\" aria-label=\"3 获取 issue permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token definition-query function\">Issue</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$owner</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$number</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">Int</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property-query\">repository</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">owner</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$owner</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">name</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property-query\">issue</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">number</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">title</span>\n      <span class=\"token property\">url</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>使用的 Client 就是 Apollo GraphQL Client。</p>\n<h3 id=\"对每个人的活动量做细节处理\" style=\"position:relative;\">对每个人的活动量做细节处理<a href=\"#%E5%AF%B9%E6%AF%8F%E4%B8%AA%E4%BA%BA%E7%9A%84%E6%B4%BB%E5%8A%A8%E9%87%8F%E5%81%9A%E7%BB%86%E8%8A%82%E5%A4%84%E7%90%86\" aria-label=\"对每个人的活动量做细节处理 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>原始的 Commit 包含行的增加和删减，但这里有个问题：</p>\n<ol>\n<li>很多代码其实是自动生成的，这部分并不能算是个人的工作量，并且这种生成代码的规模对于不同编程语言也有很大差异，希望在统计时忽略这些自动生成的代码</li>\n<li>有一些 Merge commit 其实也不能算是个人工作量，也应该剔除</li>\n<li>不同编程语言的工作规模有差异，比如前端 js 通常生产出来的代码规模就比写 python 的要大不少，纯粹按照行数统计没有可比性</li>\n</ol>\n<p>这里我处理了前两个，第三个感觉有点复杂，并且我也觉得没必要如此仔细的量化。</p>\n<h4 id=\"通过-node-ignore-去过滤掉那些生成代码\" style=\"position:relative;\">通过 <code>node-ignore</code> 去过滤掉那些生成代码<a href=\"#%E9%80%9A%E8%BF%87-node-ignore-%E5%8E%BB%E8%BF%87%E6%BB%A4%E6%8E%89%E9%82%A3%E4%BA%9B%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81\" aria-label=\"通过 node ignore 去过滤掉那些生成代码 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p><a href=\"https://github.com/kaelzhang/node-ignore\">node-ignore</a> 是一个很不错的库，实现了 gitignore 的标准，用这个我们就可以将每个 commit 的每个文件扫一遍，过滤掉那些模板的文件后重新统计删减就好了。</p>\n<p>这里吐槽 Github GraphQL API 发现其并没有实现具体一个 commit 下文件修改的接口，还需要我去调用 REST 的接口。</p>\n<h4 id=\"通过-commit-message-过滤掉-merge-的-commit\" style=\"position:relative;\">通过 commit message 过滤掉 Merge 的 commit<a href=\"#%E9%80%9A%E8%BF%87-commit-message-%E8%BF%87%E6%BB%A4%E6%8E%89-merge-%E7%9A%84-commit\" aria-label=\"通过 commit message 过滤掉 merge 的 commit permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>这里似乎有点不太严谨，但是似乎问题不大吧...</p>\n<h3 id=\"用-ejs-做模板生成-markdown\" style=\"position:relative;\">用 ejs 做模板生成 markdown<a href=\"#%E7%94%A8-ejs-%E5%81%9A%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90-markdown\" aria-label=\"用 ejs 做模板生成 markdown permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>自从用了 react 似乎很少和各种模板引擎打交道了。上次使用类似的东西还是用 freemarker 做简单的文本内容模板。这次我也做了简单的调研，看了 mustache handlebars 和 ejs 最后还是觉得 ejs 这种可以直接写 js 的比较舒服。尤其是我在尝试 mustache 的时候没找到去迭代 Object 的方法...</p>\n<p>写出来就是这个样子，实在是好久没写 nodejs 以及对 ejs 也是现学现用...</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">## Commit Summary\n\n&lt;% Object.keys(userCommitSummary).forEach(function(username) { -%>\n- &lt;%= username %>: &lt;%= userCommitSummary[username].commitCount %> commits +&lt;%= userCommitSummary[username].additions %> -&lt;%= userCommitSummary[username].deletions %>\n&lt;% }); -%>\n\n## Issue Summary\n\n&lt;% Object.keys(userIssueSummary).forEach(function(username) { -%>\n### &lt;%= username %>\n\n工作涉及 &lt;%= userIssueSummary[username].issueCount %> 个 issue：\n&lt;% userIssueSummary[username].issues.forEach(function(issue) { %>\n- &lt;%= issue -%>\n&lt;% }); %>\n\n&lt;% }); -%>\n\n## Commit Details\n\n&lt;% Object.keys(userRepositoryCommitsDetails).forEach(function(username) { -%>\n### &lt;%= username %>\n  &lt;% Object.keys(userRepositoryCommitsDetails[username]).forEach(function(repo) { %>\n####  &lt;%= repo %>\n\n    &lt;%_ userRepositoryCommitsDetails[username][repo].forEach(function(commit) { -%>\n- &lt;%= commit.url %> - &lt;%= commit.message %> &lt;&lt;%= commit.pushedDate %>>\n    &lt;%_ }); -%>\n  &lt;% }); -%>\n\n&lt;% }); -%></code></pre></div>\n<h3 id=\"用-github-actions-去跑任务做周期性统计\" style=\"position:relative;\">用 github actions 去跑任务做周期性统计<a href=\"#%E7%94%A8-github-actions-%E5%8E%BB%E8%B7%91%E4%BB%BB%E5%8A%A1%E5%81%9A%E5%91%A8%E6%9C%9F%E6%80%A7%E7%BB%9F%E8%AE%A1\" aria-label=\"用 github actions 去跑任务做周期性统计 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> statistics of github org\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">workflow_dispatch</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">timezone</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"TimeZone default is +8\"</span>\n        <span class=\"token key atrule\">required</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Asia/Shanghai\"</span>\n      <span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Any date in the week, default is now\"</span>\n        <span class=\"token key atrule\">required</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">schedule</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># https://crontab.guru</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cron</span><span class=\"token punctuation\">:</span> 0 18 * * *\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">report</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Setup node\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"14\"</span>\n          <span class=\"token key atrule\">check-latest</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> yarn\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> generate report\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GH_PAT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> TZ=$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>github.event.inputs.timezone<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> DATE=$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>github.event.inputs.date<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> node main.js\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Upload results\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/upload<span class=\"token punctuation\">-</span>artifact@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> reports\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            rawdata.json\n            report.md</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Prepare Issue Title\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> issue_title\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          export TZ=${{github.event.inputs.timezone}}\n          export DATE=${{github.event.inputs.date}}\n          echo ::set-output name=ISSUE_TITLE::$(node week.js)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Create Issue From File\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> aisensiy/create<span class=\"token punctuation\">-</span>issue<span class=\"token punctuation\">-</span>from<span class=\"token punctuation\">-</span>file@af97df85a971093700b62d1bde8339c4fabb35ff\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> Weekly Statistics $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>steps.issue_title.outputs.ISSUE_TITLE<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GH_PAT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">update-existing</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token key atrule\">content-filepath</span><span class=\"token punctuation\">:</span> ./report.md\n          <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            report</span>\n</code></pre></div>\n<p>首先，这里使用了两个 github workflow 的 trigger：</p>\n<ul>\n<li>schedule 也就是 cron 用于周期性跑任务</li>\n<li>workflow_dispatch 可以提供个简单的表单，用来主动去创建一个 workflow</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/85118802a9232dab272a6133372e6368/a0b80/2021-07-02-01-23-57.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABMElEQVQY01WNy27cMAxF/f+f0l323XVfZDNtgklmMHl5MrYkUg9KFkWqsYPmcXAgEAIO7uDAj6+zhUClUuG8ud2f+kgYEviEgZxPPhUIJKrD/VR3z+nmXG4v9eZc/o5l95z2E98b/aIc7PreGTle0vHFnqZUWx+eID5M4XGKp0s4Q5mjXAKbJJb6f9XFOmMG4lR7KpyohMwsOviMzllnV0rJjbkx9+8E78dxRIQu8v4jIio6WMLJGGPdbCxRrpVrrar9Q5GeKBmwkVKtS5MmIq01WZdLdIiIHgBLWXjj66x2DWGxU/K4GIizC54qLU11jYNzAIDOAeVcNz5L1d7775fDj92v6/MpLd0XxdJD3mLIiN4HHxH9mqm+Bx+zvfc/0/5q//PWHLS1TMS1MvNb/A+KTsqL7RVgYQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2021 07 02 01 23 57\"\n        title=\"2021 07 02 01 23 57\"\n        src=\"/static/85118802a9232dab272a6133372e6368/5a190/2021-07-02-01-23-57.png\"\n        srcset=\"/static/85118802a9232dab272a6133372e6368/772e8/2021-07-02-01-23-57.png 200w,\n/static/85118802a9232dab272a6133372e6368/e17e5/2021-07-02-01-23-57.png 400w,\n/static/85118802a9232dab272a6133372e6368/5a190/2021-07-02-01-23-57.png 800w,\n/static/85118802a9232dab272a6133372e6368/a0b80/2021-07-02-01-23-57.png 955w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>然后，这里在完成统计后（就是 generate report 这个步骤）将所有的数据做成了 artifact 保存了下来，方便后续的数据的追溯。</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/183db6a9d17a90648b97b5707fd332e1/ef916/2021-07-02-01-25-25.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABBklEQVQoz5VTa2vDMAz0//+RgzFWykicxvJDb42kK4OuK81xH4zk0wkhJSQqpUCtrfU+hkf0MUQ1IpAJAERNREoBEfWI1rqaeYRHpGmeTqcT1LqWlYgiYl1XAIiI0fuyLBHBzDln3Ssyc9yQRM09zHxzUGVRFmEWFpWde0Rvqd8Hi6Zlhbf3j/PX3AZ15ENMtWO+lHwpK/SG3A6JOzHgQNr6JBZiOSAGGp/LufdtzuauZog0SF5zRu5j67YN+uHrzvsAjUhwIx9iIqI8ZxGJ40iIOE1TrQ3HcPeHn9zjYSbJthL83MFUr8t3L66tTfPcWnsmNoMK5vbHea8qIv4/zLbbMLO7+Dcw0TR6psAb7gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Artifact 可以直接下载下来\"\n        title=\"Artifact 可以直接下载下来\"\n        src=\"/static/183db6a9d17a90648b97b5707fd332e1/5a190/2021-07-02-01-25-25.png\"\n        srcset=\"/static/183db6a9d17a90648b97b5707fd332e1/772e8/2021-07-02-01-25-25.png 200w,\n/static/183db6a9d17a90648b97b5707fd332e1/e17e5/2021-07-02-01-25-25.png 400w,\n/static/183db6a9d17a90648b97b5707fd332e1/5a190/2021-07-02-01-25-25.png 800w,\n/static/183db6a9d17a90648b97b5707fd332e1/ef916/2021-07-02-01-25-25.png 815w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Artifact 可以直接下载下来</figcaption>\n  </figure></p>\n<p>最后，通过一个 create-issue-from-file 的 github action 将 report 的内容创建成一个 issue 展示出来，展示出来就是上文的截图的效果了。</p>\n<blockquote>\n<p>这里我为了避免每次执行都创建重复性的内容还特意把原来的 action 做了修改，提交了 PR <a href=\"https://github.com/aisensiy/create-issue-from-file\">https://github.com/aisensiy/create-issue-from-file</a> 。</p>\n</blockquote>\n<h2 id=\"总结\" style=\"position:relative;\">总结<a href=\"#%E6%80%BB%E7%BB%93\" aria-label=\"总结 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li>GraphQL 的 API 相对于 REST 更容易上手</li>\n<li>了解了 Github Actions 除了 CI/CD 的功能外还能做很多奇奇怪怪的东西，甚至让我觉得它是一个 serverless 平台，这里还看到另外一个新奇的使用方式 <a href=\"https://github.blog/2020-06-17-using-github-actions-for-mlops-data-science/\">https://github.blog/2020-06-17-using-github-actions-for-mlops-data-science/</a></li>\n<li>自己撰写 Github Actions 似乎挺简单的，文档还算是比较清楚，不过那个 <a href=\"https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idoutputs\">outputs</a> 确实是花了些时间</li>\n</ul>","fields":{"slug_without_date":"/github-actions-integration-with-github"}}],"pageInfo":{"hasPreviousPage":true,"currentPage":5,"pageCount":41}}},"pageContext":{"limit":3,"skip":12}},
    "staticQueryHashes": []}