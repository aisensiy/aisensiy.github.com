{"componentChunkName":"component---src-templates-blogs-js","path":"/page/36/","result":{"data":{"site":{"siteMetadata":{"title":"eisen-s-blog"}},"blogs":{"nodes":[{"id":"a88cb874-2cc9-5270-9819-2042eec43972","frontmatter":{"title":"对于学习的一些想法","date":"2013 March-13"},"html":"<p>刚刚看了 js 类继承这部分的东西。其实，这不是我第一次看类继承这个内容了，一次又一次的看，一次又一次的忘，最主要的问题是从来没有在实际的代码中用过...在 backbone 中是有使用这个内容的，但是每次就是直接使用人家封装好的方法罢了，对于内部的实现并不关心。其实我一直觉得学习和那种比较流行的 TDD 的开发方式一致也挺好的。那种测试驱动开发的方式强调<strong>每次你要做的就是让你的代码通过测试</strong>。那么，不论我用什么方式，我就是让你通过测试我就算是编码完成了。但是我的测试会不断的进化，越发的复杂，每次测试添加了新的逻辑，那么代码就需要跟进，让你的代码可以通过更复杂的测试，并最终在测试的促进下完成整个项目。而整个测试就是对于需求的体现，这样就是让自己的代码保持与测试高度的一致，一方面保证了需求的达成，另一方面保证测试是高覆盖的。</p>\n<h2 id=\"学习经常接触的东西所延伸的领域\" style=\"position:relative;\">学习经常接触的东西所延伸的领域<a href=\"#%E5%AD%A6%E4%B9%A0%E7%BB%8F%E5%B8%B8%E6%8E%A5%E8%A7%A6%E7%9A%84%E4%B8%9C%E8%A5%BF%E6%89%80%E5%BB%B6%E4%BC%B8%E7%9A%84%E9%A2%86%E5%9F%9F\" aria-label=\"学习经常接触的东西所延伸的领域 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>而学习我其实也比较倾向于类似的方法论。就是什么时候用，什么时候学，而不是说在完全没有应用环境的时候盲目的学习，这样学习的效率并不高，很快就会忘记。虽然我说过，其实以前学过的东西永远都是有意义的，但是当我隔很久时间用到这些知识的时候发现只知道个大概、甚至只是看到书上各种图画的痕迹却一直怀疑自己从来没有看过这些内容的时候还是会觉得沮丧。后来想了想，这种没有效率的学习通常都是因为<strong>比较盲目的学习一些没有背景的知识造成的</strong>。我觉得学习应该是在自己已经熟识的领域自然的延伸会比较有效率，比如我做前端，那么对 http 请求的了解是比较自然的。如果我突然觉得 C++ 比较有意思，自己去写，那么除非说我有什么实际的项目要使用这个技能以推动我，那么，我想这部分技能的提升是非常困难的。</p>\n<p>我记得以前看过一些讲帮助提升记忆效果的东西，大多是说要把需要记忆的东西尽量和已经熟悉的东西建立关联，关联越多那么记忆的效果就越好，那么这种延伸式的学习也算是有利用这个点吧。</p>\n<p>我觉得比较理想的情况就是当我做东西需要某部分知识的时候，我就抽出一些时间快速的熟悉这部分内容并在实际的开发中使用之。我想这样的效果应该是最好的。</p>\n<h2 id=\"可是用也不一定是最好的学习\" style=\"position:relative;\">可是，用也不一定是最好的学习<a href=\"#%E5%8F%AF%E6%98%AF%E7%94%A8%E4%B9%9F%E4%B8%8D%E4%B8%80%E5%AE%9A%E6%98%AF%E6%9C%80%E5%A5%BD%E7%9A%84%E5%AD%A6%E4%B9%A0\" aria-label=\"可是用也不一定是最好的学习 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>使用才会驱动你去学习，但是如果仅仅是为了临时的项目，遇到问题仓促的 google stackoverflow 然后暴力遍历所有解决方法解决之后头也不回的走了，那么再次遇到类似的问题依然还是要重新走类似的流程。有的时候实际的项目并不一定可以帮助我们快速的成长，没有对知识进行良好的消化吸收，那么这个经历的意义就小了很多。</p>\n<p>不知道是不是我的心态不太好，每次做项目都很有压力，希望尽快的做完，做完了才安心。那么，当遇到问题之后，我就会先用 google + stackoverflow 的方法迅速解决之，然后快速推进。但是这会失去一个消化吸收的机会。虽然事后想起来会去进一步学习，但是那个时候与当即遇到问题当即学习的感觉是不大一样的。</p>\n<p>有的时候感觉这就是像是打红白机的对打游戏。尽量用这些熟悉的招数，而不敢在对打过程中去尝试的招数，因为这是有成本的，随便尝试招数很有可能被对手快速打爆。反而是没人对打的时候自己偷偷去练习一下才会有很好的提高。</p>\n<p>其实我的理想是可以不紧不慢的按照自己的安排去学习。但是我后来觉得，人，是很难靠自觉去生活的。就像政府是很难靠自觉去抵制腐败一样。人都有一个向着懒惰的趋势。如果没有比较强硬的措施加以阻止是很难控制的。给国家立法或者是给自己外界压力才会保证自己不停的努力。总是把自己放在最舒适的地方希望靠自律是完全不靠谱的。</p>","fields":{"slug_without_date":"/e5afb9e4ba8ee5ada6e4b9a0e79a84e4b880e4ba9be683b3e6b395"}},{"id":"8d793be4-7cb0-5a1d-bab9-aa40f41878d7","frontmatter":{"title":"javascript 中的类继承","date":"2013 March-12"},"html":"<p>其实这部分我觉得最好的实践就是 coffeescript 的代码。coffee 自带了类继承。那么，解析成 js 后其代码就一目了然了。不过我还是自己练习了一下。解释都在注释里，废话不多说了。coffee 关于 extend 的部分在 <a href=\"https://coffeescript.org/\">https://coffeescript.org/</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> __hasProp <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>hasOwnProperty<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">__extend</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">child<span class=\"token punctuation\">,</span> parent</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// property inherit</span>\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> prop <span class=\"token keyword\">in</span> parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">__hasProp</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">,</span> prp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      child<span class=\"token punctuation\">[</span>prop<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">[</span>prop<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// method inherit</span>\n  <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">cot</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// use the method without call parent constructor</span>\n  cot<span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">;</span>\n  child<span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">cot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// set constructor to child itself</span>\n  child<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>constructor <span class=\"token operator\">=</span> child<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// set the super with parent.prototype</span>\n  <span class=\"token comment\">// so we can call child.__super__.method.call</span>\n  <span class=\"token comment\">// to invoke parent method.</span>\n  child<span class=\"token punctuation\">.</span>__super__ <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> child<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> Animal <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">Animal</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token class-name\">Animal</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">move</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">' move'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> Animal<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> animal <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Animal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nanimal<span class=\"token punctuation\">.</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> Snake <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_super</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">Snake</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// here is an example to call super method.</span>\n    Snake<span class=\"token punctuation\">.</span><span class=\"token class-name\">__super__</span><span class=\"token punctuation\">.</span><span class=\"token function\">constructor</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">__extend</span><span class=\"token punctuation\">(</span>Snake<span class=\"token punctuation\">,</span> _super<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> Snake<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>Animal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> snake <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Snake</span><span class=\"token punctuation\">(</span><span class=\"token string\">'snk'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsnake<span class=\"token punctuation\">.</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>在 backbone 中的 extend 方法如下</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">  <span class=\"token comment\">// Helper function to correctly set up the prototype chain, for subclasses.</span>\n  <span class=\"token comment\">// Similar to `goog.inherits`, but uses a hash of prototype properties and</span>\n  <span class=\"token comment\">// class properties to be extended.</span>\n  <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">extend</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">protoProps<span class=\"token punctuation\">,</span> staticProps</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> parent <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> child<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// The constructor function for the new subclass is either defined by you</span>\n    <span class=\"token comment\">// (the \"constructor\" property in your `extend` definition), or defaulted</span>\n    <span class=\"token comment\">// by us to simply call the parent's constructor.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>protoProps <span class=\"token operator\">&amp;&amp;</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>protoProps<span class=\"token punctuation\">,</span> <span class=\"token string\">'constructor'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      child <span class=\"token operator\">=</span> protoProps<span class=\"token punctuation\">.</span>constructor<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">child</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">parent</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Add static properties to the constructor function, if supplied.</span>\n    _<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">,</span> parent<span class=\"token punctuation\">,</span> staticProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Set the prototype chain to inherit from `parent`, without calling</span>\n    <span class=\"token comment\">// `parent`'s constructor function.</span>\n    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">Surrogate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>constructor <span class=\"token operator\">=</span> child<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Surrogate</span><span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">;</span>\n    child<span class=\"token punctuation\">.</span>prototype <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Surrogate</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Add prototype properties (instance properties) to the subclass,</span>\n    <span class=\"token comment\">// if supplied.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>protoProps<span class=\"token punctuation\">)</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">,</span> protoProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Set a convenience property in case the parent's prototype is needed</span>\n    <span class=\"token comment\">// later.</span>\n    child<span class=\"token punctuation\">.</span>__super__ <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> child<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>代码里我有一个比较晕的地方</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token comment\">// Add prototype properties (instance properties) to the subclass,</span>\n    <span class=\"token comment\">// if supplied.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>protoProps<span class=\"token punctuation\">)</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">,</span> protoProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>这是要把 protoProps 一坨东西全部给 子类的 prototype 啊，那如果我修改了子类一个实例中继承来的属性或者方法，会不会导致其他子类示例方法的变动呢？答案是不会。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">View</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">View</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">[</span><span class=\"token string\">'type'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'abc'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> v1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">View</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> v2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">View</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// abc</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">.</span><span class=\"token function\">hasOwnProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">'type'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// false</span>\n<span class=\"token comment\">// 这种赋值会导致 v1 不会追朔到 View.prototype.type</span>\n<span class=\"token comment\">// 而是重新建立自己的 property. 并不影响 prototype</span>\nv1<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">'bcd'</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>v1<span class=\"token punctuation\">.</span><span class=\"token function\">hasOwnProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">'type'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// true</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>v2<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// abc</span></code></pre></div>\n<p>最后 _.extend</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">  <span class=\"token comment\">// Extend a given object with all the properties in passed-in object(s).</span>\n  _<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">extend</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token function\">slice</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">source</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> prop <span class=\"token keyword\">in</span> source<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          obj<span class=\"token punctuation\">[</span>prop<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> source<span class=\"token punctuation\">[</span>prop<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>","fields":{"slug_without_date":"/javascript-e4b8ade79a84e7b1bbe7bba7e689bfe4bba5e58f8ae5afb9e5ada6e4b9a0e79a84e79c8be6b395"}},{"id":"c01b1e76-ff2a-53ca-a935-6fe373effa57","frontmatter":{"title":"HTTP 请求中有关跨域的总结","date":"2013 March-07"},"html":"<p>以前一直没有好好的看过相关的只是，只是一知半解，之前在百度的时候知道 iframe 中的东西如果 domain 与 iframe 外的不一致，那么就不能用 js 去操作里面的对象。window.open 新开的东西也同样无法操作。但是具体的策略如何就说不清楚了，最近看看了这方面的东西，总结一下。</p>\n<p>这部分的知识主要源自于 MDN W3 以及另外一篇不错的文章 <a href=\"https://blogs.msdn.com/b/ieinternals/archive/2009/08/28/explaining-same-origin-policy-part-1-deny-read.aspx\">Same Origin Policy Part 1: No Peeking</a>。<!-- more --></p>\n<p>首先介绍一下两个名词</p>\n<ul>\n<li>SOP：Same Origin Policy</li>\n<li>CORS：Cross-Origin Resource Sharing</li>\n</ul>\n<p>然后从 SOP 说起，首先看看 MDN 上面的对于 <strong>同域</strong> 的定义</p>\n<blockquote>\n<p>The same-origin policy restricts how a document or script loaded from one origin can interact with a resource from another origin.</p>\n</blockquote>\n<p>Two pages have the same origin if the protocol, port (if one is specified), and host are the same for both pages.</p>\n<p>很简单把，origin 和 domain 的意义是差不多的。在 chrome 的调试工具中可以输入</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">document<span class=\"token punctuation\">.</span>domain</code></pre></div>\n<p>获取。端口与协议的一致性也要考虑在内。</p>\n<p>那么，在遇到跨域的问题时浏览器会怎么处理呢？通常会遵循如下的原则：</p>\n<ul>\n<li>Cross-origin writes are typically allowed. Examples are links, redirects and form sumissions. Certain arely used HTTP requests require preflight.</li>\n<li>Cross-origin embedding is typically allowed. Examples are listed below.</li>\n<li>Cross-origin reads are typically not allowed, but read access it often leaked by embedding. For example you can read the width and height of an embedded image, the actions of an embedded script, or the availability of an embedded resource.</li>\n</ul>\n<p>看到的那篇文章中把这些问题按照 linux 系统中的三个权限对应在 read write execute （rwx）。翻译过来就是</p>\n<ul>\n<li>R 读被完全禁止</li>\n<li>W 允许写</li>\n<li>X 允许执行</li>\n</ul>\n<p>在进一步的阐明如下</p>\n<ul>\n<li>\n<p><strong>任何企图获取异域资源内容的请求多会被禁止</strong></p>\n<p>这里所知的读行为其实是一个很宽泛的概念，指的是任何具备读操作潜力的行为。比如，我任何形式的 ajax 操作都可以获取返回的请求内容，获取了内容相当于我是读成功了。那么，由于 SOP 的限制，<strong>所有的 ajax 方式的跨域请求都会被禁止。相应的，iframe 以及 window.open 的页面内部的一切都是无法访问的。</strong></p>\n</li>\n<li>\n<p><strong>写是可以接受的</strong></p>\n<p>links, redirects and form sumissions 这些都算是写，其实有些晕，尤其是 Links Redirects 凭什么算是写呢？不知道。我觉得这两个应该算是读的范畴，但是同样的，它们做了页面的跳转，同样是没有办法从链接打开的页面或者是重定向的页面中取回任何资源到原来的页面。<strong>唯一可以称作是写的就只有表单提交了</strong>，当你提交了表单之后同样是会做跳转，原网页依然会失去控制权。不过允许远程表单提交会带来 CSRF 的问题。</p>\n</li>\n<li>\n<p><strong>任何的执行都是允许的</strong></p>\n<p>在页面可执行的差不多就是两种文件 css 以及 js。<strong>从任何域拿到的 css 以及 js 都可以在我们自己的网站上正常的使用</strong>。</p>\n</li>\n</ul>\n<p>那么，当我们需要做跨域的请求的时候怎么办？</p>\n<h2 id=\"jsonp\" style=\"position:relative;\">JSONP<a href=\"#jsonp\" aria-label=\"jsonp permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>jsonp 是只把你请求的资源做成一个可执行的资源，把读转化为执行。比如我要请求一个 json</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token punctuation\">{</span><span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"aisensiy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string-property property\">\"age\"</span><span class=\"token operator\">:</span> <span class=\"token number\">24</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>服务端把这个结果做成这样</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">  <span class=\"token function\">callbackFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"aisensiy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string-property property\">\"age\"</span><span class=\"token operator\">:</span> <span class=\"token number\">24</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>那么，你只需要把返回的结果作为一个 js 加载到页面中，想要的结果就有了。</p>\n<h2 id=\"一个不靠谱的方式-修改-domain\" style=\"position:relative;\">一个不靠谱的方式： 修改 domain<a href=\"#%E4%B8%80%E4%B8%AA%E4%B8%8D%E9%9D%A0%E8%B0%B1%E7%9A%84%E6%96%B9%E5%BC%8F-%E4%BF%AE%E6%94%B9-domain\" aria-label=\"一个不靠谱的方式 修改 domain permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>刚刚看到一个大神的文章，<a href=\"https://ruby-china.org/topics/7598\">https://ruby-china.org/topics/7598</a></p>\n<blockquote>\n<p>这里需要说明的一点是，设置document.domain这种跨子域通讯的方式，不是说子域与子域之间可以发送AJAX请求，而是利用子域与子域的iframe之间可以传送数据这一特性完成跨域通讯。</p>\n</blockquote>\n<p>在 MDN 有关 SOP 的文章中说到可以通过修改 document.domain 的方式可以打通各个子域名。例如一个页面 A 的 domain 为 'a.company.com'，通过</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">document.domain = 'company.com';</code></pre></div>\n<p>可以访问 company.com 域下的内容。</p>\n<p><del>我刚才做了尝试，失败了。ajax 请求总的 Origin 并没有变化，所以依然报错。而且通过修改 ajax request header 中的 origin 也是不允许的。那么，我认为这种方式应该是行不通了，我不知道为神马文档没有更新，也可能是我尝试的方式有误？</del></p>\n<h2 id=\"正式的执行跨域请求的方式\" style=\"position:relative;\">正式的执行跨域请求的方式<a href=\"#%E6%AD%A3%E5%BC%8F%E7%9A%84%E6%89%A7%E8%A1%8C%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82%E7%9A%84%E6%96%B9%E5%BC%8F\" aria-label=\"正式的执行跨域请求的方式 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>其实大多数浏览器与服务器已经支持了一套允许跨域访问的标准，Cross-Origin Resource Sharing。服务器可以通过设置HTTP头，添加 Access-Control-Allow-Origin 字段来告诉浏览器什么样子的跨域请求是允许的。\n比如</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Access-Control-Allow-Origin:*</code></pre></div>\n<p>表示任何域的请求都是可以被接受的。而</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Access-Control-Allow-Origin:https://example.com</code></pre></div>\n<p>表明只有从 example.com 的请求是被允许的。\n我用 node 做了一个简单的测试。开一个 node server，一个在端口 8000。\n端口 8000 的程序如下</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nhttp<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tres<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">'ContentType'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">'Access-Control-Allow-Origin'</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://localhost:3000'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tres<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello node\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">8000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Server running...'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>在端口 4000 开一个 node server 向 localhost:8000 请求。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> xhr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onreadystatechange</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>readState <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">>=</span> <span class=\"token number\">200</span> <span class=\"token operator\">&amp;&amp;</span> xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">&lt;</span> <span class=\"token number\">300</span> <span class=\"token operator\">||</span> xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">==</span> <span class=\"token number\">304</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nxhr<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'https://localhost:8000/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>结果如下</p>\n<p><a href=\"https://aisensiy-wordpress.stor.sinaapp.com/uploads/2013/03/one.png\"><img src=\"https://aisensiy-wordpress.stor.sinaapp.com/uploads/2013/03/one.png\" alt=\"\"></a></p>\n<p>修改请求页面的端口到 3000，再次发送请求</p>\n<p><a href=\"https://aisensiy-wordpress.stor.sinaapp.com/uploads/2013/03/two.png\"><img src=\"https://aisensiy-wordpress.stor.sinaapp.com/uploads/2013/03/two.png\" alt=\"\"></a></p>\n<p>请求被接受了。这种跨域的问题通常会在 做前后端分离的系统的时候用得到。比如 我所有的面向后端的请求全部集中在域 api.domain.com 而我的前端页面都在域 web.domain.com 下，那么在 server 端通过简单的添加允许的域就可以解决这个问题。</p>\n<p>这里在补充一句，如果是需要允许多个域名的访问应该怎么做呢？我搜了下，发现一个 <a href=\"https://stackoverflow.com/questions/1653308/access-control-allow-origin-multiple-origin-domains\">access-control-allow-origin-multiple-origin-domains</a> 说明了这个问题：如果是多个域名的话，就需要server自己处理，如果发现请求在允许的列表中，就在 http 响应头中 Access-Control-Allow-Origin 字段设为这个域。</p>\n<h2 id=\"相关资源\" style=\"position:relative;\">相关资源<a href=\"#%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90\" aria-label=\"相关资源 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/JavaScript/Same_origin_policy_for_JavaScript?redirectlocale=en-US&#x26;redirectslug=Same_origin_policy_for_JavaScript\">Same-origin policy</a></li>\n<li><a href=\"https://blogs.msdn.com/b/ieinternals/archive/2009/08/28/explaining-same-origin-policy-part-1-deny-read.aspx\">Same Origin Policy Part 1: No Peeking</a></li>\n<li><a href=\"https://zh.wikipedia.org/wiki/JSONP\">JSONP</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/HTTP/Access_control_CORS\">HTTP access control (CORS)</a></li>\n<li><a href=\"https://www.w3.org/TR/cors/#access-control-allow-origin-response-header\">Cross-Origin Resource Sharing</a></li>\n</ul>","fields":{"slug_without_date":"/http-e8afb7e6b182e4b8ade69c89e585b3e8b7a8e59f9fe79a84e680bbe7bb93"}}],"pageInfo":{"hasPreviousPage":true,"currentPage":36,"pageCount":47}}},"pageContext":{"limit":3,"skip":105}},"staticQueryHashes":["26522286"],"slicesMap":{}}