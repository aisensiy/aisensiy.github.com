{"componentChunkName":"component---src-templates-blogs-js","path":"/page/1/","result":{"data":{"site":{"siteMetadata":{"title":"eisen-s-blog"}},"blogs":{"nodes":[{"id":"ea07eee0-a72b-5736-b7fc-c711282f394b","frontmatter":{"title":"压缩 flyway migration","date":"2023 August-24"},"html":"<h2 id=\"起因\" style=\"position:relative;\">起因<a href=\"#%E8%B5%B7%E5%9B%A0\" aria-label=\"起因 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 246px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/317122247481f9a8c250bb5f6782edd2/92252/%E6%88%AA%E5%B1%8F2023-08-25%2015.05.09.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 268.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"  2023 08 25 15 05 09\"\n        title=\"  2023 08 25 15 05 09\"\n        src=\"/static/317122247481f9a8c250bb5f6782edd2/92252/%E6%88%AA%E5%B1%8F2023-08-25%2015.05.09.png\"\n        srcset=\"/static/317122247481f9a8c250bb5f6782edd2/772e8/%E6%88%AA%E5%B1%8F2023-08-25%2015.05.09.png 200w,\n/static/317122247481f9a8c250bb5f6782edd2/92252/%E6%88%AA%E5%B1%8F2023-08-25%2015.05.09.png 246w\"\n        sizes=\"(max-width: 246px) 100vw, 246px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>数据库的 migration 随着时间的迁移会越来越多，这会带来一些问题：</p>\n<ol>\n<li>很多老旧代码摆在那里看着很烦，在未来系统升级的时候可能会被标记为 `deprecated`` 成为累赘，比如在新的数据库里挂掉，比如 spring 版本升级了会挂掉</li>\n<li>数据库结构通过一系列 migraiton 才能完成，如果是像 openbayes 这种需要大量部署的情况会导致启动的速度变慢</li>\n</ol>\n<h2 id=\"解决方案\" style=\"position:relative;\">解决方案<a href=\"#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\" aria-label=\"解决方案 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>如果确认目前所有的生成环境都已经升级大于 migration 的某一个版本了就可以考虑把之前的 migration 都压缩掉了，这样可以减少一些不必要的麻烦。比如我们确定目前所有的环境的 migration 版本都大于 400 了，那么我们就可以压缩 400 以及之前的 migration。</p>\n<h3 id=\"准备一个-migration-到特定版本的环境\" style=\"position:relative;\">准备一个 migration 到特定版本的环境<a href=\"#%E5%87%86%E5%A4%87%E4%B8%80%E4%B8%AA-migration-%E5%88%B0%E7%89%B9%E5%AE%9A%E7%89%88%E6%9C%AC%E7%9A%84%E7%8E%AF%E5%A2%83\" aria-label=\"准备一个 migration 到特定版本的环境 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>本地启动一个新的 mysql:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">--name</span> some-mysql <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span>mysql <span class=\"token parameter variable\">-p</span> <span class=\"token number\">3306</span>:3306 <span class=\"token parameter variable\">-d</span> mysql:8</code></pre></div>\n<p>然后在本地启动一个 springboot 项目，配置好 flyway 的配置，然后把 migration 的版本设置为 400，这样就可以把 migration 生成到 400 了：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">./gradlew flywayMigrate <span class=\"token parameter variable\">-Dflyway.target</span><span class=\"token operator\">=</span><span class=\"token string\">\"400\"</span></code></pre></div>\n<p>这里我发现一个奇怪的问题，如果这里 400 这个版本不是一个 sql 而是一个 java 脚本类型的 migration 则会报错，不知道是不是我配置的问题。</p>\n<h3 id=\"将数据-dump-出来\" style=\"position:relative;\">将数据 dump 出来<a href=\"#%E5%B0%86%E6%95%B0%E6%8D%AE-dump-%E5%87%BA%E6%9D%A5\" aria-label=\"将数据 dump 出来 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mysqldump -u<span class=\"token operator\">&lt;</span>username<span class=\"token operator\">></span> -p<span class=\"token operator\">&lt;</span>password<span class=\"token operator\">></span> db <span class=\"token operator\">></span> dump.sql</code></pre></div>\n<h3 id=\"抽取需要的数据导入到-v1-版本的-migration\" style=\"position:relative;\">抽取需要的数据导入到 V1 版本的 migration<a href=\"#%E6%8A%BD%E5%8F%96%E9%9C%80%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E5%88%B0-v1-%E7%89%88%E6%9C%AC%E7%9A%84-migration\" aria-label=\"抽取需要的数据导入到 v1 版本的 migration permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>这里我只保存两部分内容：</p>\n<ol>\n<li>create table 的 sql</li>\n<li>insert into 的 sql</li>\n</ol>\n<p>我会让 chatgpt 分别给我写两个脚本帮我抽取其中的内容然后贴到我的项目里。</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token triple-quoted-string string\">\"\"\"\n抽取 create table 的 sql\n\"\"\"</span>\n\n<span class=\"token keyword\">import</span> re\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">extract_create_table_statements</span><span class=\"token punctuation\">(</span>dump_file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    create_table_statements <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    create_table_pattern <span class=\"token operator\">=</span> <span class=\"token string\">r'CREATE TABLE.*?;'</span>\n\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>dump_file<span class=\"token punctuation\">,</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">:</span>\n        dump_content <span class=\"token operator\">=</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        create_table_matches <span class=\"token operator\">=</span> re<span class=\"token punctuation\">.</span>findall<span class=\"token punctuation\">(</span>create_table_pattern<span class=\"token punctuation\">,</span> dump_content<span class=\"token punctuation\">,</span> re<span class=\"token punctuation\">.</span>DOTALL<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">for</span> <span class=\"token keyword\">match</span> <span class=\"token keyword\">in</span> create_table_matches<span class=\"token punctuation\">:</span>\n            create_table_statements<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token keyword\">match</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> create_table_statements\n\n<span class=\"token comment\"># Example usage</span>\ndump_file <span class=\"token operator\">=</span> <span class=\"token string\">'dump.sql'</span>\ncreate_table_statements <span class=\"token operator\">=</span> extract_create_table_statements<span class=\"token punctuation\">(</span>dump_file<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> statement <span class=\"token keyword\">in</span> create_table_statements<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>statement<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token triple-quoted-string string\">\"\"\"\n抽取 insert into 的 sql\n\"\"\"</span>\n<span class=\"token keyword\">import</span> re\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">extract_insert_statements</span><span class=\"token punctuation\">(</span>file_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>file_path<span class=\"token punctuation\">,</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">:</span>\n        dump_data <span class=\"token operator\">=</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    insert_pattern <span class=\"token operator\">=</span> <span class=\"token string\">r'INSERT INTO .*?;'</span>\n    insert_statements <span class=\"token operator\">=</span> re<span class=\"token punctuation\">.</span>findall<span class=\"token punctuation\">(</span>insert_pattern<span class=\"token punctuation\">,</span> dump_data<span class=\"token punctuation\">,</span> re<span class=\"token punctuation\">.</span>DOTALL<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> insert_statements\n\n<span class=\"token comment\"># Usage example</span>\nfile_path <span class=\"token operator\">=</span> <span class=\"token string\">'dump.sql'</span>\ninsert_statements <span class=\"token operator\">=</span> extract_insert_statements<span class=\"token punctuation\">(</span>file_path<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Print the extracted insert statements</span>\n<span class=\"token keyword\">for</span> statement <span class=\"token keyword\">in</span> insert_statements<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>statement<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>这里记得手工剔除掉 migration 的 table。</p>\n<h3 id=\"删掉-v400-以及之前的-migration\" style=\"position:relative;\">删掉 V400 以及之前的 migration<a href=\"#%E5%88%A0%E6%8E%89-v400-%E4%BB%A5%E5%8F%8A%E4%B9%8B%E5%89%8D%E7%9A%84-migration\" aria-label=\"删掉 v400 以及之前的 migration permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>这样就结束了。</p>\n<h2 id=\"注意\" style=\"position:relative;\">注意<a href=\"#%E6%B3%A8%E6%84%8F\" aria-label=\"注意 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>flyway 会有一个 sql 的<a href=\"https://documentation.red-gate.com/fd/validate-184127464.html\">校验</a>它会阻止你修改已经做过的 migration。这个机制是为了避免手贱不小心修改了老的 sql 不过我们这里是刻意为之，所以就需要把这个关掉了。</p>\n<p><code>application.yaml</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n\n<span class=\"token punctuation\">...</span>\n\n  <span class=\"token key atrule\">flyway</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">validate-on-migrate</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n\n<span class=\"token punctuation\">...</span></code></pre></div>","fields":{"slug_without_date":"/compress-flyway-migration"}},{"id":"dd5ea23c-07d0-52ca-800e-752af7089f06","frontmatter":{"title":"k8s pod 无法启动，报错 argument list too long","date":"2023 July-12"},"html":"<h2 id=\"事故原因\" style=\"position:relative;\">事故原因<a href=\"#%E4%BA%8B%E6%95%85%E5%8E%9F%E5%9B%A0\" aria-label=\"事故原因 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>前天晚上 k8s 集群出现了问题，一开始是有一台 master 的内存不够了，然后导致了一些 k8s 系统的 pod 跪了，在对 master 节点升级之后开始去重启那些受影响的 crd controller，结果发现这个 crd controller 报错：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/880fc4928a6a970ad5192932030a7cec/7161f/k8s-argument-list-too-long.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.999999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAmklEQVQI1zWOaw6CMBCEOYwaMSKPSqFPbGkhJGq8/2XG7BJ+TLrT2Z18hXYZg57R9o7f5/iC9gtGm9BJjyPvVYDUkaVs4rwf979aWJzLDpebQBHSGy5s8GFDzB/My3f3cfd2WtlTsZlW5O0H4xcol7lUyIkB7o3C6dqiqFqNWhgmo5BIaKaFQUc+enSG1QjLNJSXleQCIjtEhH8TBmRV0AWZCgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"k8s argument list too long\"\n        title=\"k8s argument list too long\"\n        src=\"/static/880fc4928a6a970ad5192932030a7cec/5a190/k8s-argument-list-too-long.png\"\n        srcset=\"/static/880fc4928a6a970ad5192932030a7cec/772e8/k8s-argument-list-too-long.png 200w,\n/static/880fc4928a6a970ad5192932030a7cec/e17e5/k8s-argument-list-too-long.png 400w,\n/static/880fc4928a6a970ad5192932030a7cec/5a190/k8s-argument-list-too-long.png 800w,\n/static/880fc4928a6a970ad5192932030a7cec/7161f/k8s-argument-list-too-long.png 1182w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>看到这个报错我很懵逼：我代码都没改，怎么突然就会报错呢，我启动的 <code>argument list</code> 也不长。连续重启两次发现没有什么效果就又去尝试重启其他的 pod 然后发现其他的 pod 也会报同样的错误...导致了问题的扩大。而且这个 crd controller 还是很重要的组件，它启动不起来由它管理的 crd 就都不能更新了，非常头大。</p>\n<p>然后就去网上查资料，发现了一个几乎和我们集群一模一样的问题的帖子：<a href=\"https://devpress.csdn.net/k8s/62ee60517e6682346618232e.html\">事后分析:Kubernetes Pod 无法启动,因为服务太多</a> ，总结来说就是因为 k8s 默认会把一个 namespace 的 service 创建一组环境变量，然后把这些环境变量注入到 namespace 所有的 pod 里。service 越多，在 pod 里注入的环境变量就越多。</p>\n<p>我们的 <code>bayesjob</code> crd 里恰好有几个 service 那么所有启动的 pod 里就会默认多非常多的环境变量，然后恰好那天有个用户跑了非常多的 <code>bayesjob</code> 刚好冲破了这个程序启动注入环境变量的上限就引发了这个问题。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">SVC_XXXA_TXWGIWBFC37V_PORT_80_TCP_PORT=80\nSVC_BAADF_OE3QGDRQF7OX_PORT_6637_TCP_ADDR=10.97.0.126\nSVC_ADMIN_VI6RZ95HMNVY_PORT_7088_TCP_ADDR=10.97.8.254\nSVC_ADMIN_VI6RZ95HMNVY_SERVICE_PORT=80\nSVC_ADMIN_VI6RZ95HMNVY_PORT=tcp://10.97.8.254:80\n...</code></pre></div>\n<h2 id=\"解决方案\" style=\"position:relative;\">解决方案<a href=\"#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\" aria-label=\"解决方案 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>解决的办法就是在 pod 里增加额外的配置：<code>enableServiceLinks: false</code> 告诉 pod 不要主动去注入这些环境变量即可。</p>\n<h2 id=\"总结\" style=\"position:relative;\">总结<a href=\"#%E6%80%BB%E7%BB%93\" aria-label=\"总结 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>之前 <code>bayesjob</code> 的生命周期比较短，并没有遇到这个问题，直到最近调整了它的生命周期（从 72h -> 14d）带来大量存活的 service ，最后在这天又恰好来了一个创建 300+ 任务的用户。这种问题真的是要到一定规模你才能发现的，实现考虑到的难度有点大了。</p>\n<p>crd controller 也应该有更好的容错性，不能因为一台 master 出问题就跪了才对，后续要对其进行调整。</p>","fields":{"slug_without_date":"/argument-list-too-long"}},{"id":"fcc06d0e-1111-5836-a906-c4113d02cfc7","frontmatter":{"title":"解决 TrueNAS Scale HDD 硬盘莫名读写的问题","date":"2022 December-15"},"html":"<p>最近攒了一台机器作为家里的 NAS，操作系统选择了 <a href=\"https://www.truenas.com/truenas-scale/\">TrueNAS Scale</a> ，之所以用这个系统原因有两个：</p>\n<ol>\n<li>它是基于 Debian 的，对我来说比较熟悉，FreeBSD 什么的实在是有点陌生，并且据说那边的驱动跟进也不是很好（当然是据说，我没实操过）</li>\n<li>TrueNAS Scale 里面的 App Store 是基于 <a href=\"https://helm.sh/docs/topics/charts/\">helm charts</a> 的，TrueNAS Scale 在开启 Apps 这个功能后会跑了一个 <a href=\"https://k3s.io/\">k3s</a> 来管理这些 apps 这个操作着实有点激进，不过我还是愿意尝试一下的，也是因为我对这些东西比较熟悉</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a578be5b7e6dc1225428bcdb2b1ea2ab/70d4c/screenshot-of-truenas-scale-applications.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACWUlEQVQozyWR227bRgBE9RORqUK2xeuSFMnd5fIiUqZk2XJkyY6rSg4c59YUQYoGTfvQAEWBAn0r+tmnrfw2GAwOBjM9P8k4dX2CIGA4HGJZFoNnFoO+hTWweNbv0z86Ovj9vsXR0ZNvDb455INAIMcxIq8YzV/QM7km8H1kmqGUxvMCRrmHI32ckUMSCYTvcXo6IowcXNfGHtk4x0Ncx0aIkMQUeGHMcSzpKZ3jnAzJV/d0jz9hgpDBhw0nHzdoP+T6/WfmN1sSIZDvduSLDplkWHmHKisyUyG//EPZnhH7Lj2ZGzzXQUiDajrSZIwqZuT1DDke419dksw6UhEw//Vv2vUWlSbo8y3KVChTsP/yF9VkihCCXpqmuK5D3syZLW/QKiOeLkmni8M20cVzZDcjiyPGt4+YboFWkpNmgyxrdF6yuf+Tom4RIqAXhiGO61CYM866FTJLsCfPCSYXqCTGnSxJJ92h1XG1ZFw0aJlys5Q0lcbkOZ/v31CXxeGgXhRF2I7HZR6ymBlkKom6CjVvyKWm7hR1a8hSyflS005LtNZ8v0o4qySqKLj77Q/KpiEUB2CI7Xp0JuDFuSKVhjePSx5eXuH7ER/eX7PfrajKitvXr+kWl4eGb3/+yqQ7R8sx64sxbVsTRfETcGR7XDQh++uCOFU87m55ud0QxgnbTcl6NaUyE6Y/TqmuKlSSsX3YUU8atM64fLijrIqnU+Io4vjU5dU65pe3NUEs+WG34d1+g/hf30u+XZekccH17zbtXYpKcu6+M7RtgSkN+6+fmLQ14r8N/wVzU0KRIuQ+CQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot of truenas scale applications\"\n        title=\"screenshot of truenas scale applications\"\n        src=\"/static/a578be5b7e6dc1225428bcdb2b1ea2ab/5a190/screenshot-of-truenas-scale-applications.png\"\n        srcset=\"/static/a578be5b7e6dc1225428bcdb2b1ea2ab/772e8/screenshot-of-truenas-scale-applications.png 200w,\n/static/a578be5b7e6dc1225428bcdb2b1ea2ab/e17e5/screenshot-of-truenas-scale-applications.png 400w,\n/static/a578be5b7e6dc1225428bcdb2b1ea2ab/5a190/screenshot-of-truenas-scale-applications.png 800w,\n/static/a578be5b7e6dc1225428bcdb2b1ea2ab/c1b63/screenshot-of-truenas-scale-applications.png 1200w,\n/static/a578be5b7e6dc1225428bcdb2b1ea2ab/29007/screenshot-of-truenas-scale-applications.png 1600w,\n/static/a578be5b7e6dc1225428bcdb2b1ea2ab/70d4c/screenshot-of-truenas-scale-applications.png 2548w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>基本环境准备好了之后把由 5 块 HDD 组成的 RaidZ1 作为了主存储池就开始使用了。用了一段时间发现系统有一个小小的问题：这些 HDD 差不多每几秒就会卡卡响两下，不是什么异常的声音，就是正常的读写的声音，可我当时并没有使用它做什么事情，而且这种有节奏的噪音让我也有点难受。看了下监控，io 模式就是这个样子：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e55ea95fb90db25137b7aefdf1354cf/00e09/truenas-scale-hdd-idle-read-write.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbklEQVQI1y3OQQ4EIQhEUU8jUEJBd6KdzP0PNtHI6vFX1dZaz/uqqJmZmp4zvbb73UKGu1dVRIhIc3cIXMeQAbUNHVBAMY5Px1CY2Pf9qpLknDMiGklKZX+yV/RkL/ZMKUqeXrGx7RIA9j49M83+zmIeX4r/0z8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"truenas scale hdd idle read write\"\n        title=\"truenas scale hdd idle read write\"\n        src=\"/static/1e55ea95fb90db25137b7aefdf1354cf/5a190/truenas-scale-hdd-idle-read-write.png\"\n        srcset=\"/static/1e55ea95fb90db25137b7aefdf1354cf/772e8/truenas-scale-hdd-idle-read-write.png 200w,\n/static/1e55ea95fb90db25137b7aefdf1354cf/e17e5/truenas-scale-hdd-idle-read-write.png 400w,\n/static/1e55ea95fb90db25137b7aefdf1354cf/5a190/truenas-scale-hdd-idle-read-write.png 800w,\n/static/1e55ea95fb90db25137b7aefdf1354cf/c1b63/truenas-scale-hdd-idle-read-write.png 1200w,\n/static/1e55ea95fb90db25137b7aefdf1354cf/29007/truenas-scale-hdd-idle-read-write.png 1600w,\n/static/1e55ea95fb90db25137b7aefdf1354cf/00e09/truenas-scale-hdd-idle-read-write.png 2195w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>首先我就去 google 了，搜来搜去，用关键词「truenas scale idle read write」找到了 <a href=\"https://www.reddit.com/r/truenas/comments/u3zxpn/truenas_scale_constant_writes_while_idle/\">TrueNas Scale constant writes while idle</a> 这个问题，下面的回复基本就就是清楚了原因，我这里简单复述下：</p>\n<p>TrueNAS 会默认把你建立的第一个 data pool 设定为 System Dataset 然后会在这里塞日志等乱七八糟的东西，尤其是系统日志这种东西它就会持续的对系统进行写入。</p>\n<p>既然 HDD 读写声音很讨厌，那我就还是再加一个 nvme 的盘做成存储池来用吧，幸好我的主板 m.2 的插槽管够。插上 nvme 硬盘并设置一个新的存储池后，通过「System Settings」-「Advanced」-「System Dataset Pool」把它修改成心态添加的 nvme 存储即可。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/890801d921fdc4b0f9de13fb60be5602/a3a5c/config-system-dataset.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACM0lEQVQ4y3WUzY4aQQyE5xWIQBBgyADzx8DA8A+7BCEQWuWSQ3LLJZHyKnnvij7vmpCIHKyettvlKrt7gk5RqZFM1GiHarZaqtXeqVarqV6vPzRio9FIWZap3W4rz3MNokjD6INazaaCxbxSkaVK4ljzzU6Hj0etlkt1w1BhGKrX66nb7Voye747nY6t3V5PYbOu5tMnNX7+0vtyrWA6nSrLc6VpqjzLxJ7vKIrU7/dthcVsNtNwODRmg8HAYrZGkeJiovnxomGaK5jP5xqPx0qSRJPJROv12iThw/herVY6nU623263txiFKFCOx7qcjiqKkYKqqiwJVkVRaLlcGsBisbACZVlazNnhJwc/gA4ax7ExNkCAcLo0L4DP/Z5IPPcWvfkxMAC9MUQyMmCI0cv7BC9AzNv0bzFUBJVV/MMIBsghAR+F8COfPXGKeUHi3n/WYDadalKWStLUmG42GwODPkDe28PhYCtDo8esgAPCGeLkBU77ng2SdrudgVPZe+pxwJi2n/EZmOR7QFg5I5fth33SSRKbXGIUw1y6TdkBvQ8MiUSMAvhN8vOzptVCL1++6+XrD10+f1M+Kuwcedfr1c79xZBvZ4cspBPziz4qCu2eDtruD1qut+b3K8NZMG6A/qQwvz6w9ek660G/b8+NFb/31mKPJO/3e6v82q/Xg0z1fD7fbgEDYfUX8lCyA3KYppPskvD7C6IVmD+I/0pmA+X7Ybj5O2V19q7A4+z5A/0GgLb33U2VJAEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"config system dataset\"\n        title=\"config system dataset\"\n        src=\"/static/890801d921fdc4b0f9de13fb60be5602/5a190/config-system-dataset.png\"\n        srcset=\"/static/890801d921fdc4b0f9de13fb60be5602/772e8/config-system-dataset.png 200w,\n/static/890801d921fdc4b0f9de13fb60be5602/e17e5/config-system-dataset.png 400w,\n/static/890801d921fdc4b0f9de13fb60be5602/5a190/config-system-dataset.png 800w,\n/static/890801d921fdc4b0f9de13fb60be5602/c1b63/config-system-dataset.png 1200w,\n/static/890801d921fdc4b0f9de13fb60be5602/a3a5c/config-system-dataset.png 1277w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>如果要使用上文提到的 Apps 的话，TrueNAS Scale 也会要求你指定存储的位置，考虑到性能和噪声也要把它指向 nvme 的存储。</p>\n<p>所以对于 TrueNAS Scale 来说，最好要准备三个部分的存储：</p>\n<ol>\n<li>系统盘，16 GB 就够了（此处应该有傲腾 M10）：TrueNAS 就是把系统放这里，其他乱七八糟的东西统统要放到额外的存储池里</li>\n<li>主存储，就是放数据的地方，要做好冗余方案：我这里依然选择了老土 HDD，当然还是考虑到价格比较便宜</li>\n<li>应用存储，可以认为是工作空间：把系统日志，Apps 的一些配置什么的都扔这里，对我来说这些数据不是那么重要，我直接就放了一个 m.2 的 nvme。由于这个空间会因为 Apps 的各种操作和系统日志而频繁读写，使用 ssd 很有必要</li>\n</ol>","fields":{"slug_without_date":"/install-limit-hdd-read-write-for-truenas-scale"}}],"pageInfo":{"hasPreviousPage":false,"currentPage":1,"pageCount":49}}},"pageContext":{"limit":3,"skip":0}},"staticQueryHashes":["26522286"],"slicesMap":{}}