{"componentChunkName":"component---src-templates-blog-js","path":"/kubeadm-aws-provider","result":{"data":{"blog":{"id":"a2bf670d-65be-5882-8608-d811b6460bb0","html":"<p>最近一个多月开始折腾在 <strong>国内</strong> 环境部署 kubernetes 集群。是的，确实这还是一个工作内容，和直接在什么 aws googlecloud 或者是 rancher 2.0 直接点点就能创建有一个集群不一样。之所以还要付诸这样的精力去做这件事有两个原因：</p>\n<ol>\n<li>kubernetes 默认部署安装依赖于很多 google 的域名，而因为特殊的国内网络环境，那些自动执行创建集群的工具默认都是不适用的，我不得不把 kubernetes 集群部署搞得一清二楚才能明白具体哪里去 hack 那些被 block 的资源</li>\n<li>我们有自己搭建 bare metal 集群的需求，而那些可以随便点点就能构建集群的方式都是支持公有云的方案</li>\n</ol>\n<p>不过因为我刚刚搞定了 aws 环境下 kubernetes 的部署，趁热打铁我就先记录一下这一部分。</p>\n<h2 id=\"aws-环境下-kubernetes-的特殊性\" style=\"position:relative;\">aws 环境下 kubernetes 的特殊性<a href=\"#aws-%E7%8E%AF%E5%A2%83%E4%B8%8B-kubernetes-%E7%9A%84%E7%89%B9%E6%AE%8A%E6%80%A7\" aria-label=\"aws 环境下 kubernetes 的特殊性 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>k8s 有一个 <code class=\"language-text\">cloud-provider</code> 的概念，其目的是通过和一些公有云的服务集成以达到更好的功能。</p>\n<p>aws 环境下的 k8s 是指 k8s 集成了部分 aws 的服务方便集群的使用。到目前为止，我所知道的包含如下内容：</p>\n<ol>\n<li>ebs 做 persistent volume</li>\n<li>通过 elb 为 <code class=\"language-text\">LoadBalancer</code> 类型的 service 绑定一个外部域名可以直接通过域名去访问</li>\n</ol>\n<p>而这篇文章则是重点介绍如何让 k8s 去支持这些特性，当然会缺少 kubeadm 一些信息，会在另外一篇介绍。</p>\n<h2 id=\"配置\" style=\"position:relative;\">配置<a href=\"#%E9%85%8D%E7%BD%AE\" aria-label=\"配置 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>k8s 现在已经相当庞大，大的跟个操作系统似的。但是很遗憾其文档的成熟度还处于初级阶段，我甚至找不到 <code class=\"language-text\">cloud-provider</code> 配置的一些细节，唯一可靠的文档似乎就是代码，但是一不小心打开一个三四千行的 golang 文件我也是一脸迷茫...最后在一个诡异的 github issue 里面找到了一个 googledoc 解释了 <code class=\"language-text\">cloud-provider=aws</code> 的一些细节。</p>\n<h3 id=\"为-ec2-添加-iam-权限\" style=\"position:relative;\">为 EC2 添加 IAM 权限<a href=\"#%E4%B8%BA-ec2-%E6%B7%BB%E5%8A%A0-iam-%E6%9D%83%E9%99%90\" aria-label=\"为 ec2 添加 iam 权限 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>为了让 k8s 可以操纵 aws 的资源需要为 ec2 添加权限：</p>\n<h4 id=\"for-master\" style=\"position:relative;\">for master<a href=\"#for-master\" aria-label=\"for master permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token key atrule\">\"Version\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token key atrule\">\"Statement\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token key atrule\">\"Effect\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token key atrule\">\"Action\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n\t\t\t\t<span class=\"token string\">\"ec2:*\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"elasticloadbalancing:*\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:GetAuthorizationToken\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:BatchCheckLayerAvailability\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:GetDownloadUrlForLayer\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:GetRepositoryPolicy\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:DescribeRepositories\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:ListImages\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:BatchGetImage\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"autoscaling:DescribeAutoScalingGroups\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"autoscaling:UpdateAutoScalingGroup\"</span>\n\t\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token key atrule\">\"Resource\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*\"</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"for-worker\" style=\"position:relative;\">for worker<a href=\"#for-worker\" aria-label=\"for worker permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token key atrule\">\"Version\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token key atrule\">\"Statement\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token key atrule\">\"Effect\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token key atrule\">\"Action\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n\t\t\t\t<span class=\"token string\">\"ec2:Describe*\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:GetAuthorizationToken\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:BatchCheckLayerAvailability\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:GetDownloadUrlForLayer\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:GetRepositoryPolicy\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:DescribeRepositories\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:ListImages\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"ecr:BatchGetImage\"</span>\n\t\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token key atrule\">\"Resource\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*\"</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"为-ec2-机器添加标签\" style=\"position:relative;\">为 ec2 机器添加标签<a href=\"#%E4%B8%BA-ec2-%E6%9C%BA%E5%99%A8%E6%B7%BB%E5%8A%A0%E6%A0%87%E7%AD%BE\" aria-label=\"为 ec2 机器添加标签 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>为了识别具体哪些 ec2 是集群的一部分需要为每个 ec2 添加一个 <code class=\"language-text\">KubernetesCluster</code> 的 tag。</p>\n<h3 id=\"更新-kubelet-config\" style=\"position:relative;\">更新 kubelet config<a href=\"#%E6%9B%B4%E6%96%B0-kubelet-config\" aria-label=\"更新 kubelet config permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>为了支持 cloud-provider 首先需要在 kubelet 的配置里做相应修改，为 <code class=\"language-text\">/etc/systemd/system/kubelet.service.d/10-kubeadm.conf</code> 添加 <code class=\"language-text\">KUBELET_EXTRA_ARGS</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[Service]\nEnvironment=\"KUBELET_EXTRA_ARGS=--cloud-provider=aws</code></pre></div>\n<h3 id=\"更新-kubeadm-配置\" style=\"position:relative;\">更新 kubeadm 配置<a href=\"#%E6%9B%B4%E6%96%B0-kubeadm-%E9%85%8D%E7%BD%AE\" aria-label=\"更新 kubeadm 配置 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kubeadm.k8s.io/v1alpha1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> MasterConfiguration\n<span class=\"token key atrule\">cloudProvider</span><span class=\"token punctuation\">:</span> aws\n<span class=\"token key atrule\">api</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">advertiseAddress</span><span class=\"token punctuation\">:</span> &lt;internal<span class=\"token punctuation\">-</span>ip<span class=\"token punctuation\">-</span>address<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">apiServerCertSANs</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> &lt;public<span class=\"token punctuation\">-</span>ip<span class=\"token punctuation\">-</span>address<span class=\"token punctuation\">></span>\n<span class=\"token punctuation\">-</span> &lt;public<span class=\"token punctuation\">-</span>hostname<span class=\"token punctuation\">></span></code></pre></div>\n<p>在用 kubeadm 创建集群时采用命令即可</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubeadm init --config=init-config.yaml</code></pre></div>\n<h3 id=\"更新-hostname\" style=\"position:relative;\">更新 hostname<a href=\"#%E6%9B%B4%E6%96%B0-hostname\" aria-label=\"更新 hostname permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>首先先要说明一下，aws 的机器默认的 hostname 是和其 internal dns hostname 不同。默认的是这个样子：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ip-xx-xx-xx-xx</code></pre></div>\n<p>而 internal hostname 则是</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ip-xx-xx-xx-xx.&lt;region>.compute.internal</code></pre></div>\n<p>之类的东西。而 aws kubernetes 需要通过这个 internal dns hostname 去定位 node 所以需要将 hostname 更改成这个。</p>\n<p>先前可以通过 `--hostname-override`` 参数覆盖默认的 aws hostname，但是最近似乎不行了，不如直接修改 hostname 一劳永逸。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl http://169.254.169.254/latest/meta-data/local-hostname > /etc/hostname</code></pre></div>\n<p>然后重启机器使得更新起效。</p>\n<h2 id=\"注意\" style=\"position:relative;\">注意<a href=\"#%E6%B3%A8%E6%84%8F\" aria-label=\"注意 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>如果一开始配置坏了需要重新配置那一定要 kubeadm reset 哦：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubeadm reset\nifconfig cni0 down\nip link delete cni0\nifconfig flannel.1 down\nip link delete flannel.1\nrm -rf /var/lib/cni/</code></pre></div>\n<p>因为我自己安装的 flannel 其他的要看情况修改哦。</p>\n<h2 id=\"相关资料\" style=\"position:relative;\">相关资料<a href=\"#%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99\" aria-label=\"相关资料 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ol>\n<li><a href=\"https://docs.google.com/document/d/17d4qinC_HnIwrK0GHnRlD1FKkTNdN__VO4TH9-EzbIY/edit#\">aws cloud provider</a></li>\n<li><a href=\"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/\">kubeadm</a></li>\n<li><a href=\"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/\">kubeadm init</a></li>\n<li><a href=\"https://medium.com/jane-ai-engineering-blog/kubernetes-on-aws-6281e3a830fe\">Kubernetes on AWS</a></li>\n</ol>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#aws-%E7%8E%AF%E5%A2%83%E4%B8%8B-kubernetes-%E7%9A%84%E7%89%B9%E6%AE%8A%E6%80%A7\">aws 环境下 kubernetes 的特殊性</a></p>\n</li>\n<li>\n<p><a href=\"#%E9%85%8D%E7%BD%AE\">配置</a></p>\n<ul>\n<li>\n<p><a href=\"#%E4%B8%BA-ec2-%E6%B7%BB%E5%8A%A0-iam-%E6%9D%83%E9%99%90\">为 EC2 添加 IAM 权限</a></p>\n<ul>\n<li><a href=\"#for-master\">for master</a></li>\n<li><a href=\"#for-worker\">for worker</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E4%B8%BA-ec2-%E6%9C%BA%E5%99%A8%E6%B7%BB%E5%8A%A0%E6%A0%87%E7%AD%BE\">为 ec2 机器添加标签</a></p>\n</li>\n<li>\n<p><a href=\"#%E6%9B%B4%E6%96%B0-kubelet-config\">更新 kubelet config</a></p>\n</li>\n<li>\n<p><a href=\"#%E6%9B%B4%E6%96%B0-kubeadm-%E9%85%8D%E7%BD%AE\">更新 kubeadm 配置</a></p>\n</li>\n<li>\n<p><a href=\"#%E6%9B%B4%E6%96%B0-hostname\">更新 hostname</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E6%B3%A8%E6%84%8F\">注意</a></p>\n</li>\n<li>\n<p><a href=\"#%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99\">相关资料</a></p>\n</li>\n</ul>","frontmatter":{"title":"用 kubeadm 部署 aws 环境下的 kubernetes","date":"April 24, 2018"}}},"pageContext":{"id":"a2bf670d-65be-5882-8608-d811b6460bb0"}},"staticQueryHashes":[]}