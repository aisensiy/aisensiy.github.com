{"componentChunkName":"component---src-templates-blog-js","path":"/2020/09/21/lxcfs-in-kubernetes/","result":{"data":{"blog":{"id":"723e3ca0-22c6-56db-93d3-080fa150bfdc","html":"<p>在 k8s 中启动的 pod 下的 container 虽然在资源上做了隔离，但是这种隔离对用户通常是不可见的，具体的表现就是使用 <code>top</code> <code>cat /proc/cpuinfo</code> 或者 <code>free -m</code> 等这样的命令的时候看到的依然是宿主机的资源。这种行为在 openbayes 这种为外部用户分配资源的场景会有很强的迷惑性，用户不知道自己到底有多少资源，因为从里面看到的资源和在外面的声明的是不一样的。为了达到容器内外的一致性，我们引入了 lxcfs。</p>\n<h2 id=\"工作原理\" style=\"position:relative;\">工作原理<a href=\"#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86\" aria-label=\"工作原理 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>在 <a href=\"https://linuxcontainers.org/lxcfs/introduction/\">lxcfs 官方</a>的定义里提到它是一个用户空间的文件系统。它主要提供了一系列文件可以覆盖 <code>/proc</code> 用以覆盖系统的这些目录。也就是说，如果想要让容器里看到的资源是已经做了隔离之后的资源，其实就是将系统默认的一些文件通过 mount 的方式进行覆盖。当容器中进程读取相应文件内容时，lxcfs 会从容器对应的 cgroup 中读取正确的资源限制。</p>\n<h2 id=\"lxcfs-的方案调研\" style=\"position:relative;\">lxcfs 的方案调研<a href=\"#lxcfs-%E7%9A%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94\" aria-label=\"lxcfs 的方案调研 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>目前通过搜索引擎可以找到一篇<a href=\"https://developer.aliyun.com/article/566208\">文章</a>介绍了如何在 k8s 中通过 daemonset 安装 lxcfs 以及如何通过 k8s 的 <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#admission-webhooks\">admission-webhook</a> 为 k8s 里的容器默认做这个隔离的绑定，介绍的很清楚，但有一些小问题：</p>\n<ol>\n<li>其使用的 lxcfs 有点老了（3.0.4），直接拿过来用会发现其实 <code>/cpu/online</code> 这个没有解决，会导致在 python 下 <code>os.cpu_count()</code> 依然是错误的，需要升级 lxcfs 才能解决这个<a href=\"https://github.com/lxc/lxcfs/issues/401\">问题</a>。</li>\n<li>通过 hooks 的方式有点像是 meta programming 太随意的修改了 k8s 容器的流程，这可能在后期带来维护的问题，并且我们只有对用户的容器才有做隔离的需求，所以不如就是在容器启动的时候直接处理就好</li>\n</ol>\n<p>因此最终的方案如下：</p>\n<ol>\n<li>依然使用 daemonset 方式安装和启动 lxcfs，但是对其脚本做了升级改造</li>\n<li>在模板中增加绑定即可，不实用 hook 的方式</li>\n</ol>\n<h2 id=\"安装\" style=\"position:relative;\">安装<a href=\"#%E5%AE%89%E8%A3%85\" aria-label=\"安装 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>对 <a href=\"https://github.com/denverdino/lxcfs-admission-webhook/tree/master/lxcfs-image\">https://github.com/denverdino/lxcfs-admission-webhook/tree/master/lxcfs-image</a> 的两个文件做了修改：</p>\n<p><code>Dockerfile:</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FROM ubuntu:18.04\nRUN apt update -y\nRUN apt-get --purge remove lxcfs\nRUN apt install -y wget git libtool m4 autotools-dev automake pkg-config build-essential libfuse-dev libcurl4-openssl-dev libxml2-dev mime-support\nENV LXCFS_VERSION 4.0.5\n\nRUN wget https://github.com/lxc/lxcfs/archive/lxcfs-$LXCFS_VERSION.tar.gz &amp;&amp; \\\n    mkdir /lxcfs &amp;&amp; tar xzvf lxcfs-$LXCFS_VERSION.tar.gz -C /lxcfs --strip-components=1 &amp;&amp; \\\n    cd /lxcfs  &amp;&amp; ./bootstrap.sh &amp;&amp; ./configure &amp;&amp; make\n\nCOPY start.sh /\nCMD [\"/start.sh\"]</code></pre></div>\n<p>主要修改了以下几个方面：</p>\n<ol>\n<li>基础镜像用了 <code>ubuntu</code> 当然相应的依赖也做了对应的修改</li>\n<li>从 github 下载了 4.0.5 版本的 lxcfs 并按照新的编译流程生成执行文件和库，其中在 <code>make</code> 之后会在目录下生成 <code>src/lxcfs</code> <code>src/.libs/liblxcfs.so</code> <code>src/liblxcfs.la</code> 三个文件</li>\n<li>没做 build 阶段，因为产出的镜像并不是很大，就算了...要求更高的同学可以继续修改哦</li>\n</ol>\n<p><code>start.sh:</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token comment\"># Cleanup</span>\nnsenter -m/proc/1/ns/mnt fusermount -u /var/lib/lxcfs <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span> /dev/null <span class=\"token operator\">||</span> <span class=\"token boolean\">true</span>\nnsenter -m/proc/1/ns/mnt <span class=\"token punctuation\">[</span> -L /etc/mtab <span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">\\</span>\n        <span class=\"token function\">sed</span> -i <span class=\"token string\">\"/^lxcfs \\/var\\/lib\\/lxcfs fuse.lxcfs/d\"</span> /etc/mtab\n\n<span class=\"token comment\"># Prepare</span>\n<span class=\"token function\">mkdir</span> -p /usr/local/lib/lxcfs /var/lib/lxcfs\n\n<span class=\"token comment\"># Update lxcfs</span>\n<span class=\"token function\">cp</span> -f /lxcfs/src/lxcfs /usr/local/bin/lxcfs\n<span class=\"token function\">cp</span> -f /lxcfs/src/.libs/liblxcfs.so /usr/local/lib/lxcfs/liblxcfs.so\n<span class=\"token function\">cp</span> -f /lxcfs/src/liblxcfs.la /usr/local/lib/lxcfs/liblxcfs.la\n\n\n<span class=\"token comment\"># Mount</span>\n<span class=\"token builtin class-name\">exec</span> nsenter -m/proc/1/ns/mnt /usr/local/bin/lxcfs /var/lib/lxcfs/ --enable-cfs -l</code></pre></div>\n<p>主要修改如下：</p>\n<ol>\n<li><code>src/lxcfs</code> <code>src/.libs/liblxcfs.so</code> <code>src/liblxcfs.la</code> 这三个输出文件，按照编辑的目标文件做对应的修改</li>\n<li>启动的之后增加了两个参数 <code>--enable-cfs -l</code> 不然 <code>cpu/online</code> 依然不起作用</li>\n</ol>\n<p>Daemonset 就没做什么修改了，仅仅是更改了镜像而已。</p>\n<h2 id=\"绑定\" style=\"position:relative;\">绑定<a href=\"#%E7%BB%91%E5%AE%9A\" aria-label=\"绑定 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>绑定这里提到了是在 openbayes 的构建流程中做了修改：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">volumes:\n  - name: lxcfs-proc-cpuinfo\n    hostPath:\n      path: /var/lib/lxcfs/proc/cpuinfo\n      type: File\n  - name: system-cpu-online\n    hostPath:\n      path: /var/lib/lxcfs/sys/devices/system/cpu/online\n      type: File\n  - name: lxcfs-proc-diskstats\n    hostPath:\n      path: /var/lib/lxcfs/proc/diskstats\n      type: File\n  - name: lxcfs-proc-meminfo\n    hostPath:\n      path: /var/lib/lxcfs/proc/meminfo\n      type: File \n  - name: lxcfs-proc-stat\n    hostPath:\n      path: /var/lib/lxcfs/proc/stat\n      type: File    \n  - name: lxcfs-proc-swaps\n    hostPath:\n      path: /var/lib/lxcfs/proc/swaps\n      type: File\n  - name: lxcfs-proc-uptime\n    hostPath:\n      path: /var/lib/lxcfs/proc/uptime\n      type: File\n  ...</code></pre></div>\n<h2 id=\"测试\" style=\"position:relative;\">测试<a href=\"#%E6%B5%8B%E8%AF%95\" aria-label=\"测试 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>如下所示，在一个分配了 4 个 cpu 20g \b内存的容器里以下命令已经可以显示实际分配的资源数目了：</p>\n<h3 id=\"1-top\" style=\"position:relative;\">1. top<a href=\"#1-top\" aria-label=\"1 top permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 732px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bf117148e9b63ba5a702af12da48fdd5/d0cc0/2020-09-21-14-44-44.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1klEQVQ4y52S18oqQRCE9/0fQ34VFEQRvFNR8UpBEXNcc85Z0Tp8A7OccHcGmpkOU10dnPPppMXE1cB15bqu9vu9TqeTuVerlRbzhe73u16vl97vtw6Hg1qtlgaDgUajkfnD24ozn89Vrzc0mUxUr9fN3el0jJO7VqsZAG7rRyfh7XYzSX4/jgXa7Xbq9XqaTqdqt9vq9/seIODoxHa7XQ2HQ81mM+NfLpf6fD5eBQ6ZCAIQJ8GLxcK8AdputzoejwYQG2XyHo/HRv/7OARHIhEj4XBYwWBQPz8/isViCoVC8vv9SiQS5o3N5/OZmGg0qng8bvyBQMAT53K5qNFoKJPJqFqtqlwuq1KpKJlMKpvNKp/PK5VKGXupVFKxWFQ6nVYul1OhUDCxtIoqEYfGXq9XA8o0mTD9sCUxVVqAHZ0W0LtmsykG+k/JANI/0AG206PprA0t4aNdIwDtimDjMJTv92vEA2SasOCD3TV2DKaUhJ0ksMTHZuDnWDCPIQCUACBvPtMCWDNR1gg2gK3Xa2Mnnpjz+eyBGkDK3Gw25hNvSkSHMb2CHZ+xA4jPJmEvLTsPEDb0xg7DCjoJEDYBG0N7PB6GFYyfz+cf7AwgTuv4n2PBLMNfDM++tFZX4+IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 09 21 14 44 44\"\n        title=\"2020 09 21 14 44 44\"\n        src=\"/static/bf117148e9b63ba5a702af12da48fdd5/d0cc0/2020-09-21-14-44-44.png\"\n        srcset=\"/static/bf117148e9b63ba5a702af12da48fdd5/772e8/2020-09-21-14-44-44.png 200w,\n/static/bf117148e9b63ba5a702af12da48fdd5/e17e5/2020-09-21-14-44-44.png 400w,\n/static/bf117148e9b63ba5a702af12da48fdd5/d0cc0/2020-09-21-14-44-44.png 732w\"\n        sizes=\"(max-width: 732px) 100vw, 732px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"2-free\" style=\"position:relative;\">2. free<a href=\"#2-free\" aria-label=\"2 free permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 621px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9be510ceb4736d793df03cd64d5d895e/3075e/2020-09-21-14-45-18.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjElEQVQI121OwQ6FIAzz/3/QaIgicEABQyAoB2JfuvNrsozRde3knEOKCSEEGGOwbRvO88RxHNj3HTFG6Vpr4ZdlkZm6Wiue58F933jfF9/3YZrnGd57EKUUrOsqRGtNRARNcs4YY+C6LtnjnFJC710MeJSYlFKShiQPMx07hXwzOctaK38sGv4DE/4AZ3ziNT2+1LAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 09 21 14 45 18\"\n        title=\"2020 09 21 14 45 18\"\n        src=\"/static/9be510ceb4736d793df03cd64d5d895e/3075e/2020-09-21-14-45-18.png\"\n        srcset=\"/static/9be510ceb4736d793df03cd64d5d895e/772e8/2020-09-21-14-45-18.png 200w,\n/static/9be510ceb4736d793df03cd64d5d895e/e17e5/2020-09-21-14-45-18.png 400w,\n/static/9be510ceb4736d793df03cd64d5d895e/3075e/2020-09-21-14-45-18.png 621w\"\n        sizes=\"(max-width: 621px) 100vw, 621px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"3-oscpu_count\" style=\"position:relative;\">3. os.cpu_count<a href=\"#3-oscpu_count\" aria-label=\"3 oscpu_count permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 572px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/13883d15bf7aa0bcdf38151061cbb854/a805e/2020-09-21-14-45-37.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.500000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzUlEQVQY062QUYvDIBCE/f+/rm+ltASvSVoNusYkNjFpnGMFSyH3eMLHDLvrOij29w4KBEkSNDjM84y4RqzrmokxZoovynPLshwQaU+QD4nT7YRbdcWPlOi6Dm3bomkaaK2hlEJd15+6tRYhBIzjeECklPAKL3g/wfkR1nl47zFNUx5gLZ6XsGflhH8htm2D1gqX6o6LfOJctXg8FYwxGSLKsHfO5XR93+cHhmE4kBPygCOCswZkTW6Uy5yW+7y01Dnl9/9+I7jBKf/r/AL69M3cB/XEqAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 09 21 14 45 37\"\n        title=\"2020 09 21 14 45 37\"\n        src=\"/static/13883d15bf7aa0bcdf38151061cbb854/a805e/2020-09-21-14-45-37.png\"\n        srcset=\"/static/13883d15bf7aa0bcdf38151061cbb854/772e8/2020-09-21-14-45-37.png 200w,\n/static/13883d15bf7aa0bcdf38151061cbb854/e17e5/2020-09-21-14-45-37.png 400w,\n/static/13883d15bf7aa0bcdf38151061cbb854/a805e/2020-09-21-14-45-37.png 572w\"\n        sizes=\"(max-width: 572px) 100vw, 572px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86\">工作原理</a></p>\n</li>\n<li>\n<p><a href=\"#lxcfs-%E7%9A%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94\">lxcfs 的方案调研</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%AE%89%E8%A3%85\">安装</a></p>\n</li>\n<li>\n<p><a href=\"#%E7%BB%91%E5%AE%9A\">绑定</a></p>\n</li>\n<li>\n<p><a href=\"#%E6%B5%8B%E8%AF%95\">测试</a></p>\n<ul>\n<li><a href=\"#1-top\">1. top</a></li>\n<li><a href=\"#2-free\">2. free</a></li>\n<li><a href=\"#3-oscpu_count\">3. os.cpu_count</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"在 Kubernetes 中使用最新的 LXCFS","date":"September 21, 2020","tags":["lxcfs","kubernetes","docker"]},"excerpt":"在 k8s 中启动的 pod 下的 container 虽然在资源上做了隔离，但是这种隔离对用户通…"}},"pageContext":{"id":"723e3ca0-22c6-56db-93d3-080fa150bfdc"}},"staticQueryHashes":["4202924991"]}