{
    "componentChunkName": "component---src-templates-blog-js",
    "path": "/redux-with-react",
    "result": {"data":{"blog":{"id":"103476c0-0acb-5647-96f6-7ca454f4d10f","html":"<p>沿着上一部分 <a href=\"/redux-get-started\">Get Started Redux</a>，在利用 <code>redux</code> 构建了 <code>store</code> <code>reducer</code> 之后，现在需要给应用提供个 <code>view</code> 了。我们用当下最流行的 <code>react</code>。</p>\n<h2 id=\"prepare-package-for-react-with-redux\" style=\"position:relative;\">prepare package for react with redux<a href=\"#prepare-package-for-react-with-redux\" aria-label=\"prepare package for react with redux permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>安装 <code>react</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm install --save react react-dom react-redux</code></pre></div>\n<p>其中 <code>react</code> <code>react-dom</code> 是 <code>react</code> 的原生包，<code>react-redux</code> 提供了一些方便的方法用来将 <code>redux</code> 和 <code>react</code> 一起使用。后面的代码示例会着重讲解。</p>\n<p>添加 <code>babel</code> 对 <code>jsx</code> 的支持。</p>\n<p><code>jsx</code> 是 <code>react</code> 支持的一种特殊的语法，这种语法用于将 <code>html</code> 写到 <code>js</code> 中，例如</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>\n      Click <span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">}</span> times<span class=\"token punctuation\">.</span>\n      <span class=\"token punctuation\">{</span> <span class=\"token string\">' '</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onIncrement<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">+</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span> <span class=\"token string\">' '</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onDecrement<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">-</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>目前可以认为 <code>jsx</code> 是写 <code>react</code> 的标配，那么就需要在 <code>babel</code> 中添加一个新的 <code>react</code> 翻译器。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm install --save-dev babel-preset-react</code></pre></div>\n<p>然后修改 <code>.babelrc</code></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"es2015\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这样，我们就可以开始写 <code>react</code> 了。</p>\n<h2 id=\"presentational-and-container-components\" style=\"position:relative;\">Presentational and Container Components<a href=\"#presentational-and-container-components\" aria-label=\"presentational and container components permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>在 <code>redux</code> 的官方文档 <a href=\"https://redux.js.org/docs/basics/UsageWithReact.html\">Use With React</a> 解释了一种 <code>redux</code> 和 <code>react</code> 结合的模式：将 <code>react</code> 的组件分为两种，一种是不与 <code>redux</code> 交互的 <code>presentational</code> 组件，它是一种通用的组件，任何提供给它所需要的 <code>func</code> 或者是 <code>prop</code> 的框架都可以使用它。另一种是 <code>container</code> 组件，是和 <code>redux</code> 的 <code>action</code> 以及 <code>store</code> 绑定的组件。通常都是会先写一个 <code>presentational</code> 组件，然后再创建一个 <code>container</code> 组件对 <code>presentational</code> 组件进行包装后使用。后面的 <em>full example</em> 展示了 <code>Counter</code> 与 <code>Visible Counter</code> 两个不同类型的组件。当然在<a href=\"https://redux.js.org/docs/basics/UsageWithReact.html\">官方</a>也提供了非常好的例子。</p>\n<h2 id=\"full-example\" style=\"position:relative;\">full example<a href=\"#full-example\" aria-label=\"full example permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>首先展示一下目录结构</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── actions\n│   └── index.js\n├── components\n│   ├── App.js\n│   └── Counter.js\n├── containers\n│   └── VisibleCounter.js\n├── dist\n│   ├── bundle.js\n│   ├── index.html\n│   └── styles.css\n├── entry.js\n├── package.json\n├── reducers\n│   └── counter.js\n├── styles\n│   ├── index.scss\n│   └── theme.scss\n├── test\n│   └── reducers\n│       └── counter.spec.js\n└── webpack.config.js</code></pre></div>\n<p>相对于之前的目录结构多了两个目录 <code>containers</code> <code>components</code> 分别对应了 <code>container</code> 和 <code>presentational</code> 的组件。</p>\n<p>首先我们定义一个 <code>presentational</code> 的组件 <code>Counter</code></p>\n<p><code>components/Counter.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> PropTypes <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Counter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> value<span class=\"token punctuation\">,</span> onIncrement<span class=\"token punctuation\">,</span> onDecrement <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>\n          Click <span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">}</span> times<span class=\"token punctuation\">.</span>\n          <span class=\"token punctuation\">{</span> <span class=\"token string\">' '</span> <span class=\"token punctuation\">}</span>\n          <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onIncrement<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">+</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n          <span class=\"token punctuation\">{</span> <span class=\"token string\">' '</span> <span class=\"token punctuation\">}</span>\n          <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onDecrement<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">-</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nCounter<span class=\"token punctuation\">.</span>PropTypes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  value<span class=\"token operator\">:</span> PropTypes<span class=\"token punctuation\">.</span>number<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n  onIncrement<span class=\"token operator\">:</span> PropTypes<span class=\"token punctuation\">.</span>func<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n  onDecrement<span class=\"token operator\">:</span> PropTypes<span class=\"token punctuation\">.</span>func<span class=\"token punctuation\">.</span>isRequired\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Counter<span class=\"token punctuation\">;</span></code></pre></div>\n<p>注意 <code>PropTypes</code> 有点像是一个函数的参数说明，它明确的定义了在使用这个组件时需要提供什么样子的东西，<code>react</code> 官方建议一定要对每一个组件都明确的定义这样的参数说明，它也起到了文档的作用，方便与其他人协作。这里我们需要三个东西：</p>\n<ol>\n<li><code>value</code> 当前的计数</li>\n<li><code>onIncrement</code> 当点击 <code>+</code> 时的动作</li>\n<li><code>onDecrement</code> 当点击 <code>-</code> 时的动作</li>\n</ol>\n<p>然后对 <code>Counter</code> 进行包装</p>\n<p><code>containers/VisibleCounter.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> connect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-redux'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Counter <span class=\"token keyword\">from</span> <span class=\"token string\">\"../components/Counter\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> increment<span class=\"token punctuation\">,</span> decrement <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../actions/index'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">mapStatToProps</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    value<span class=\"token operator\">:</span> state\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">mapDispatchToProps</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dispatch</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">onIncrement</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">onDecrement</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">decrement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> VisibleCounter <span class=\"token operator\">=</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>\n    mapStatToProps<span class=\"token punctuation\">,</span>\n    mapDispatchToProps\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>Counter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> VisibleCounter<span class=\"token punctuation\">;</span></code></pre></div>\n<p>这里用到了一个 <code>react-redux</code> 提供的方法 <code>connect</code> 它和下文提到的 <code>Provider</code> 配合使用，用于为 <code>react</code> 传递全局的 <code>store</code>。<code>connect</code> 需要两个函数 <code>mapStatToProps</code> 与 <code>mapDispatchToProps</code> 分别将 <code>store</code> 里的属性和 <code>store</code> 的 <code>dispatch</code> 动作传递给 <code>presentational</code> 组件。上面的代码就分别将 <code>store</code> 的 <code>state</code> 对应给组件的 <code>value</code> 属性，将两个 <code>action</code> 的 <code>dispatch</code> 对应到 <code>onIncrement</code> 与 <code>onDecrement</code>。</p>\n<p>然后还有一个 <code>App</code> 组件，用于包装 <code>VisibleCounter</code>，它没有任何依赖的属性。</p>\n<p><code>components/App.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import React, { Component } from 'react';\nimport VisibleCounter from '../containers/VisibleCounter';\n\nclass App extends Component {\n  render() {\n    return (\n        &lt;div>\n          &lt;VisibleCounter />\n        &lt;/div>\n    )\n  }\n}\n\nexport default App;</code></pre></div>\n<p>最后我们修改 <code>entry.js</code> 将 <code>store</code> 与我们的视图绑定起来。</p>\n<p><code>entry.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">require('./styles/index.scss');\n\nimport React from \"react\";\nimport ReactDOM from 'react-dom';\nimport counter from './reducers/counter';\nimport { Provider } from 'react-redux';\nimport App from './components/App';\nimport { createStore } from 'redux';\n\nconst store = createStore(counter);\nconst rootEl = document.querySelector(\"#root\");\n\nfunction render() {\n  ReactDOM.render(\n      &lt;Provider store={store}>\n        &lt;App />\n      &lt;/Provider>,\n      rootEl\n  )\n}\n\nrender();\nstore.subscribe(render);</code></pre></div>\n<p>这里就用到了 <code>Provider</code> 方法，将 <code>store</code> 传递给 <code>App</code>，然后用 <code>ReactDOM</code> 在页面上生成 <code>react</code> 组件。</p>\n<h2 id=\"参考\" style=\"position:relative;\">参考<a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ol>\n<li><a href=\"https://redux.js.org\">redux</a></li>\n<li><a href=\"https://github.com/reactjs/redux/tree/master/examples/counter\">redux counter example</a></li>\n<li><a href=\"https://redux.js.org/docs/basics/UsageWithReact.html\">use with react</a></li>\n<li><a href=\"https://babeljs.io/docs/usage/babelrc/\">babelrc</a></li>\n</ol>","tableOfContents":"<ul>\n<li><a href=\"#prepare-package-for-react-with-redux\">prepare package for react with redux</a></li>\n<li><a href=\"#presentational-and-container-components\">Presentational and Container Components</a></li>\n<li><a href=\"#full-example\">full example</a></li>\n<li><a href=\"#%E5%8F%82%E8%80%83\">参考</a></li>\n</ul>","frontmatter":{"title":"Redux with react","date":"May 12, 2016"},"excerpt":"沿着上一部分 Get Started Redux，在利用 redux 构建了 store redu…"}},"pageContext":{"id":"103476c0-0acb-5647-96f6-7ca454f4d10f"}},
    "staticQueryHashes": ["4202924991"]}