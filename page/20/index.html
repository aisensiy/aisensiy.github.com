<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.08fccb0df62266f5c2e2.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}

/*! tailwindcss v2.2.4 | MIT License | https://tailwindcss.com */

/*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */html{-webkit-text-size-adjust:100%;line-height:1.15;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;margin:0}hr{color:inherit;height:0}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}button{-webkit-appearance:button}legend{padding:0}progress{vertical-align:baseline}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{border:0 solid;box-sizing:border-box}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{color:inherit;line-height:inherit;padding:0}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}*,:after,:before{--tw-border-opacity:1;border-color:rgba(229,231,235,var(--tw-border-opacity))}body{background-color:rgba(255,255,255,var(--tw-bg-opacity))}.dark body,body{--tw-bg-opacity:1}.dark body{background-color:rgba(55,65,81,var(--tw-bg-opacity))}body{transition-duration:.15s;transition-duration:.5s;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.main .permalink{fill:currentColor;--tw-text-opacity:1;color:rgba(31,41,55,var(--tw-text-opacity))}.dark .main .permalink{--tw-text-opacity:1;color:rgba(229,231,235,var(--tw-text-opacity))}.main{color:rgba(31,41,55,var(--tw-text-opacity))}.dark .main,.main{--tw-text-opacity:1}.dark .main{color:rgba(229,231,235,var(--tw-text-opacity))}.main h1{font-size:1.875rem;font-weight:800;letter-spacing:-.025em;line-height:2.25rem;margin-bottom:1rem;margin-top:1rem}@media (min-width:768px){.main h1{font-size:2.25rem;line-height:2.5rem}}.main h2{--tw-text-opacity:1;color:rgba(75,85,99,var(--tw-text-opacity));margin-bottom:1rem}.dark .main h2{--tw-text-opacity:1;color:rgba(209,213,219,var(--tw-text-opacity))}.main :not(pre)>code{--tw-bg-opacity:1;--tw-text-opacity:1;background-color:rgba(229,231,235,var(--tw-bg-opacity));color:rgba(107,114,128,var(--tw-text-opacity));font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;margin-left:.25rem;margin-right:.25rem;padding-left:.25rem;padding-right:.25rem}.main{overflow-wrap:break-word}.blog-post-content h2{font-size:1.5rem;font-weight:800;letter-spacing:-.025em;line-height:2rem;margin-bottom:.75rem;margin-top:.75rem}@media (min-width:768px){.blog-post-content h2{font-size:1.875rem;line-height:2.25rem}}.blog-post-content h3{font-size:1.25rem;font-weight:800;letter-spacing:-.025em;line-height:1.75rem;margin-bottom:.75rem;margin-top:.75rem}@media (min-width:768px){.blog-post-content h3{font-size:1.5rem;line-height:2rem}}.blog-post-content h4{font-weight:800;letter-spacing:-.025em;margin-bottom:.75rem;margin-top:.75rem}@media (min-width:768px){.blog-post-content h4{font-size:1.25rem;line-height:1.75rem}}.main ol,.main ul{margin-bottom:1rem;margin-left:1rem}.main ul{list-style-type:disc}.main ol{list-style-position:inside;list-style-type:decimal}.main a{--tw-text-opacity:1;color:rgba(37,99,235,var(--tw-text-opacity))}.dark .main a{--tw-text-opacity:1;color:rgba(96,165,250,var(--tw-text-opacity))}.main a:hover{text-decoration:underline}.main img{--tw-border-opacity:1;--tw-shadow:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);border-color:rgba(229,231,235,var(--tw-border-opacity));border-radius:.75rem;border-width:1px;box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.main blockquote{--tw-border-opacity:1;border-color:rgba(209,213,219,var(--tw-border-opacity));border-left-width:4px;padding-left:1.5rem}.main p,.table-of-content{margin-bottom:1rem}.table-of-content{--tw-border-opacity:1;border-color:rgba(59,130,246,var(--tw-border-opacity));border-width:1px;display:inline-block;margin-top:1rem;overflow:auto}.dark .table-of-content{--tw-border-opacity:1;border-color:rgba(30,64,175,var(--tw-border-opacity))}.table-of-content{--tw-bg-opacity:1;background-color:rgba(191,219,254,var(--tw-bg-opacity))}.dark .table-of-content{--tw-bg-opacity:1;background-color:rgba(59,130,246,var(--tw-bg-opacity))}.table-of-content{padding:1rem}.main .table-of-content a{--tw-text-opacity:1;color:rgba(31,41,55,var(--tw-text-opacity))}.dark .main .table-of-content a{--tw-text-opacity:1;color:rgba(229,231,235,var(--tw-text-opacity))}.table-of-content ul{margin-bottom:0}.table-of-content h2{font-size:1.25rem;font-weight:600;letter-spacing:-.025em;line-height:1.75rem;margin-bottom:.75rem;margin-top:.75rem}.table-of-content p{display:inline;margin:0}.bottom-0{bottom:0}.m-0{margin:0}.mx-4{margin-left:1rem;margin-right:1rem}.mx-12{margin-left:3rem;margin-right:3rem}.mx-auto{margin-left:auto;margin-right:auto}.my-4{margin-bottom:1rem;margin-top:1rem}.mt-8{margin-top:2rem}.mb-4{margin-bottom:1rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.table{display:table}.h-5{height:1.25rem}.w-5{width:1.25rem}.w-32{width:8rem}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{opacity:0;transform:scale(2)}}@keyframes ping{75%,to{opacity:0;transform:scale(2)}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1);transform:translateY(-25%)}50%{-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);transform:none}}@keyframes bounce{0%,to{-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1);transform:translateY(-25%)}50%{-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);transform:none}}.list-inside{list-style-position:inside}.list-disc{list-style-type:disc}.list-decimal{list-style-type:decimal}.flex-row{flex-direction:row}.justify-center{justify-content:center}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(.25rem*var(--tw-space-y-reverse));margin-top:calc(.25rem*(1 - var(--tw-space-y-reverse)))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(2rem*var(--tw-space-y-reverse));margin-top:calc(2rem*(1 - var(--tw-space-y-reverse)))}.overflow-auto{overflow:auto}.rounded-xl{border-radius:.75rem}.border{border-width:1px}.border-l-4{border-left-width:4px}.border-solid{border-style:solid}.border-gray-200{--tw-border-opacity:1;border-color:rgba(229,231,235,var(--tw-border-opacity))}.border-gray-300{--tw-border-opacity:1;border-color:rgba(209,213,219,var(--tw-border-opacity))}.border-gray-800{--tw-border-opacity:1;border-color:rgba(31,41,55,var(--tw-border-opacity))}.border-blue-500{--tw-border-opacity:1;border-color:rgba(59,130,246,var(--tw-border-opacity))}.dark .dark\:border-blue-800{--tw-border-opacity:1;border-color:rgba(30,64,175,var(--tw-border-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgba(229,231,235,var(--tw-bg-opacity))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgba(17,24,39,var(--tw-bg-opacity))}.bg-blue-200{--tw-bg-opacity:1;background-color:rgba(191,219,254,var(--tw-bg-opacity))}.dark .dark\:bg-gray-700{--tw-bg-opacity:1;background-color:rgba(55,65,81,var(--tw-bg-opacity))}.fill-current{fill:currentColor}.p-4{padding:1rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-4{padding-left:1rem;padding-right:1rem}.py-1{padding-bottom:.25rem;padding-top:.25rem}.py-12{padding-bottom:3rem;padding-top:3rem}.text-center{text-align:center}.font-serif{font-family:ui-serif,Georgia,Cambria,Times New Roman,Times,serif}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-6xl{font-size:3.75rem;line-height:1}.font-semibold{font-weight:600}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.font-black{font-weight:900}.leading-7{line-height:1.75rem}.tracking-tight{letter-spacing:-.025em}.text-white{--tw-text-opacity:1;color:rgba(255,255,255,var(--tw-text-opacity))}.text-gray-400{--tw-text-opacity:1;color:rgba(156,163,175,var(--tw-text-opacity))}.text-gray-500{--tw-text-opacity:1;color:rgba(107,114,128,var(--tw-text-opacity))}.text-gray-600{--tw-text-opacity:1;color:rgba(75,85,99,var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgba(31,41,55,var(--tw-text-opacity))}.text-blue-600{--tw-text-opacity:1;color:rgba(37,99,235,var(--tw-text-opacity))}.hover\:underline:hover{text-decoration:underline}*,:after,:before{--tw-shadow:0 0 #0000;--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000}.transition{transition-duration:.15s;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}@media (min-width:768px){.md\:fixed{position:fixed}.md\:absolute{position:absolute}.md\:ml-80{margin-left:20rem}.md\:h-full{height:100%}.md\:w-80{width:20rem}.md\:max-w-6xl{max-width:72rem}.md\:p-8{padding:2rem}.md\:text-left{text-align:left}.md\:text-xl{font-size:1.25rem;line-height:1.75rem}.md\:text-2xl{font-size:1.5rem;line-height:2rem}.md\:text-3xl{font-size:1.875rem;line-height:2.25rem}.md\:text-4xl{font-size:2.25rem;line-height:2.5rem}}</style><meta name="generator" content="Gatsby 3.9.1"/><title data-react-helmet="true">aisensiy-s-blog</title><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><style type="text/css">
    .custom-class.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .custom-class.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .custom-class svg,
    h2 .custom-class svg,
    h3 .custom-class svg,
    h4 .custom-class svg,
    h5 .custom-class svg,
    h6 .custom-class svg {
      visibility: hidden;
    }
    h1:hover .custom-class svg,
    h2:hover .custom-class svg,
    h3:hover .custom-class svg,
    h4:hover .custom-class svg,
    h5:hover .custom-class svg,
    h6:hover .custom-class svg,
    h1 .custom-class:focus svg,
    h2 .custom-class:focus svg,
    h3 .custom-class:focus svg,
    h4 .custom-class:focus svg,
    h5 .custom-class:focus svg,
    h6 .custom-class:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 100)
          }), 0)
        }
      }
    })
  </script><link as="script" rel="preload" href="/webpack-runtime-2855cafaad6fd1ef06ee.js"/><link as="script" rel="preload" href="/framework-e728256d7a1d703d32c2.js"/><link as="script" rel="preload" href="/app-7decc5285b369d37659c.js"/><link as="script" rel="preload" href="/75ce8a9e25edca21eb9c1a1dab0250d3ee550bef-e9b300a9f21137291b3a.js"/><link as="script" rel="preload" href="/component---src-templates-blogs-js-49c4c7b7e8475895eb83.js"/><link as="fetch" rel="preload" href="/page-data/page/20/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="md:text-left text-center md:fixed md:w-80 bg-gray-900 md:h-full text-white"><div class="p-4 mx-auto text-center"><button aria-label="Activate Light Mode" title="Activate Light Mode" class="text-center"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" role="img"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg></button></div><div class="md:absolute bottom-0 py-12 mx-12 space-y-8"><h1 class="text-6xl font-black font-serif">Eisen&#x27;s Blog</h1><nav><ul class="text-md flex-row"><li><a class="leading-7 block hover:underline" href="/">Home</a></li><li><a class="leading-7 block hover:underline" href="/about">About</a></li><li><a class="leading-7 block hover:underline" href="/archive">Archive</a></li><li><a href="https://github.com/aisensiy" target="_blank" rel="noreferrer" class="leading-7 block hover:underline">GitHub</a></li></ul></nav><footer class="text-gray-400">© <!-- -->2021<!-- -->. All rights reserved.</footer></div></div><div class="md:ml-80 p-4 md:p-8 md:max-w-6xl main"><div><div><h1><a href="/redux-with-react">Redux with react</a></h1><h2>2016 May-12</h2><div class="blog-post-content"><p>沿着上一部分 <a href="/redux-get-started">Get Started Redux</a>，在利用 <code class="language-text">redux</code> 构建了 <code class="language-text">store</code> <code class="language-text">reducer</code> 之后，现在需要给应用提供个 <code class="language-text">view</code> 了。我们用当下最流行的 <code class="language-text">react</code>。</p>
<h2 id="prepare-package-for-react-with-redux" style="position:relative;">prepare package for react with redux<a href="#prepare-package-for-react-with-redux" aria-label="prepare package for react with redux permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>安装 <code class="language-text">react</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ npm install --save react react-dom react-redux</code></pre></div>
<p>其中 <code class="language-text">react</code> <code class="language-text">react-dom</code> 是 <code class="language-text">react</code> 的原生包，<code class="language-text">react-redux</code> 提供了一些方便的方法用来将 <code class="language-text">redux</code> 和 <code class="language-text">react</code> 一起使用。后面的代码示例会着重讲解。</p>
<p>添加 <code class="language-text">babel</code> 对 <code class="language-text">jsx</code> 的支持。</p>
<p><code class="language-text">jsx</code> 是 <code class="language-text">react</code> 支持的一种特殊的语法，这种语法用于将 <code class="language-text">html</code> 写到 <code class="language-text">js</code> 中，例如</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span>
      Click <span class="token punctuation">{</span>value<span class="token punctuation">}</span> times<span class="token punctuation">.</span>
      <span class="token punctuation">{</span> <span class="token string">' '</span> <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onIncrement<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span> <span class="token string">' '</span> <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onDecrement<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token punctuation">)</span></code></pre></div>
<p>目前可以认为 <code class="language-text">jsx</code> 是写 <code class="language-text">react</code> 的标配，那么就需要在 <code class="language-text">babel</code> 中添加一个新的 <code class="language-text">react</code> 翻译器。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ npm install --save-dev babel-preset-react</code></pre></div>
<p>然后修改 <code class="language-text">.babelrc</code></p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"es2015"</span><span class="token punctuation">,</span> <span class="token string">"react"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>这样，我们就可以开始写 <code class="language-text">react</code> 了。</p>
<h2 id="presentational-and-container-components" style="position:relative;">Presentational and Container Components<a href="#presentational-and-container-components" aria-label="presentational and container components permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>在 <code class="language-text">redux</code> 的官方文档 <a href="https://redux.js.org/docs/basics/UsageWithReact.html">Use With React</a> 解释了一种 <code class="language-text">redux</code> 和 <code class="language-text">react</code> 结合的模式：将 <code class="language-text">react</code> 的组件分为两种，一种是不与 <code class="language-text">redux</code> 交互的 <code class="language-text">presentational</code> 组件，它是一种通用的组件，任何提供给它所需要的 <code class="language-text">func</code> 或者是 <code class="language-text">prop</code> 的框架都可以使用它。另一种是 <code class="language-text">container</code> 组件，是和 <code class="language-text">redux</code> 的 <code class="language-text">action</code> 以及 <code class="language-text">store</code> 绑定的组件。通常都是会先写一个 <code class="language-text">presentational</code> 组件，然后再创建一个 <code class="language-text">container</code> 组件对 <code class="language-text">presentational</code> 组件进行包装后使用。后面的 <em>full example</em> 展示了 <code class="language-text">Counter</code> 与 <code class="language-text">Visible Counter</code> 两个不同类型的组件。当然在<a href="https://redux.js.org/docs/basics/UsageWithReact.html">官方</a>也提供了非常好的例子。</p>
<h2 id="full-example" style="position:relative;">full example<a href="#full-example" aria-label="full example permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>首先展示一下目录结构</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">.
├── actions
│   └── index.js
├── components
│   ├── App.js
│   └── Counter.js
├── containers
│   └── VisibleCounter.js
├── dist
│   ├── bundle.js
│   ├── index.html
│   └── styles.css
├── entry.js
├── package.json
├── reducers
│   └── counter.js
├── styles
│   ├── index.scss
│   └── theme.scss
├── test
│   └── reducers
│       └── counter.spec.js
└── webpack.config.js</code></pre></div>
<p>相对于之前的目录结构多了两个目录 <code class="language-text">containers</code> <code class="language-text">components</code> 分别对应了 <code class="language-text">container</code> 和 <code class="language-text">presentational</code> 的组件。</p>
<p>首先我们定义一个 <code class="language-text">presentational</code> 的组件 <code class="language-text">Counter</code></p>
<p><code class="language-text">components/Counter.js</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> PropTypes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> onIncrement<span class="token punctuation">,</span> onDecrement <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span>
          Click <span class="token punctuation">{</span>value<span class="token punctuation">}</span> times<span class="token punctuation">.</span>
          <span class="token punctuation">{</span> <span class="token string">' '</span> <span class="token punctuation">}</span>
          <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onIncrement<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
          <span class="token punctuation">{</span> <span class="token string">' '</span> <span class="token punctuation">}</span>
          <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onDecrement<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Counter<span class="token punctuation">.</span>PropTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
  onIncrement<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
  onDecrement<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">.</span>isRequired
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Counter<span class="token punctuation">;</span></code></pre></div>
<p>注意 <code class="language-text">PropTypes</code> 有点像是一个函数的参数说明，它明确的定义了在使用这个组件时需要提供什么样子的东西，<code class="language-text">react</code> 官方建议一定要对每一个组件都明确的定义这样的参数说明，它也起到了文档的作用，方便与其他人协作。这里我们需要三个东西：</p>
<ol>
<li><code class="language-text">value</code> 当前的计数</li>
<li><code class="language-text">onIncrement</code> 当点击 <code class="language-text">+</code> 时的动作</li>
<li><code class="language-text">onDecrement</code> 当点击 <code class="language-text">-</code> 时的动作</li>
</ol>
<p>然后对 <code class="language-text">Counter</code> 进行包装</p>
<p><code class="language-text">containers/VisibleCounter.js</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">"../components/Counter"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> increment<span class="token punctuation">,</span> decrement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../actions/index'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">mapStatToProps</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">mapDispatchToProps</span><span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onIncrement</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onDecrement</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> VisibleCounter <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>
    mapStatToProps<span class="token punctuation">,</span>
    mapDispatchToProps
<span class="token punctuation">)</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> VisibleCounter<span class="token punctuation">;</span></code></pre></div>
<p>这里用到了一个 <code class="language-text">react-redux</code> 提供的方法 <code class="language-text">connect</code> 它和下文提到的 <code class="language-text">Provider</code> 配合使用，用于为 <code class="language-text">react</code> 传递全局的 <code class="language-text">store</code>。<code class="language-text">connect</code> 需要两个函数 <code class="language-text">mapStatToProps</code> 与 <code class="language-text">mapDispatchToProps</code> 分别将 <code class="language-text">store</code> 里的属性和 <code class="language-text">store</code> 的 <code class="language-text">dispatch</code> 动作传递给 <code class="language-text">presentational</code> 组件。上面的代码就分别将 <code class="language-text">store</code> 的 <code class="language-text">state</code> 对应给组件的 <code class="language-text">value</code> 属性，将两个 <code class="language-text">action</code> 的 <code class="language-text">dispatch</code> 对应到 <code class="language-text">onIncrement</code> 与 <code class="language-text">onDecrement</code>。</p>
<p>然后还有一个 <code class="language-text">App</code> 组件，用于包装 <code class="language-text">VisibleCounter</code>，它没有任何依赖的属性。</p>
<p><code class="language-text">components/App.js</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">import React, { Component } from 'react';
import VisibleCounter from '../containers/VisibleCounter';

class App extends Component {
  render() {
    return (
        &lt;div>
          &lt;VisibleCounter />
        &lt;/div>
    )
  }
}

export default App;</code></pre></div>
<p>最后我们修改 <code class="language-text">entry.js</code> 将 <code class="language-text">store</code> 与我们的视图绑定起来。</p>
<p><code class="language-text">entry.js</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">require('./styles/index.scss');

import React from "react";
import ReactDOM from 'react-dom';
import counter from './reducers/counter';
import { Provider } from 'react-redux';
import App from './components/App';
import { createStore } from 'redux';

const store = createStore(counter);
const rootEl = document.querySelector("#root");

function render() {
  ReactDOM.render(
      &lt;Provider store={store}>
        &lt;App />
      &lt;/Provider>,
      rootEl
  )
}

render();
store.subscribe(render);</code></pre></div>
<p>这里就用到了 <code class="language-text">Provider</code> 方法，将 <code class="language-text">store</code> 传递给 <code class="language-text">App</code>，然后用 <code class="language-text">ReactDOM</code> 在页面上生成 <code class="language-text">react</code> 组件。</p>
<h2 id="参考" style="position:relative;">参考<a href="#%E5%8F%82%E8%80%83" aria-label="参考 permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<ol>
<li><a href="https://redux.js.org">redux</a></li>
<li><a href="https://github.com/reactjs/redux/tree/master/examples/counter">redux counter example</a></li>
<li><a href="https://redux.js.org/docs/basics/UsageWithReact.html">use with react</a></li>
<li><a href="https://babeljs.io/docs/usage/babelrc/">babelrc</a></li>
</ol></div></div><div><h1><a href="/redux-with-react-router">Redux with react router</a></h1><h2>2016 May-12</h2><div class="blog-post-content"><p>沿着上一部分 <a href="/redux-with-react">Redux With React</a>，在利用 <code class="language-text">redux</code> 与 <code class="language-text">react</code> 构建了单个视图的 WebApp，这部分介绍 <code class="language-text">redux</code> 与 <code class="language-text">react-router</code> 结合实现多个视图的 WebApp，代码也是在上一部分的基础上做修改。</p>
<h2 id="prepare-package-for-react-router" style="position:relative;">prepare package for react-router<a href="#prepare-package-for-react-router" aria-label="prepare package for react router permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p><code class="language-text">react-router</code> 提供了 <code class="language-text">react</code> 的路由机制，除了这个库之外还有另外一个库 <code class="language-text">react-router-redux</code> 用官方文档的话来说，首先 <code class="language-text">redux</code> 可以和 <code class="language-text">react-router</code> 两个一起使用就可以解决路由的问题，但是如果考虑到一些辅助的功能（例如和 Redux DevTool 等一起使用），就很有必要使用 <code class="language-text">react-router-redux</code> 了。而且其实两者的结合非常的简单，我这里就先把它加上了。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ npm install --save react-router react-router-redux</code></pre></div>
<h2 id="更新代码支持-router" style="position:relative;">更新代码支持 Router<a href="#%E6%9B%B4%E6%96%B0%E4%BB%A3%E7%A0%81%E6%94%AF%E6%8C%81-router" aria-label="更新代码支持 router permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>在不改变之前单个 <code class="language-text">VisibleCounter</code> 的视图的前提下引入 <code class="language-text">router</code>。首先看一下代码的目录结构。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">.
├── actions
│   └── index.js
├── components
│   ├── App.js
│   └── Counter.js
├── containers
│   └── VisibleCounter.js ++
├── dist
│   ├── bundle.js
│   ├── index.html
│   └── styles.css
├── entry.js ++
├── package.json
├── reducers
│   ├── counter.js
│   └── index.js ++
├── routes.js ++
├── styles
│   ├── index.scss
│   └── theme.scss
└── webpack.config.js</code></pre></div>
<p>其中新添加或者是有修改的文件都用 <code class="language-text">++</code> 做了标记，可以看到作为 components(presentational) 在引入其他的组件的时候并没有收到影响，而 containers 则会因为 <code class="language-text">store</code> 的变化而变化。</p>
<p>为了支持 <code class="language-text">router</code> 需要做这么几件事情：</p>
<ol>
<li>
<p>用 <code class="language-text">react-router</code> 提供的 <code class="language-text">Route</code> 标签声明路由结构
这里就是一个路由 <code class="language-text">/</code> 对应组件 <code class="language-text">App</code>，而 <code class="language-text">App</code> 里面包含一个 <code class="language-text">VisibleCounter</code></p>
<p><code class="language-text">routes.js</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token punctuation">{</span> Route <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router'</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./components/App'</span><span class="token punctuation">;</span>
 
 <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>
     <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>App<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
 <span class="token punctuation">)</span></code></pre></div>
</li>
<li>
<p>在原有的 <code class="language-text">reducer</code> 中添加 <code class="language-text">react-router-redux</code> 所提供的路由的 <code class="language-text">reducer</code>，这里通过 <code class="language-text">redux</code> 所提供的 <code class="language-text">combineReducers</code> 实现。</p>
<p><code class="language-text">reducers/index.js</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> counter <span class="token keyword">from</span> <span class="token string">'./counter'</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token punctuation">{</span> routerReducer <span class="token keyword">as</span> routing <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-redux'</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
 
 <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   counter<span class="token punctuation">,</span>
   routing
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>由于 <code class="language-text">reducer</code> 做了调整，那么在 <code class="language-text">VisibleCounter</code> 与 <code class="language-text">store</code> 链接时也会有改变，在下面的代码中我用 <code class="language-text">++</code> 标识修改的部分</p>
<p><code class="language-text">containers/VisibleCounter.js</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">"../components/Counter"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> increment<span class="token punctuation">,</span> decrement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../actions/index'</span><span class="token punctuation">;</span>
 
 <span class="token keyword">function</span> <span class="token function">mapStatToProps</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token punctuation">{</span>
     value<span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token comment">//++</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 	
 <span class="token keyword">function</span> <span class="token function">mapDispatchToProps</span><span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">onIncrement</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
       <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token function-variable function">onDecrement</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
       <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 	
 <span class="token keyword">const</span> VisibleCounter <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>
     mapStatToProps<span class="token punctuation">,</span>
     mapDispatchToProps
 <span class="token punctuation">)</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	
 <span class="token keyword">export</span> <span class="token keyword">default</span> VisibleCounter<span class="token punctuation">;</span></code></pre></div>
</li>
<li>
<p>修改入口，用 <code class="language-text">react-router</code> 所提供的 <code class="language-text">&lt;Router></code> 标签包装整个应用，并以属性的方式传递路由结构(<code class="language-text">routes</code>)和所需要的浏览器历史(<code class="language-text">history</code>)支持（<code class="language-text">hash</code> 或者是 <code class="language-text">browser</code>）</p>
<p><code class="language-text">entry.js</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"> require('./styles/index.scss');

 import React from "react";
 import ReactDOM from 'react-dom';
 import { Provider } from 'react-redux';
 import { hashHistory, Router } from 'react-router';
 import { syncHistoryWithStore } from 'react-router-redux';
 import { createStore } from 'redux';
 
 import reducer from './reducers/index';
 import routes from './routes';
 
 const store = createStore(reducer);
 const history = syncHistoryWithStore(hashHistory, store);
 const rootEl = document.querySelector("#root");
 
 function render() {
   ReactDOM.render(
       &lt;Provider store={store}>
         &lt;Router routes={routes} history={history}/>
       &lt;/Provider>,
       rootEl
   )
 }
 
 render();
 store.subscribe(render);</code></pre></div>
</li>
</ol>
<h2 id="添加一个新的视图" style="position:relative;">添加一个新的视图<a href="#%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E8%A7%86%E5%9B%BE" aria-label="添加一个新的视图 permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>现在添加一个新的视图 <code class="language-text">About</code></p>
<p><code class="language-text">containers/About.js</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">import React, { Component, PropTypes } from 'react';

class About extends Component {
  render() {
    return (
        &lt;p>
          This is about page.
        &lt;/p>
    )
  }
}

export default About;</code></pre></div>
<p>拆分 <code class="language-text">App</code> 和 <code class="language-text">VisibleCounter</code> 使得 <code class="language-text">App</code> 作为支持所有子视图的框架</p>
<p><code class="language-text">containres/App.js</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">import React, { Component } from 'react';

class App extends Component {
  render() {
    const { children } = this.props.children;
    return (
        &lt;div>
          { children }
        &lt;/div>
    )
  }
}

export default App;</code></pre></div>
<p>更新路由，添加 <code class="language-text">/</code> 下的两个子路由 <code class="language-text">counter</code> 和 <code class="language-text">about</code></p>
<p><code class="language-text">routes.js</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">import React from 'react';
import { Route, IndexRoute } from 'react-router';
import App from './components/App';
import VisibleCounter from './containers/VisibleCounter';
import About from './components/About';

export default (
    &lt;Route path="/" component={App}>
      &lt;IndexRoute component={VisibleCounter}/>
      &lt;Route path="/counter" component={VisibleCounter}/>
      &lt;Route path="/about" component={About}/>
    &lt;/Route>
)</code></pre></div>
<p>其中 <code class="language-text">IndexRoute</code> 表明 <code class="language-text">VisibleCounter</code> 为在 <code class="language-text">/</code> 时的默认路由。</p>
<p>在执行 <code class="language-text">npm start</code> 之后看看 <code class="language-text">http://localhost:8080/</code> 是不是计数器？<code class="language-text">http://localhost:8080/#/about</code> 是不是我们的 <code class="language-text">About</code> 页面？</p>
<h2 id="其他内容" style="position:relative;">其他内容<a href="#%E5%85%B6%E4%BB%96%E5%86%85%E5%AE%B9" aria-label="其他内容 permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>这里讲解了基本的路由的构建，当然路由还不仅仅有这些内容啦，还有 <code class="language-text">&lt;Link></code> <code class="language-text">pushState</code> 等等内容，其中 <code class="language-text">&lt;Link></code> 的内容可以到 <a href="https://github.com/reactjs/react-router-tutorial">https://github.com/reactjs/react-router-tutorial</a>
来看，然后其他部分在以后遇到的时候再解释。</p>
<h2 id="参考" style="position:relative;">参考<a href="#%E5%8F%82%E8%80%83" aria-label="参考 permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<ol>
<li><a href="https://github.com/reactjs/react-router-redux">react-router-redux</a></li>
<li><a href="https://github.com/reactjs/react-router">react-router</a></li>
<li><a href="https://github.com/reactjs/react-router-tutorial">react-router-tutorial</a></li>
</ol></div></div><div><h1><a href="/redux-get-started">Redux get started</a></h1><h2>2016 May-10</h2><div class="blog-post-content"><h2 id="what-is-redux" style="position:relative;">what is redux<a href="#what-is-redux" aria-label="what is redux permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p><code class="language-text">redux</code> 是一个目前比较流行的前端框架，它和 <code class="language-text">react</code> 配合使用，作为 <code class="language-text">react</code> 的 数据层。它继承了 <code class="language-text">flux</code> 的思想，构建一个 <code class="language-text">store</code> 保存前端所有的 <code class="language-text">state</code>，但是目前这样的模式也逐渐出现了一些争议，尤其是当一个项目变得比较庞大的时候，在一个 <code class="language-text">store</code> 里面存储单个页面相关的数据并没有非常大的意义，这部分我以后再说。</p>
<p><code class="language-text">redux</code> 的几个关键概念 <code class="language-text">action</code> <code class="language-text">reducer</code> <code class="language-text">store</code> 在 <a href="https://redux.js.org">https://redux.js.org</a> 都有详细的介绍，尤其是在官网推荐的教学视频介绍了 <code class="language-text">reduex</code> 的一些实现细节，对理解 <code class="language-text">redux</code> 是如何工作的有很大的帮助，强烈推荐观看</p>
<h2 id="a-simple-redux-example" style="position:relative;">a simple redux example<a href="#a-simple-redux-example" aria-label="a simple redux example permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>首先安装 <code class="language-text">redux</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ npm install --save redux</code></pre></div>
<p>然后我们构建一个简单的目录结构</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">.
├── actions
├── dist
│   ├── bundle.js
│   ├── index.html
│   └── styles.css
├── entry.js
├── package.json
├── reducers
├── styles
│   ├── index.scss
│   └── theme.scss
└── webpack.config.js</code></pre></div>
<p>两个新的文件夹 <code class="language-text">actions</code> 和 <code class="language-text">reducers</code> 分别用于存放 <code class="language-text">action</code> 和 <code class="language-text">reducer</code>。然后我们实现一下 <code class="language-text">redux</code> 官网没有视图的 <code class="language-text">counter</code> 的例子，具体代码如下，其中 <code class="language-text">actions</code> 用于定义应用所支持的动作，有点像是 <code class="language-text">request</code>，然后 <code class="language-text">reducer</code> 定义依据动作的处理，有点像是 <code class="language-text">controller</code> 中对应的一个个的方法。</p>
<p><code class="language-text">actions/index.js</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">export const increment = () => {
  return {
    type: "INCREMENT"
  }
}

export const decrement = () => {
  return {
    type: "DECREMENT"
  }
}</code></pre></div>
<p><code class="language-text">reducers/counter.js</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">export default (state=0, action) => {
  switch (action.type) {
    case 'INCREMENT':
      return state + 1;
      break;
    case 'DECREMENT':
      return state - 1;
      break;
    default:
      return 0;
  }
}</code></pre></div>
<p><code class="language-text">entry.js</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">require('./styles/index.scss');

import counter from './reducers/counter';
import { increment, decrement } from './actions/index';
import { createStore } from 'redux';

let store = createStore(counter);

console.log(store.getState());

let unsubscribe = store.subscribe(() => console.log(store.getState()));

store.dispatch(increment());
store.dispatch(increment());
store.dispatch(decrement());
store.dispatch(decrement());

unsubscribe();</code></pre></div>
<h2 id="add-test-for-reducer" style="position:relative;">add test for reducer<a href="#add-test-for-reducer" aria-label="add test for reducer permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>前端越来越复杂，相应的测试也是必不可少的了。我们目前的应用比较简单，最复杂的就是 <code class="language-text">reducers</code> 所以给 <code class="language-text">reducers</code> 添加一些测试。我们这里使用 <code class="language-text">mocha</code> 作为测试框架。<code class="language-text">redux</code> 官网提供了如何写测试的<a href="https://redux.js.org/docs/recipes/WritingTests.html">文档</a></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ npm install --save-dev mocha expect</code></pre></div>
<p>其中 <code class="language-text">expect</code> 是一个支持比较 fancy 的 <code class="language-text">assert</code> 语法的库。</p>
<p>为了和 <code class="language-text">babel</code> 一起使用需要另外一个东西 <code class="language-text">babel-register</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ npm install --save-dev babel-register</code></pre></div>
<p>添加一个 <code class="language-text">test</code> 目录</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ mkdir test</code></pre></div>
<p>添加 <code class="language-text">reducer</code> 的测试 <code class="language-text">test/reducers/counter.spec.js</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">import expect from 'expect';
import counter from '../../reducers/counter';

describe('counter', () => {
  it('should get init state 0', () => {
    expect(counter(undefined, {})).toBe(0);
  });
  it('should increase state', () => {
    expect(counter(1, { type: 'INCREMENT' })).toBe(2);
  });
  it('should decrease state', () => {
    expect(counter(1, { type: 'DECREMENT' })).toBe(0);
  });
  it('should stay same with unknown action', () => {
    expect(counter(1, { type: 'NO_ACTION' })).toBe(1);
  });
});</code></pre></div>
<p>是不是觉得全天下的 <code class="language-text">spec</code> 都一样？</p>
<p>然后我们执行 <code class="language-text">mocha --compilers js:babel-register --recursive</code> 跑测试。</p>
<p>是不是报错了？因为我们没有 <code class="language-text">.babelrc</code> 文件。因为之前我觉得这是一个隐式声明，不如在 <code class="language-text">webpack.config.js</code> 显式声明好。但是没办法，其他地方也要用，改回去好了。</p>
<p><code class="language-text">.babelrc</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">{
  "presets": ["es2015"]
}</code></pre></div>
<p><code class="language-text">webpack.config.js</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">var path = require("path");
var ExtractTextPlugin = require("extract-text-webpack-plugin");

module.exports = {
  entry: [
    './entry'
  ],
  output: {
    path: path.join(__dirname, "dist"),
    filename: "bundle.js"
  },
  module: {
    loaders: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        loader: "babel-loader"
      },
      {
        test: /\.scss$/,
        exclude: /node_modules/,
        loader: ExtractTextPlugin.extract("style-loader", "css-loader", "sass-loader")
      }
    ]
  },
  plugins: [
    new ExtractTextPlugin("styles.css")
  ]
};</code></pre></div>
<p>和 <code class="language-text">npm start</code> 类似，我们可以写一个 <code class="language-text">npm test</code> 把那一堆命令移过去。</p>
<p><code class="language-text">package.json</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">{
  "name": "test-redux",
  "version": "1.0.0",
  "description": "",
  "dependencies": {
    "redux": "^3.5.2",
    "webpack": "^1.13.0"
  },
  "devDependencies": {
    "babel-core": "^6.8.0",
    "babel-loader": "^6.2.4",
    "babel-preset-es2015": "^6.6.0",
    "css-loader": "^0.23.1",
    "expect": "^1.20.1",
    "extract-text-webpack-plugin": "^1.0.1",
    "mocha": "^2.4.5",
    "node-sass": "^3.7.0",
    "sass-loader": "^3.2.0",
    "style-loader": "^0.13.1",
    "webpack": "^1.13.0"
  },
  "scripts": {
    "start": "webpack-dev-server --inline --hot --content-base dist/",
    "test": "mocha --compilers js:babel-register --recursive"
  },
  "author": "",
  "license": "ISC"
}</code></pre></div>
<p>现在再跑一下 <code class="language-text">npm test</code> 就和刚才一样的结果。</p>
<h2 id="参考" style="position:relative;">参考<a href="#%E5%8F%82%E8%80%83" aria-label="参考 permalink" class="custom-class after"><svg aria-hidden="true" height="20" version="1.1" viewBox="0 0 16 16" width="20"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<ol>
<li><a href="https://redux.js.org">redux</a></li>
<li><a href="https://github.com/reactjs/redux/tree/master/examples/counter">redux counter example</a></li>
<li><a href="https://redux.js.org/docs/recipes/WritingTests.html">redux writing tests</a></li>
<li><a href="https://babeljs.io/docs/usage/babelrc/">babelrc</a></li>
</ol></div></div><div class="flex justify-center mt-8"><a class="w-32 text-center px-4 py-1 border mx-4 border-gray-800 border-solid" href="/page/19">Previous</a><a class="w-32 text-center px-4 py-1 border mx-4 border-gray-800 border-solid" href="/page/21">Next</a></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-31932181-2"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-31932181-2', {"send_page_view":false});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/page/20";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-f53e78942ac2ddb4ecf0.js"],"app":["/app-7decc5285b369d37659c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-66993b9f94f8c62f0827.js"],"component---src-pages-about-js":["/component---src-pages-about-js-da2020c78f1171804496.js"],"component---src-pages-archive-js":["/component---src-pages-archive-js-42aa31389c0ed5cadd4f.js"],"component---src-pages-index-js":["/component---src-pages-index-js-77f905e505de36b88d66.js"],"component---src-templates-blog-js":["/component---src-templates-blog-js-618f624da6564e464c55.js"],"component---src-templates-blogs-js":["/component---src-templates-blogs-js-49c4c7b7e8475895eb83.js"]};/*]]>*/</script><script src="/polyfill-f53e78942ac2ddb4ecf0.js" nomodule=""></script><script src="/component---src-templates-blogs-js-49c4c7b7e8475895eb83.js" async=""></script><script src="/75ce8a9e25edca21eb9c1a1dab0250d3ee550bef-e9b300a9f21137291b3a.js" async=""></script><script src="/app-7decc5285b369d37659c.js" async=""></script><script src="/framework-e728256d7a1d703d32c2.js" async=""></script><script src="/webpack-runtime-2855cafaad6fd1ef06ee.js" async=""></script></body></html>